Topic_no,Keywords,Contrib,System,Text
14,"commit, merge, root_date, bug, author_kenny, key, instance, ad, cipher_suite, change, cherry_picked, check, nativecrypto, throw_exception, cd, error, enable, move_state, checks_inside, empty",0.092,conscrypt,Tracking openssl-1.0.1 Bug: 6168278 Change-Id: I240d2cbc91f616fd486efc5203e2221c9896d90f/getPeerHostName should check for null InetAddress The address can be null for SSLSockets that have not been connected. Bug: 5835165 (cherry picked from commit cb047c49abcf3b7b5c231b68431c291fe2d81b52) Change-Id: I12eb92ab0cdb42b89333361a485979c48365d5da/
,,0.1302,conscrypt,"am a8e0ac07: am f2c8382b: am 5a1225cc: Merge ""NativeCrypto: add assertions for no OpenSSL errors"" * commit a8e0ac07166ba25fa50e83773cd18ac9f36bf18e: NativeCrypto: add assertions for no OpenSSL errors/am f2c8382b: am 5a1225cc: Merge ""NativeCrypto: add assertions for no OpenSSL errors"" * commit f2c8382b0aa0fca4b79601cb21a9136b862996c2: NativeCrypto: add assertions for no OpenSSL errors/am 5a1225cc: Merge ""NativeCrypto: add assertions for no OpenSSL errors"" * commit 5a1225cc1b870ffab8be63f2f4a5baa2f3e26126: NativeCrypto: add assertions for no OpenSSL errors/NativeCrypto: add assertions for no OpenSSL errors Some calls in NativeCrypto appear to be not clearing error states. Add an assertion at the end of each test to make sure this doesnt happen. Change-Id: I9030891a8dc9e7715e65071fe949a11d7a560e56/OpenSSLCipher: remove buffer for partial blocks Some block ciphers buffer the first block used. We werent accounting for this so we started failing with DES3. This led to another issue that OpenSSL can sometimes keep things in its internal buffer. Instead of having multiple levels of buffering, just rely on OpenSSL to do the buffering. Change-Id: I40a6c7e92e70d3c9ae530f35e8a4234f62e8d225/Add OpenSSLSocketImpl.setSoWriteTimeout to allow SO_SNDTIMEO to be specified Bug: 6693087 Change-Id: Ie6903168ca0ada4516c55dfab5f7194baf965b4c/Disable SSL compression Bug: 7079965 Change-Id: I8e060a827613e212bbcced66507fbf124bb04543/Add raw RSA signature support With the new Keystore changes, this is the only way you can get raw RSA signatures which a lot of native code expects to be able to do. (cherry-picked from c531f5f402b4cedcc35a0b7f0b540dc84c545106) Bug: 6787078 Change-Id: I1c5ddd5287be1ab71347eedc864a41c24e156cb4/Add raw RSA signature support With the new Keystore changes, this is the only way you can get raw RSA signatures which a lot of native code expects to be able to do. Bug: 6787078 Change-Id: I1c5ddd5287be1ab71347eedc864a41c24e156cb4/"
,,0.1008,conscrypt,"am 5906f9f4: Merge ""verifyCertificateChain should convert unknown exceptions to CertificateException"" * commit 5906f9f4485e02d780c4fec61b62910e994ea5d6: verifyCertificateChain should convert unknown exceptions to CertificateException/verifyCertificateChain should convert unknown exceptions to CertificateException Bug: Change-Id: Id0e0eb8f007987decb4fee94135be8a92d2f8981/DO NOT MERGE Disable SSL compression Bug: 7079965 Change-Id: I8e060a827613e212bbcced66507fbf124bb04543 modified: luni/src/main/java/libcore/net/ modified: luni/src/main/java/org/apache/harmony/xnet/provider/jsse/NativeCrypto.java modified: luni/src/main/java/org/apache/harmony/xnet/provider/jsse/OpenSSLServerSocketImpl.java modified: luni/src/main/java/org/apache/harmony/xnet/provider/jsse/OpenSSLSessionImpl.java modified: luni/src/main/java/org/apache/harmony/xnet/provider/jsse/OpenSSLSocketImpl.java modified: luni/src/main/native/org_apache_harmony_xnet_provider_jsse_NativeCrypto.cpp modified: luni/src/test/java/org/apache/harmony/xnet/provider/jsse/NativeCryptoTest.java/"
,,0.0758,conscrypt,"am e7cc4ea0: am 599f6cf9: Merge ""OpenSSLCipher: fix short buffer error message"" Via Android Git Automerger (1) and others * commit e7cc4ea0c7ef7982e2cf39d885394e41e9b0df8f: OpenSSLCipher: fix short buffer error message/am 599f6cf9: Merge ""OpenSSLCipher: fix short buffer error message"" Via Gerrit Code Review (1) and Kenny Root (1) * commit 599f6cf95d676fe0dacd65b0d1cfb66c6f89744d: OpenSSLCipher: fix short buffer error message/OpenSSLCipher: fix short buffer error message Change-Id: I4f16bee3c57c80a113bd92509451606d5fd2b666/"
,,0.3528,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../Make sure ChannelID key is initialized This test used the test ChannelID key, but it didnt make sure it was initialized first. This made it appear sometimes depending on the order the tests were executed. (cherry picked from commit debfff83084b79b65c092cfe72ebea9d9a9548d6) Bug: 10210673 Change-Id: I5212e265611208ecb641a7d6b403985df603cb03/"
,,0.3194,conscrypt,"am b590aa9f: am e75878c7: Fix mac build * commit b590aa9f4377b810c62bc51e7d3651fd86c89854: Fix mac build/am e75878c7: Fix mac build * commit e75878c72b717696d7e4f6cc1052f1cdaca3bda8: Fix mac build/Fix mac build move gcc outside of functions for apples ancient gcc (cherry picked from commit 37f25af685a795b2f2bfa9abb8bb5109c422c52c) Change-Id: I3ea7fa22805980cfd5059e75c21e2e943604fb8a/am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../Add specific exception for wrong final block length EVP_DecryptFinal_ex can have an error on the wrong block length at the end of a decrypted block, so throw IllegalBlockSizeException when that happens instead of a RuntimeException. Bug: 10610957 Bug: Change-Id: I70ea040c3b52fc30591963270850871a8cc581d3/Remove dependency on JNIHelp header side effects. (cherrypick of cc5305a004afc334842a4afadca9530c2ea0c8ff.) Bug: 10680559 Change-Id: I49ad58dea61a0e558bebfbd76019e7e0730cab52/Properly refcount X509 instances We were leaking X509 references from stacks before so we could get away with reusing references that should have been freed. Since were properly tracking references now, we need to up the reference of things were using. (cherry picked from commit 499f7cd642cc32f89f793fe356afbebeba8bf9c1) Bug: 10610037 Change-Id: I4a4beda9b635881c51194410a6da8274c3c1d429/Use sk_FOO_pop_free instead of sk_FOO_free The proper way to free a stack of owned ""FOO"" items is to use sk_FOO_pop_free since that will iterate through all the FOO instances in the stack and free them. Calling sk_FOO_free just frees the stack and not the items. (cherry picked from commit 64299318644c0c6b86992d414e68d0af236b52c5) Bug: 10610037 Bug: Change-Id: I8af603b10219acb476666e77cc776b6936a19f8d/Fix BIO_OutputStream::write to return the correct length. This was leaving bad OpenSSL error states lying around for later innocent calls to trip over. Also clean up some of the other error reporting/handling. Bug: 9822466 Bug: 10344304 Change-Id: I9e6d6fd9a6c5e466336217b47f45c211aff5555d/Fix libcores NativeCode.mk so we actually compile with Change-Id: Ib665ea7c6f54e43851bc04f0265e65218407c70f/"
,,0.3711,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3697,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3697,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3682,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3682,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3509,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../If libcore wants ASCII casing, it needs to ask for it like everyone else. Bug: Change-Id: I597b2ac940f17b5b2bc176e390dc4b63fe0a4e72/"
,,0.3711,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3625,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3611,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3725,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3711,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3697,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3682,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.364,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3519,conscrypt,"Do not use short-keyed TLS/SSL cipher suites by default. This removes TLS/SSL cipher suites with bulk cipher secret keys shorter than 80 bits from the list of cipher suites used by default: * export-strength cipher suites, and * cipher suites using DES (but not 3DES) as their bulk cipher. Bug: 11220570 Change-Id: I04e30f6d634801b36018fecc8f2b257fc6b7adfc/am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../Fix build Missed this during the git reset Change-Id: I6c089d2fb5192d43934d55949b261b05cb8d67da/"
,,0.3668,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3339,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../Return IvParameters in OpenSSLCipher#getParameters The getParameters() call was unimplemented in the OpenSSLCipher as an oversight. Add it so code relying on it will continue to work. Additionally add tests for getIV() and getParameters() to make sure they work correctly. (cherry picked from commit 8d59a14a150738b8b3a2a8c31d1a48b8ae0a3d0c) Bug: 10423926 Change-Id: I6bc7fc540509242dff9e5411f66f82be54691cb4/"
,,0.3711,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3654,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3697,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3155,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../Conscrypt: correct key selection with no sigAlg The KeyManagerImpl was changed to support the ""EC_EC"" and ""EC_RSA"" key types in the StandardNames document. The intention of those aliases are to require a certain signature type. If it is missing, it should accept any signature type as before. However, it was erroneously requiring the same signature type as the key type if it was missing. This causes RSA client certificates signed by an EC key, for instance, to fail. Bug: 10966884 Change-Id: I298bf65ac4c607ae13e24b44fb1b52ec341f9fcf/"
,,0.3238,conscrypt,"Tidy up locking in OpenSSLSocketImpl. We guard all state with a single lock ""stateLock"", which replaces usages of ""this"" and ""handshakeLock"". We do not perform any blocking operations while holding this lock. In particular, startHandshake is no longer synchronized. We use a single integer to keep track of handshake state instead of a pair of booleans. Also fix a bug in getSession, the previous implementation wouldnt work in cut-through mode. This fixes a deadlock in SSLSocketTest_interrupt. Change-Id: I9aef991e0579d4094e287dde8e521d09d6468c51/am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../Some cleanup while investigating test_SSLSocket_interrupt Bug: 10681815 Change-Id: If9a76f4c55b578c6f135befebcc443ab9aef3073/Delay SSLSocketImpl instantiation until needed Class preloading will create an instance of objects if they are in static fields, so put the ones we dont want instantiated into a holder class that is not preloaded. (cherry picked from commit da5b7116b58795b169961cbd63c2b21bac741d9a) Bug: 9984058 Change-Id: If8cb4280cbee79cd4d479fbf6a5297c8e5569b6c/Call SSL_use_certificate before SSL_use_PrivateKey Bug: Change-Id: Icf39b98802e2c6128e79c44eaf2cabc7b4805cc5/"
,,0.3682,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../"
,,0.3901,conscrypt,"am aa03f4a3: Merge history of libcore into conscrypt * commit aa03f4a33968a0e4031ffa8a54309c5b6df24c6a: (366 commits) Conscrypt: add missing libraries to JNI lib Conscrypt: fixing Android.mk dependencies Initial empty commit Remove unsupported Cipher modes Conscrypt: correct key selection with no sigAlg Conscrypt: add SHA-224 with tests Do not throw exception on Mac#reset Split Conscrypt makefile out from libcore Revert ""Restore NativeCrypto#encodeCertificates for now"" Fix build Restore NativeCrypto#encodeCertificates for now Conscrypt: use certificate references in SSL code Add specific exception for wrong final block length Conscrypt: remove dependence on stlport Remove dependency on JNIHelp header side effects. Properly refcount X509 instances Return IvParameters in OpenSSLCipher#getParameters Some cleanup while investigating test_SSLSocket_interrupt Delay SSLSocketImpl instantiation until needed Use sk_FOO_pop_free instead of sk_FOO_free .../Delay SSLSocketImpl instantiation until needed Class preloading will create an instance of objects if they are in static fields, so put the ones we dont want instantiated into a holder class that is not preloaded. (cherry picked from commit da5b7116b58795b169961cbd63c2b21bac741d9a) Bug: 9984058 Change-Id: If8cb4280cbee79cd4d479fbf6a5297c8e5569b6c/"
,,0.3408,conscrypt,"Expose support for TLS-PSK. TLS-PSK (Pre-Shared Key) is a set of TLS/SSL cipher suites that use symmetric (pre-shared) keys for mutual authentication of peers. These cipher suites are in some scenarios more suitable than those based on public key cryptography and X.509. See RFC 4279 (Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)) for more information. OpenSSL currently supports only the following PSK cipher suites: * TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256 * TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384 * TLS_PSK_WITH_3DES_EDE_CBC_SHA * TLS_PSK_WITH_AES_128_CBC_SHA * TLS_PSK_WITH_AES_256_CBC_SHA * TLS_PSK_WITH_RC4_128_SHA The last four cipher suites mutually authenticate the peers and secure the connection using a pre-shared symmetric key. These cipher suites do not provide Forward Secrecy once the pre-shared key is compromised, all previous communications secured with that key can be decrypted. The first two cipher suites combine the pre-shared symmetric key with an ephemeral key obtained from an ECDH key exchange performed during the TLS/SSL handshake, thus providing Forward Secrecy. Users of TLS-PSK are expected to provide an implementation of PSKKeyManager to SSLContext.init and then enable at least one PSK cipher suite in SSLSocket/SSLEngine. Bug: 15073623 Change-Id: I8e59264455f980f23a5e66099c27b5b4d932b9bb/am cc46d578: am 5934ada9: am 81c66678: NativeCryptoTest: fix shutdown test * commit cc46d5785d0b529019555450c7286d2aba2ee66a: NativeCryptoTest: fix shutdown test/am 5934ada9: am 81c66678: NativeCryptoTest: fix shutdown test * commit 5934ada9abff559ff9443b450716531cb2dc2155: NativeCryptoTest: fix shutdown test/am 81c66678: NativeCryptoTest: fix shutdown test * commit 81c666781f8e24242e997e2666b656b240c5a145: NativeCryptoTest: fix shutdown test/NativeCryptoTest: fix shutdown test These werent actually testing that the exceptions were thrown before. Since we actually throw now, make sure were throwing the expected exception type. Change-Id: I57b11492118dd7c04faa57c58de7b023294b179c/SSL: also allow calls to read/write after cutthrough Also add test to make sure this works. (cherry picked from commit 68a3f229cd71c1367173ebc31e5363293b9b5dbc) Bug: 14832989 Change-Id: If0189d2b84178bc074148119f5d8927ed7ce38a0/SSL: also allow calls to read/write after cutthrough Also add test to make sure this works. (cherry picked from commit 68a3f229cd71c1367173ebc31e5363293b9b5dbc) Bug: 14832989 Change-Id: If0189d2b84178bc074148119f5d8927ed7ce38a0/SSL: also allow calls to read/write after cutthrough Also add test to make sure this works. Bug: 14832989 Change-Id: I046111cdcc4086a7104d462696078a767e86b12c/"
,,0.3067,conscrypt,"DHKeyPairGenerator: use provided params If the prime is provided in the DHParameterSpec, then use it to generate the key. Bug: 16188130 Change-Id: I42de02c71a58d691ef7ba6e2252367105687b758/Use the new version of TLS Channel ID extension. Bug: 14083889 Change-Id: I5fe0a1558184d44eb8a24bd92c0e7517937f3a5c/am 23d99f15: am 1b60d4ff: Fix 64-bit build error. * commit 23d99f1554d9d14d46459041ba434b0406927849: Fix 64-bit build error./am 1b60d4ff: Fix 64-bit build error. * commit 1b60d4ff4dc301b46f4ac8a48dc63da0be113a05: Fix 64-bit build error./Fix 64-bit build error. Change-Id: I7ff48af2991fc03811c7874a974b9052934d27ae/Add ability to wrap platform keys This is mostly useful for unbundled Conscrypt currently when working with KeyChain-based keys, but could be good for use with PKCS11-like keys in other JSSE providers. Bug: 15469749 Change-Id: I56bf2eaf3228bdf42d671437f4fffdafb8b47b12/am c5a998dd: am fee2d0f1: Add more debugging for getting methods * commit c5a998dd356e50772c088467f513fba5ad5a0e6b: Add more debugging for getting methods/am fee2d0f1: Add more debugging for getting methods * commit fee2d0f1c55ffcb436ecc23af54bf7863a44ab8f: Add more debugging for getting methods/Add more debugging for getting methods When JNI registration fails, we should log it immediately to help with debugging. Otherwise, it will tell you that you called a JNI function with an exception pending. Change-Id: I7cbba4d6639265a79a9d043d120f1a2bf72a85f7/Expose support for TLS-PSK. TLS-PSK (Pre-Shared Key) is a set of TLS/SSL cipher suites that use symmetric (pre-shared) keys for mutual authentication of peers. These cipher suites are in some scenarios more suitable than those based on public key cryptography and X.509. See RFC 4279 (Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)) for more information. OpenSSL currently supports only the following PSK cipher suites: * TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256 * TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384 * TLS_PSK_WITH_3DES_EDE_CBC_SHA * TLS_PSK_WITH_AES_128_CBC_SHA * TLS_PSK_WITH_AES_256_CBC_SHA * TLS_PSK_WITH_RC4_128_SHA The last four cipher suites mutually authenticate the peers and secure the connection using a pre-shared symmetric key. These cipher suites do not provide Forward Secrecy once the pre-shared key is compromised, all previous communications secured with that key can be decrypted. The first two cipher suites combine the pre-shared symmetric key with an ephemeral key obtained from an ECDH key exchange performed during the TLS/SSL handshake, thus providing Forward Secrecy. Users of TLS-PSK are expected to provide an implementation of PSKKeyManager to SSLContext.init and then enable at least one PSK cipher suite in SSLSocket/SSLEngine. Bug: 15073623 Change-Id: I8e59264455f980f23a5e66099c27b5b4d932b9bb/Unbundle: hacks to let Conscrypt compile standalone This is the first pass at getting Conscrypt to compile standalone. It works fine in apps currently. There are a few TODOs to fix. Change-Id: I9b43ba12c55e04c8897ccacf38979ca671a55a26/am cc46d578: am 5934ada9: am 81c66678: NativeCryptoTest: fix shutdown test * commit cc46d5785d0b529019555450c7286d2aba2ee66a: NativeCryptoTest: fix shutdown test/am 5934ada9: am 81c66678: NativeCryptoTest: fix shutdown test * commit 5934ada9abff559ff9443b450716531cb2dc2155: NativeCryptoTest: fix shutdown test/am 81c66678: NativeCryptoTest: fix shutdown test * commit 81c666781f8e24242e997e2666b656b240c5a145: NativeCryptoTest: fix shutdown test/NativeCryptoTest: fix shutdown test These werent actually testing that the exceptions were thrown before. Since we actually throw now, make sure were throwing the expected exception type. Change-Id: I57b11492118dd7c04faa57c58de7b023294b179c/am 7ea02b4c: am 7f9e7554: am 3f8d6407: Fix of native crash in the evpUpdate method * commit 7ea02b4c1c0e95077996dcc5890aa8a2239faceb: Fix of native crash in the evpUpdate method/am 7f9e7554: am 3f8d6407: Fix of native crash in the evpUpdate method * commit 7f9e7554c13e138cfec98605e38b86062c55df72: Fix of native crash in the evpUpdate method/am 3f8d6407: Fix of native crash in the evpUpdate method * commit 3f8d64078d49672f6301661baa59d24f1d2b74c0: Fix of native crash in the evpUpdate method/Fix of native crash in the evpUpdate method The org.apache.harmony.security.tests.java.security.MessageDigest1Test CTS test classs testSHAProvider method was causing a SIGSEGV when ""md.update(bytes, 1, was called, as the evpUpdate method was not checking for the inLength parameter being negative. This has been rectified and the test now passes. Bug: 14821275 Change-Id: I94489a518f7a2d4a6e84e58f91d8eee6f0ceb045 Signed-off-by: Marcus Oakland NOT MERGE Return SSL_TLSEXT_ERR_NOACK with no NPN/ALPN We were returning SSL_TLSEXT_ERR_OK even if we did not select any NPN/ALPN support. (cherry picked from commit fc7924bc78afc46c3c75722a735fe4db65c33304) Bug: Change-Id: I79ea821512f03f1391247d3bcfc7ac7d042ecb41/SSL: also allow calls to read/write after cutthrough Also add test to make sure this works. (cherry picked from commit 68a3f229cd71c1367173ebc31e5363293b9b5dbc) Bug: 14832989 Change-Id: If0189d2b84178bc074148119f5d8927ed7ce38a0/SSL: also allow calls to read/write after cutthrough Also add test to make sure this works. (cherry picked from commit 68a3f229cd71c1367173ebc31e5363293b9b5dbc) Bug: 14832989 Change-Id: If0189d2b84178bc074148119f5d8927ed7ce38a0/SSL: also allow calls to read/write after cutthrough Also add test to make sure this works. Bug: 14832989 Change-Id: I046111cdcc4086a7104d462696078a767e86b12c/SSLSocket: restore previous pre-handshake behavior Before AppData was created in the initial handshake, calling SSL_read or SSL_write would have a NULL appData field. This caused an exception to be thrown. Now we have to check to make sure the handshake completed before we continue on with SSL_read and SSL_write. Change-Id: I969577cf56f61858450a7981a5196f58a6502968/am b4f1e9ad: am a320e0c8: am b45c8e9b: Merge ""BIO_Stream: check for pending exception"" * commit b4f1e9ada6bb74bfe085add43ec404cdb17bbb19: BIO_Stream: check for pending exception/am a320e0c8: am b45c8e9b: Merge ""BIO_Stream: check for pending exception"" * commit a320e0c80a778d0eb7cf8e6146d540ea520ba2c4: BIO_Stream: check for pending exception/am b45c8e9b: Merge ""BIO_Stream: check for pending exception"" * commit b45c8e9b993ed4da0edcdd38621c8eda44a0ada0: BIO_Stream: check for pending exception/Merge ""BIO_Stream: check for pending exception""/BIO_Stream: check for pending exception OpenSSL may make several callbacks in a row, so we need to check whether a pending exception is in flight before calling into the JVM again. Bug: 14477174 Change-Id: I104fa0af08a229430e193c7ed7b147d115215cd2/"
,,0.1022,conscrypt,Unbundle: hacks to let Conscrypt compile standalone This is the first pass at getting Conscrypt to compile standalone. It works fine in apps currently. There are a few TODOs to fix. Change-Id: I9b43ba12c55e04c8897ccacf38979ca671a55a26/
,,0.5665,conscrypt,"Enable PSK cipher suites when PSKKeyManager is provided. This enables TLS-PSK cipher suites by default iff SSLContext is initialized with a PSKKeyManager. For consistency, X.509 based cipher suites are no longer enabled by default at all times they are now only enabled by default iff SSLContext is initialized with a X509KeyManager or a X509TrustManager. When both X.509 and PSK cipher suites need to be enabled, PSK cipher suites are given higher priority in the resulting list of cipher suites. This is based on the assumption that in most cases users of TLS/SSL who enable TLS-PSK would prefer TLS-PSK to be used when the peer supports TLS-PSK. Bug: 15073623 (cherry picked from commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17) Change-Id: Icd7fe066147a6b2fc64d807204cc99f6af821313/Enable PSK cipher suites when PSKKeyManager is provided. This enables TLS-PSK cipher suites by default iff SSLContext is initialized with a PSKKeyManager. For consistency, X.509 based cipher suites are no longer enabled by default at all times they are now only enabled by default iff SSLContext is initialized with a X509KeyManager or a X509TrustManager. When both X.509 and PSK cipher suites need to be enabled, PSK cipher suites are given higher priority in the resulting list of cipher suites. This is based on the assumption that in most cases users of TLS/SSL who enable TLS-PSK would prefer TLS-PSK to be used when the peer supports TLS-PSK. Bug: 15073623 Change-Id: I8e2bc3e7a1ea8a986e468973b6bad19dc6b7bc3c/DHKeyPairGenerator: use provided params If the prime is provided in the DHParameterSpec, then use it to generate the key. Bug: 16188130 Change-Id: I42de02c71a58d691ef7ba6e2252367105687b758/Adjust the list of supported ECDHE-PSK cipher suites. The SHA-2 based cipher suites cannot be used with SSLv3 but there is no way to express that in OpenSSLs configuration. This CL thus adjusts the list of supported cipher suites accordingly. Bug: 15073623 Change-Id: I427c99f4c1c72690d95e5a3c63763631c41ddae2/Add ability to wrap platform keys This is mostly useful for unbundled Conscrypt currently when working with KeyChain-based keys, but could be good for use with PKCS11-like keys in other JSSE providers. Bug: 15469749 Change-Id: I56bf2eaf3228bdf42d671437f4fffdafb8b47b12/Expose support for TLS-PSK. TLS-PSK (Pre-Shared Key) is a set of TLS/SSL cipher suites that use symmetric (pre-shared) keys for mutual authentication of peers. These cipher suites are in some scenarios more suitable than those based on public key cryptography and X.509. See RFC 4279 (Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)) for more information. OpenSSL currently supports only the following PSK cipher suites: * TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256 * TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384 * TLS_PSK_WITH_3DES_EDE_CBC_SHA * TLS_PSK_WITH_AES_128_CBC_SHA * TLS_PSK_WITH_AES_256_CBC_SHA * TLS_PSK_WITH_RC4_128_SHA The last four cipher suites mutually authenticate the peers and secure the connection using a pre-shared symmetric key. These cipher suites do not provide Forward Secrecy once the pre-shared key is compromised, all previous communications secured with that key can be decrypted. The first two cipher suites combine the pre-shared symmetric key with an ephemeral key obtained from an ECDH key exchange performed during the TLS/SSL handshake, thus providing Forward Secrecy. Users of TLS-PSK are expected to provide an implementation of PSKKeyManager to SSLContext.init and then enable at least one PSK cipher suite in SSLSocket/SSLEngine. Bug: 15073623 Change-Id: I8e59264455f980f23a5e66099c27b5b4d932b9bb/DO NOT MERGE OpenSSLX509Certificate: only catch BadPaddingException We only need to catch BadPaddingException right now. Let the other non-RuntimeException exceptions pass. (cherry picked from commit 7c3263f16bae0f1b2125de2c3c1c683303e768ce) Bug: 13746671 Change-Id: I5b6878250d428b1ee953092967b7418003ee9216/"
,,0.3158,conscrypt,"Keep enough state to completely reset cipher instances OpenSSLs RC4 mutates the given key. AES/CTR mutates the IV. We must store these values locally to enable ""doFinal"" to cause the Cipher instance to be reset to what it was right after ""init"". Note that resetting and encrypting with the same key or IV breaks semantic security. (cherry picked from commit 084e3086be1d7a6b9280b64c7c8cdb7b41a13bea) Bug: 16298401 Bug: Change-Id: Ie7e4dcb6cf6cc33ddad31d6b47066dc1b34e6894/Keep enough state to completely reset cipher instances OpenSSLs RC4 mutates the given key. AES/CTR mutates the IV. We must store these values locally to enable ""doFinal"" to cause the Cipher instance to be reset to what it was right after ""init"". Note that resetting and encrypting with the same key or IV breaks semantic security. Bug: 16298401 Bug: Change-Id: Ie7e4dcb6cf6cc33ddad31d6b47066dc1b34e6894/"
,,0.6109,conscrypt,"Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() (cherry picked from 26163c268a6d2625384b87e907afad8ef19f9a47) Bug: 16352665 Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700/Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700/OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. (cherry picked from commit 41eb5b65e524d01e28da474bd37e4349b12fb494) Bug: 16352665 Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b/am 5f03b4d6: am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 5f03b4d63c7632581b032879de791dc82f05ffa0: OpenSSLEngineImpl: fix unwrap behavior with array/am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 41eb5b65e524d01e28da474bd37e4349b12fb494: OpenSSLEngineImpl: fix unwrap behavior with array/OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b/am af4fa685: Merge ""Log CCS exceptions do not merge."" into lmp-dev * commit af4fa685f246aaa80c93af62faadbc2fe87dc034: Log CCS exceptions do not merge./Merge ""Log CCS exceptions do not merge."" into lmp-dev/Log CCS exceptions do not merge. Unlike the previous CL, this uses reflection for android.os.Process and android.util.EventLog throughout. (cherry picked from commit 35b1f354ec2b647966a198ffed932d82eb8eeb5b) Bug: 15452942 Change-Id: I34b9eaedf1f1e450b1f8004887bb0482601d789e/am 5713cdf7: am e08f2385: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit 5713cdf71c5c6e5179e8369263c702e9512afdd0: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN./am cf557195: am 986aeb78: Merge ""Various fixes in OpenSSLEngineImpl."" * commit cf557195a9b60d7f51a48500afde38481ddbc91c: Various fixes in OpenSSLEngineImpl./OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. (cherry picked from commit e08f238580e8ee471012bef8240c8d3397c7b780) Bug: 16352665 Change-Id: Idc78204b7077fb367b64e1867c807cd39f596f98/Various fixes in OpenSSLEngineImpl. Fix ""Buffers were not large enough"" exception by directly using the destination buffers. Corrections around bytesProduced and bytesConsumed behavior. Return BUFFER_OVERFLOW if a zero length destination is provided to unwrap. (cherry picked from commit bdfcc189efe41a3f812aeb55ea634bace67d159a) Bug: 16352665 Change-Id: I1f1e9b72cd6968ed4f3c3c0edccbccebc33d6790/am e08f2385: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit e08f238580e8ee471012bef8240c8d3397c7b780: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN./am 986aeb78: Merge ""Various fixes in OpenSSLEngineImpl."" * commit 986aeb78e533540463daf1753e24840f75b25ce6: Various fixes in OpenSSLEngineImpl./OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. Change-Id: Idc78204b7077fb367b64e1867c807cd39f596f98/Merge ""Various fixes in OpenSSLEngineImpl.""/Various fixes in OpenSSLEngineImpl. Fix ""Buffers were not large enough"" exception by directly using the destination buffers. Corrections around bytesProduced and bytesConsumed behavior. Return BUFFER_OVERFLOW if a zero length destination is provided to unwrap. Change-Id: I1f1e9b72cd6968ed4f3c3c0edccbccebc33d6790/Log CCS exceptions Unlike the previous CL, this uses reflection for android.os.Process and android.util.EventLog throughout. Bug: 15452942 Change-Id: I34b9eaedf1f1e450b1f8004887bb0482601d789e/Revert ""Log OpenSSL CCS errors"" This reverts commit b1599520cdcdda73babffc051590a2dd25cd50be. Some build targets (e.g. git_dalvik-dev) do not have API-1 Android APIs available, like android.os.Process and android.util.EventLog. Investigating. Change-Id: Iddce3f445be0502d1afa4f8244a7b8867721613e/Log OpenSSL CCS errors Bug: 15452942 Change-Id: I49e7bad6a65c70e113324c02fc23315cff168f5b/Expose support for TLS-PSK. TLS-PSK (Pre-Shared Key) is a set of TLS/SSL cipher suites that use symmetric (pre-shared) keys for mutual authentication of peers. These cipher suites are in some scenarios more suitable than those based on public key cryptography and X.509. See RFC 4279 (Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)) for more information. OpenSSL currently supports only the following PSK cipher suites: * TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256 * TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384 * TLS_PSK_WITH_3DES_EDE_CBC_SHA * TLS_PSK_WITH_AES_128_CBC_SHA * TLS_PSK_WITH_AES_256_CBC_SHA * TLS_PSK_WITH_RC4_128_SHA The last four cipher suites mutually authenticate the peers and secure the connection using a pre-shared symmetric key. These cipher suites do not provide Forward Secrecy once the pre-shared key is compromised, all previous communications secured with that key can be decrypted. The first two cipher suites combine the pre-shared symmetric key with an ephemeral key obtained from an ECDH key exchange performed during the TLS/SSL handshake, thus providing Forward Secrecy. Users of TLS-PSK are expected to provide an implementation of PSKKeyManager to SSLContext.init and then enable at least one PSK cipher suite in SSLSocket/SSLEngine. Bug: 15073623 Change-Id: I8e59264455f980f23a5e66099c27b5b4d932b9bb/Unbundle: hacks to let Conscrypt compile standalone This is the first pass at getting Conscrypt to compile standalone. It works fine in apps currently. There are a few TODOs to fix. Change-Id: I9b43ba12c55e04c8897ccacf38979ca671a55a26/"
,,0.4217,conscrypt,"am af4fa685: Merge ""Log CCS exceptions do not merge."" into lmp-dev * commit af4fa685f246aaa80c93af62faadbc2fe87dc034: Log CCS exceptions do not merge./Merge ""Log CCS exceptions do not merge."" into lmp-dev/Log CCS exceptions do not merge. Unlike the previous CL, this uses reflection for android.os.Process and android.util.EventLog throughout. (cherry picked from commit 35b1f354ec2b647966a198ffed932d82eb8eeb5b) Bug: 15452942 Change-Id: I34b9eaedf1f1e450b1f8004887bb0482601d789e/Log CCS exceptions Unlike the previous CL, this uses reflection for android.os.Process and android.util.EventLog throughout. Bug: 15452942 Change-Id: I34b9eaedf1f1e450b1f8004887bb0482601d789e/Revert ""Log OpenSSL CCS errors"" This reverts commit b1599520cdcdda73babffc051590a2dd25cd50be. Some build targets (e.g. git_dalvik-dev) do not have API-1 Android APIs available, like android.os.Process and android.util.EventLog. Investigating. Change-Id: Iddce3f445be0502d1afa4f8244a7b8867721613e/Log OpenSSL CCS errors Bug: 15452942 Change-Id: I49e7bad6a65c70e113324c02fc23315cff168f5b/SSLParametersImpl is the source of enabled cipher suites and protocols. An instance of SSLParametersImpl is associated with SSLContext and is then cloned into any SSLSocketFactory, SSLServerSocketFactory, SSLSocket, SSLServerSocket, and SSLEngine. This CL ensures that all these primitives obtain their list of enabled cipher suites and protocols from their instance of SSLParametersImpl. Bug: 15073623 Change-Id: I40bf32e8654b299518ec0e77c3218a0790d9c4fd/Expose support for TLS-PSK. TLS-PSK (Pre-Shared Key) is a set of TLS/SSL cipher suites that use symmetric (pre-shared) keys for mutual authentication of peers. These cipher suites are in some scenarios more suitable than those based on public key cryptography and X.509. See RFC 4279 (Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)) for more information. OpenSSL currently supports only the following PSK cipher suites: * TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256 * TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384 * TLS_PSK_WITH_3DES_EDE_CBC_SHA * TLS_PSK_WITH_AES_128_CBC_SHA * TLS_PSK_WITH_AES_256_CBC_SHA * TLS_PSK_WITH_RC4_128_SHA The last four cipher suites mutually authenticate the peers and secure the connection using a pre-shared symmetric key. These cipher suites do not provide Forward Secrecy once the pre-shared key is compromised, all previous communications secured with that key can be decrypted. The first two cipher suites combine the pre-shared symmetric key with an ephemeral key obtained from an ECDH key exchange performed during the TLS/SSL handshake, thus providing Forward Secrecy. Users of TLS-PSK are expected to provide an implementation of PSKKeyManager to SSLContext.init and then enable at least one PSK cipher suite in SSLSocket/SSLEngine. Bug: 15073623 Change-Id: I8e59264455f980f23a5e66099c27b5b4d932b9bb/Unbundle: hacks to let Conscrypt compile standalone This is the first pass at getting Conscrypt to compile standalone. It works fine in apps currently. There are a few TODOs to fix. Change-Id: I9b43ba12c55e04c8897ccacf38979ca671a55a26/"
,,0.2606,conscrypt,"Add pre-Honeycomb literal IP matching This will allow us to run this code on Gingerbread devices and others that dont have the InetAddress#isNumeric API. Bug: 16658420 Bug: 17059757 Change-Id: I597d539979d58eeaa2677d6f99e911313a550cc1/Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9/Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208/"
,,0.2019,conscrypt,"Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9/Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208/"
,,0.5988,conscrypt,"Comment out unused parameters and function. BUG: 17281763 Change-Id: I6874dc0ef6ddaba66d465c07cabeb5e781337716/No need to select NPN protocols when not enabled Bug: 16957575 Change-Id: I351316a62f9b583b37b54f3e7fbfaa0450439ca4/OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 (cherry picked from commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706) Change-Id: I151ecbc57278374007a56827a65295b4c9476732/OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 Change-Id: I5ecdeb1551a13098d1b66c5e4009607c9951fa38/am f4b895ae: am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit f4b895ae9c424b5c2d49c744131606adccbc49d7: Revert ""Revert ""Automatic management of OpenSSL error stack""""/am a35c4001: am 30550a8b: Fix debugging with unbundled conscrypt * commit a35c40017c8690f821351d6460dfeaa2738b884c: Fix debugging with unbundled conscrypt/am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit a260ee6d0caea43f8010f158a4a35fb712935ae3: Revert ""Revert ""Automatic management of OpenSSL error stack""""/am 30550a8b: Fix debugging with unbundled conscrypt * commit 30550a8b64bbcd6ca537680a17b8726932a29937: Fix debugging with unbundled conscrypt/Revert ""Revert ""Automatic management of OpenSSL error stack"""" The ""else"" statement in OpenSslError::reset wasnt properly resetting the error state which made a second call into sslRead jump into sslSelect when it should have just returned immediately. Change-Id: I22e8025c0497a04e78daa07cef78191a6ca1a70c/Fix debugging with unbundled conscrypt When JNI_TRACE was enabled, there were missing defines for the debugging code since no platform code is included. Also clang complains about more of the debugging statement formats, so we have to move some things around to get it to be happy. Change-Id: I1a6695c2ef2639cc01cfc3d3a8603f010c659844/am 2411b8bd: Merge ""Revert ""Automatic management of OpenSSL error stack"""" * commit 2411b8bdcde72c956f4150e9a5909b7501f50bad: Revert ""Automatic management of OpenSSL error stack""/Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. (cherry picked from commit b514d72b93c3996d97e38eca6db1ad684965fd9b) Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef/Merge ""Revert ""Automatic management of OpenSSL error stack""""/Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef/am 107a8fba: am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 107a8fba8be5be57933f2638b76ac1243b578b9e: Automatic management of OpenSSL error stack/am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 3262a8c2741b95103149bcdefe2409c24bfddee9: Automatic management of OpenSSL error stack/Merge ""Automatic management of OpenSSL error stack""/Automatic management of OpenSSL error stack This removes some complexity in remembering to free the OpenSSL error stack. If you forget, the error will stick around until you make another call. Change-Id: I245a525dcc93077b2bf9909a14a0ef469a2daca4/am 94890aec: am 977f0877: Fix some JNI_TRACE lines * commit 94890aec5735cde2ea5170fb76cd1b847ea66af8: Fix some JNI_TRACE lines/am 977f0877: Fix some JNI_TRACE lines * commit 977f08774c628b4640d5454cde050259856965f8: Fix some JNI_TRACE lines/Fix some JNI_TRACE lines During debugging these would be enabled, but they were copy-pastad to with the wrong args. Change-Id: I23f39ff4807e3fa71f3220912aec3c99db6b9454/"
,,0.1885,conscrypt,Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650/
,,0.3021,conscrypt,"Rename hostname fields and methods to reflect usage The hostname that was supplied when the socket was created is stored as the ""peerHostname"" This is the only one that should be used for Server Name Indication (SNI) purposes. The ""peerHostname"" or the resolved IP address may be used for certificate validation, so keep the use of ""getHostname()"" for cerificate validation. Bug: 16658420 Bug: 17059757 Change-Id: Ifd87dead44fb2f00bbfd5eac7e69fb3fc98e94b4/Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650/"
,,0.9147,conscrypt,"Squashed commit of changes from lmp-ub-dev Contains the following changes: commit e31d982cdb0f8e6ef05d1e412576888015e1da17 Merge: eaebc54 b73be72 Author: Neil Fuller Date: Wed Oct 22 10:34:23 2014 +0000 am b73be72e: am 3e21a289: (-s ours) TLS_FALLBACK_SCSV CTS fix for klp-modular-dev * commit b73be72ed97da8f36450d95d52f485cc6f451c61: TLS_FALLBACK_SCSV CTS fix for klp-modular-dev commit eaebc544f3a10c53d7d2f908514122caba569e14 Merge: 223b5da cd50afa Author: Kenny Root Date: Tue Oct 14 17:30:19 2014 +0000 Merge ""Fix SSLEngine to support session resumption."" into lmp-ub-dev commit 223b5da5d70e47b1a497e86474493925b568f6d7 Merge: 8737796 cb7a360 Author: Neil Fuller Date: Thu Oct 9 14:52:00 2014 +0000 am cb7a3605: am ea961ada: Apply conscrypt changes from merge commit * commit cb7a36050f34d3c16be00d532411820761eeb276: Apply conscrypt changes from merge commit commit cd50afad1567b1311e6e979e94a7167b7bf69c94 Author: Doug Steedman Date: Mon Oct 6 13:16:15 2014 Fix SSLEngine to support session resumption. Bug: 17877118 Change-Id: I388b59cde58fdc506ecac9f536e4bbd9161df6ad commit 8737796a646eaec94df32827752a71aee74bd46f Merge: 9564a5f 8d7e23e Author: Kenny Root Date: Mon Oct 6 22:34:20 2014 +0000 am 8d7e23e1: Add support for TLS_FALLBACK_SCSV * commit 8d7e23e117da591a8d48e6bcda9ed6f58ff1a375: Add support for TLS_FALLBACK_SCSV commit 9564a5fb9ed2eecf6299788db35213cb08397212 Merge: 4f58feb 7640613 Author: Kenny Root Date: Fri Sep 12 17:27:23 2014 +0000 am 76406135: am 6dcb23fe: am f427ec90: Fix the ENGINE_finish/ENGINE_free mixup * commit 76406135cf3a3b88afc979fe8e847b9c3d8b93c1: Fix the ENGINE_finish/ENGINE_free mixup commit 4f58feb0ea49dc089a95efba196032ef3c960a39 Merge: ddac5c6 984b7ec Author: Kenny Root Date: Wed Sep 10 07:07:16 2014 +0000 am 984b7ec6: Fix the ENGINE_finish/ENGINE_free mixup * commit 984b7ec6f5aab314117949a48e448ff4f6b65f16: Fix the ENGINE_finish/ENGINE_free mixup commit ddac5c6d7e413b0d68b388fbdf70dbeb3eeae865 Merge: 5a8ca5b 36ba60b Author: Kenny Root Date: Thu Sep 4 22:41:38 2014 +0000 Merge ""Reset lmp-ub-dev to lmp-dev-plus-aosp"" into lmp-ub-dev commit 36ba60b039f1f30ab1ea8f0e2a4da8ae4e3906e5 Author: Kenny Root Date: Wed Aug 27 12:07:07 2014 Reset lmp-ub-dev to lmp-dev-plus-aosp Bug: 17059757 Change-Id: I581963360da47b574e1e2e20c2851485c36fa62c commit 6a4f2ef9e4ea3ebb321d45ca39b30d634ea3b4ad Merge: 9b187af f67d784 Author: Kenny Root Date: Tue Aug 26 04:17:38 2014 +0000 am f67d784a: Add pre-Honeycomb literal IP matching * commit f67d784abe5cef700240be02c68cecd899cd8e6d: Add pre-Honeycomb literal IP matching commit 9b187af33dcd97915a0371d64fe1ee4aba20d0ba Merge: 714ebea 966ae8a Author: Kenny Root Date: Tue Aug 26 04:17:37 2014 +0000 am 966ae8a6: Read property to enable SNI * commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb: Read property to enable SNI commit 714ebeabcb5e35c6df6a5c21f549cdb6130368c4 Merge: 7724204 54a1ba4 Author: Kenny Root Date: Tue Aug 26 04:06:54 2014 +0000 Merge ""resolved conflicts for merge of 342097db to lmp-dev-plus-aosp"" into lmp-dev-plus-aosp commit 54a1ba421d23bb6d988688c2662715e509172447 Merge: a20d871 342097d Author: Kenny Root Date: Mon Aug 25 21:03:51 2014 resolved conflicts for merge of 342097db to lmp-dev-plus-aosp Change-Id: I853c6b0d3725dafbdc84c4d6d6d1b90529bd949d commit 7724204abf4431d35787c44c4a22cda5489d4e37 Merge: 20f60ac afb3403 Author: Kenny Root Date: Tue Aug 26 00:09:27 2014 +0000 am afb34034: Implement write socket timeouts for unbundled apps * commit afb340348bfc54dbc46964e159fe803f9c93a4dd: Implement write socket timeouts for unbundled apps commit f67d784abe5cef700240be02c68cecd899cd8e6d Author: Kenny Root Date: Wed Aug 20 14:14:26 2014 Add pre-Honeycomb literal IP matching This will allow us to run this code on Gingerbread devices and others that dont have the InetAddress#isNumeric API. Bug: 16658420 Bug: 17059757 Change-Id: I597d539979d58eeaa2677d6f99e911313a550cc1 commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb Author: Kenny Root Date: Mon Aug 18 10:12:20 2014 Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9 commit 342097db97a9b2736531033b2c4b4d8ce4998c67 Author: Kenny Root Date: Wed Aug 20 12:14:52 2014 Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208 commit afb340348bfc54dbc46964e159fe803f9c93a4dd Author: Kenny Root Date: Tue Aug 19 16:33:07 2014 Implement write socket timeouts for unbundled apps Change-Id: I4fd604f057ba4288d4f31bf6b3b93307376023d5 commit 20f60acea153dfdf0c8f75a53d7bd9edb4c7614c Author: Kenny Root Date: Mon Aug 25 11:52:05 2014 Tracking change from AOSP Change-Id: I889af3f7c1de9ef34d9328339e1b421651055ad4 commit 68056b7c9db8a9fb384bbadfc5287730f996896d Merge: 8239dfd cc2ef2e Author: Kenny Root Date: Mon Aug 25 18:03:27 2014 +0000 am cc2ef2e2: Rename hostname fields and methods to reflect usage * commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e: Rename hostname fields and methods to reflect usage commit 8239dfdcc40a69255d7b2feced960d574ea36321 Merge: e9cf759 076138f Author: Kenny Root Date: Thu Aug 21 16:36:24 2014 +0000 am 076138ff: Use consistent naming for SSLSocket arguments * commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11: Use consistent naming for SSLSocket arguments commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e Author: Kenny Root Date: Wed Aug 20 11:26:33 2014 Rename hostname fields and methods to reflect usage The hostname that was supplied when the socket was created is stored as the ""peerHostname"" This is the only one that should be used for Server Name Indication (SNI) purposes. The ""peerHostname"" or the resolved IP address may be used for certificate validation, so keep the use of ""getHostname()"" for cerificate validation. Bug: 16658420 Bug: 17059757 Change-Id: Ifd87dead44fb2f00bbfd5eac7e69fb3fc98e94b4 commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11 Author: Kenny Root Date: Wed Aug 20 11:24:41 2014 Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650 commit e9cf759ac89fb053c01f1db19931beb14a823618 Merge: ababdd1 7ed0fae Author: Kenny Root Date: Tue Aug 19 19:32:43 2014 +0000 am 7ed0fae1: OpenSSLEngineImpl: reduce number of copies needed * commit 7ed0fae1906061766d0042e69ccba20e4a702bbe: OpenSSLEngineImpl: reduce number of copies needed commit 7ed0fae1906061766d0042e69ccba20e4a702bbe Author: Kenny Root Date: Tue Jul 22 13:03:09 2014 OpenSSLEngineImpl: reduce number of copies needed When the ByteBuffer didnt line up exactly with the backing array, it would allocate a new buffer to write into. Instead, add the ability for OpenSSL to read at an offset in the given array so a copy isnt needed. Change-Id: I149d3f94e4b5cbdc010df80439ae3300cbdc87a5 commit ababdd1ae1272eac174e3a449a413ab35afbc435 Merge: 66c31e0 4b050b6 Author: Kenny Root Date: Fri Aug 15 16:23:14 2014 +0000 am 4b050b6f: OpenSSLSocketImpl: Move state checks inside mutex * commit 4b050b6fb06fbb804557eecc72cc4ff0e0277525: OpenSSLSocketImpl: Move state checks inside mutex commit 66c31e0b613ceefc167a2e1fb226a14c78f84537 Merge: f4b895a 0931d51 Author: Kenny Root Date: Thu Aug 14 20:46:43 2014 +0000 am 0931d51c: OpenSSLSocketImpl: Move state checks inside mutex * commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706: OpenSSLSocketImpl: Move state checks inside mutex commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706 Author: Kenny Root Date: Tue Aug 5 15:45:32 2014 OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 Change-Id: I5ecdeb1551a13098d1b66c5e4009607c9951fa38 commit f4b895ae9c424b5c2d49c744131606adccbc49d7 Merge: a35c400 a260ee6 Author: Kenny Root Date: Wed Aug 13 15:35:28 2014 +0000 am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit a260ee6d0caea43f8010f158a4a35fb712935ae3: Revert ""Revert ""Automatic management of OpenSSL error stack"""" commit a35c40017c8690f821351d6460dfeaa2738b884c Merge: 0edc483 30550a8 Author: Kenny Root Date: Wed Aug 13 15:35:27 2014 +0000 am 30550a8b: Fix debugging with unbundled conscrypt * commit 30550a8b64bbcd6ca537680a17b8726932a29937: Fix debugging with unbundled conscrypt commit a260ee6d0caea43f8010f158a4a35fb712935ae3 Author: Kenny Root Date: Tue Aug 12 15:38:10 2014 Revert ""Revert ""Automatic management of OpenSSL error stack"""" The ""else"" statement in OpenSslError::reset wasnt properly resetting the error state which made a second call into sslRead jump into sslSelect when it should have just returned immediately. Change-Id: I22e8025c0497a04e78daa07cef78191a6ca1a70c commit 30550a8b64bbcd6ca537680a17b8726932a29937 Author: Kenny Root Date: Tue Aug 12 15:13:33 2014 Fix debugging with unbundled conscrypt When JNI_TRACE was enabled, there were missing defines for the debugging code since no platform code is included. Also clang complains about more of the debugging statement formats, so we have to move some things around to get it to be happy. Change-Id: I1a6695c2ef2639cc01cfc3d3a8603f010c659844 commit 0edc4833091846d6cb45961fc9458df842fbbad9 Merge: 107a8fb 2411b8b Author: Kenny Root Date: Tue Aug 12 21:46:12 2014 +0000 am 2411b8bd: Merge ""Revert ""Automatic management of OpenSSL error stack"""" * commit 2411b8bdcde72c956f4150e9a5909b7501f50bad: Revert ""Automatic management of OpenSSL error stack"" commit 2411b8bdcde72c956f4150e9a5909b7501f50bad Merge: 3262a8c b514d72 Author: Kenny Root Date: Tue Aug 12 21:39:32 2014 +0000 Merge ""Revert ""Automatic management of OpenSSL error stack"""" commit b514d72b93c3996d97e38eca6db1ad684965fd9b Author: Kenny Root Date: Tue Aug 12 21:39:17 2014 +0000 Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef commit 107a8fba8be5be57933f2638b76ac1243b578b9e Merge: 1de007f 3262a8c Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 3262a8c2741b95103149bcdefe2409c24bfddee9: Automatic management of OpenSSL error stack commit 1de007f9f01be8f07a56235dd924c897088a03cb Merge: 94890ae d1bbcd0 Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am d1bbcd0e: Relax checks for key vs cert for wrapped keys * commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484: Relax checks for key vs cert for wrapped keys commit 3262a8c2741b95103149bcdefe2409c24bfddee9 Merge: d1bbcd0 35666e4 Author: Kenny Root Date: Tue Aug 12 15:31:02 2014 +0000 Merge ""Automatic management of OpenSSL error stack"" commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484 Author: Kenny Root Date: Mon Aug 11 14:56:58 2014 Relax checks for key vs cert for wrapped keys If a key is a wrapped platform key, we must relax the check. The reason is that we may not have the public values we need to pass the EVP_PKEY_cmp checks that this does. Change-Id: I7ab2be51b0968a9cf771edea01d33fe2367c8185 commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8 Author: Kenny Root Date: Tue Aug 5 11:05:00 2014 Automatic management of OpenSSL error stack This removes some complexity in remembering to free the OpenSSL error stack. If you forget, the error will stick around until you make another call. Change-Id: I245a525dcc93077b2bf9909a14a0ef469a2daca4 commit 94890aec5735cde2ea5170fb76cd1b847ea66af8 Merge: 8360485 977f087 Author: Kenny Root Date: Tue Aug 5 16:44:42 2014 +0000 am 977f0877: Fix some JNI_TRACE lines * commit 977f08774c628b4640d5454cde050259856965f8: Fix some JNI_TRACE lines commit 977f08774c628b4640d5454cde050259856965f8 Author: Kenny Root Date: Mon Aug 4 12:15:04 2014 Fix some JNI_TRACE lines During debugging these would be enabled, but they were copy-pastad to with the wrong args. Change-Id: I23f39ff4807e3fa71f3220912aec3c99db6b9454 commit 83604854c5160304cafefc9bd40a72c5ee8506eb Merge: 7db3524 1ffe43e Author: Zoltan Szatmary-Ban Date: Thu Jul 31 13:28:57 2014 +0000 am 1ffe43e8: Merge ""Add possibility to get deleted system Certificate Aliases"" into lmp-dev * commit 1ffe43e8277e883c6663c1fb7cfc5e18ba552c40: Add possibility to get deleted system Certificate Aliases commit 7db3524880092126962b7f502af76b4c84da7350 Merge: 5767d63 ad0cd83 Author: Prameet Shah Date: Wed Jul 30 17:04:13 2014 +0000 am ad0cd830: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit ad0cd83024f38011043d28d70370a8638b88cd72: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 5767d63d22e87becab387b3bd6597fe41eb34d7e Merge: b389e17 26163c2 Author: Prameet Shah Date: Wed Jul 30 16:31:08 2014 +0000 am 26163c26: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit 26163c268a6d2625384b87e907afad8ef19f9a47: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 26163c268a6d2625384b87e907afad8ef19f9a47 Author: Prameet Shah Date: Tue Jul 29 16:45:31 2014 Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700 commit b389e1779651f2c58454a5f98acebd3dd7bc0061 Merge: 5f03b4d e427972 Author: Prameet Shah Date: Thu Jul 24 19:46:28 2014 +0000 am e427972e: OpenSSLEngineImpl: fix unwrap behavior with array * commit e427972eb6141cd67e6d4c9607863a8d990e6be6: OpenSSLEngineImpl: fix unwrap behavior with array commit 5f03b4d63c7632581b032879de791dc82f05ffa0 Merge: 3d935ee 41eb5b6 Author: Prameet Shah Date: Tue Jul 22 19:26:41 2014 +0000 am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 41eb5b65e524d01e28da474bd37e4349b12fb494: OpenSSLEngineImpl: fix unwrap behavior with array commit 41eb5b65e524d01e28da474bd37e4349b12fb494 Author: Prameet Shah Date: Tue Jul 22 11:50:18 2014 OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b commit 3d935eeca25e00b56cfd8d37a657c7b2986889b3 Merge: 0a36f6c affd45a Author: Alex Klyubin Date: Fri Jul 18 00:32:14 2014 +0000 am affd45a4: Merge ""Improve the Javadoc of PSKKeyManager."" into lmp-dev * commit affd45a413cf844dad797ad4972074efb9de43d8: Improve the Javadoc of PSKKeyManager. commit 0a36f6c1f8b2e195c2dd5aea1a386df090c6d470 Merge: 6492180 af4fa68 Author: rich cannings Date: Thu Jul 17 23:47:33 2014 +0000 am af4fa685: Merge ""Log CCS exceptions do not merge."" into lmp-dev * commit af4fa685f246aaa80c93af62faadbc2fe87dc034: Log CCS exceptions do not merge. commit 6492180ce17a3b5ff822cff1783f00e7a4176491 Merge: aac4168 3b7268c Author: Alex Klyubin Date: Thu Jul 17 18:27:39 2014 +0000 am 3b7268cd: Merge ""Improve the Javadoc of PSKKeyManager."" * commit 3b7268cde4a4fc59591da8a93691927ebf3add57: Improve the Javadoc of PSKKeyManager. commit aac4168d8baef7e12d6fa959c6d6ded9892e9651 Merge: 8573ad0 a749c0d Author: Kenny Root Date: Thu Jul 17 17:07:05 2014 +0000 am a749c0d3: Keep enough state to completely reset cipher instances * commit a749c0d351216be38879600ee8ed01c6793aa256: Keep enough state to completely reset cipher instances commit 8573ad0ddcf7e2f8b2e5ac84c34b7ffab303155c Merge: 4ca5b06 70fdb6d Author: Koushik Dutta Date: Thu Jul 17 17:06:36 2014 +0000 am 70fdb6d2: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit 70fdb6d2bfa0c313fe389827f0025288f6aeb947: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit 4ca5b0625e3f5a15ae8adf833ab5a69f9d7d517f Merge: 119abfb ded66f5 Author: Koushik Dutta Date: Thu Jul 17 17:06:35 2014 +0000 am ded66f5f: Various fixes in OpenSSLEngineImpl. * commit ded66f5f696994ce7620552e16a4e9124e69e052: Various fixes in OpenSSLEngineImpl. commit 119abfba1fcd9c9cfbd15d0a4ca9ed2188fdfab0 Merge: 5713cdf cbe1f28 Author: Kenny Root Date: Thu Jul 17 15:56:57 2014 +0000 am cbe1f28a: Merge ""Keep enough state to completely reset cipher instances"" * commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae: Keep enough state to completely reset cipher instances commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae Merge: e08f238 084e308 Author: Kenny Root Date: Thu Jul 17 15:48:58 2014 +0000 Merge ""Keep enough state to completely reset cipher instances"" commit 3b7268cde4a4fc59591da8a93691927ebf3add57 Merge: cbe1f28 7ac13e0 Author: Alex Klyubin Date: Thu Jul 17 18:20:43 2014 +0000 Merge ""Improve the Javadoc of PSKKeyManager."" commit 5713cdf71c5c6e5179e8369263c702e9512afdd0 Merge: cf55719 e08f238 Author: Koushik Dutta Date: Wed Jul 16 22:05:17 2014 +0000 am e08f2385: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit e08f238580e8ee471012bef8240c8d3397c7b780: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit cf557195a9b60d7f51a48500afde38481ddbc91c Merge: cbbd7d1 986aeb7 Author: Kenny Root Date: Wed Jul 16 21:41:12 2014 +0000 am 986aeb78: Merge ""Various fixes in OpenSSLEngineImpl."" * commit 986aeb78e533540463daf1753e24840f75b25ce6: Various fixes in OpenSSLEngineImpl. commit e08f238580e8ee471012bef8240c8d3397c7b780 Author: Koushik Dutta Date: Tue Jul 15 22:40:23 2014 OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. Change-Id: Idc78204b7077fb367b64e1867c807cd39f596f98 commit 7ac13e03a79d0c99d181b1a28b1b3699ba3d5739 Author: Alex Klyubin Date: Wed Jul 16 08:33:02 2014 Improve the Javadoc of PSKKeyManager. This clarifies several points and adds sample code. Bug: 15073623 Change-Id: I6e8aadc52277e238a998d6cee36795dab1151d58 commit 986aeb78e533540463daf1753e24840f75b25ce6 Merge: 8f9ac1a bdfcc18 Author: Kenny Root Date: Wed Jul 16 21:15:30 2014 +0000 Merge ""Various fixes in OpenSSLEngineImpl."" commit bdfcc189efe41a3f812aeb55ea634bace67d159a Author: Koushik Dutta Date: Sat Jun 28 19:19:21 2014 Various fixes in OpenSSLEngineImpl. Fix ""Buffers were not large enough"" exception by directly using the destination buffers. Corrections around bytesProduced and bytesConsumed behavior. Return BUFFER_OVERFLOW if a zero length destination is provided to unwrap. Change-Id: I1f1e9b72cd6968ed4f3c3c0edccbccebc33d6790 commit cbbd7d10e8e484c44a78e5b27e8fecda195f1692 Merge: ec7f8e6 fdb7d8c Author: Alex Klyubin Date: Tue Jul 15 18:49:14 2014 +0000 am fdb7d8c5: Enable PSK cipher suites when PSKKeyManager is provided. * commit fdb7d8c53dabac5551e2499d045ba6829bcfc0a0: Enable PSK cipher suites when PSKKeyManager is provided. commit ec7f8e6b27330160f88540f4f2ace7bc2a0720a3 Merge: 5b8ccf1 8f9ac1a Author: Alex Klyubin Date: Tue Jul 15 15:53:46 2014 +0000 am 8f9ac1af: Enable PSK cipher suites when PSKKeyManager is provided. * commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17: Enable PSK cipher suites when PSKKeyManager is provided. commit 5b8ccf1b09df6f35c1709bfc8fd727a291094a5b Merge: 69a2e46 6e2315f Author: Ed Heyl Date: Tue Jul 15 13:34:25 2014 +0000 am 6e2315fd: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. * commit 6e2315fd96c3c4a47450c1a437babacc94bc31a6: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. commit 084e3086be1d7a6b9280b64c7c8cdb7b41a13bea Author: Kenny Root Date: Mon Jul 14 13:25:32 2014 Keep enough state to completely reset cipher instances OpenSSLs RC4 mutates the given key. AES/CTR mutates the IV. We must store these values locally to enable ""doFinal"" to cause the Cipher instance to be reset to what it was right after ""init"". Note that resetting and encrypting with the same key or IV breaks semantic security. Bug: 16298401 Bug: Change-Id: Ie7e4dcb6cf6cc33ddad31d6b47066dc1b34e6894 commit 69a2e460cc0a40e1b951e400589b9932609079ec Merge: 8b7bb32 bca895f Author: David Benjamin Date: Mon Jul 14 18:17:28 2014 +0000 am bca895f8: Pass output buffer length into EVP_DigestSignFinal. * commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d: Pass output buffer length into EVP_DigestSignFinal. commit 8b7bb32af09a01e80442b70dd23e6997a937f103 Merge: a2404c9 e79c25b Author: Kenny Root Date: Mon Jul 14 18:17:28 2014 +0000 am e79c25bf: Merge ""DHKeyPairGenerator: use provided params"" * commit e79c25bf33e10da41e489c537823f678e1a1169c: DHKeyPairGenerator: use provided params commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17 Author: Alex Klyubin Date: Thu Jun 19 13:37:24 2014 Enable PSK cipher suites when PSKKeyManager is provided. This enables TLS-PSK cipher suites by default iff SSLContext is initialized with a PSKKeyManager. For consistency, X.509 based cipher suites are no longer enabled by default at all times they are now only enabled by default iff SSLContext is initialized with a X509KeyManager or a X509TrustManager. When both X.509 and PSK cipher suites need to be enabled, PSK cipher suites are given higher priority in the resulting list of cipher suites. This is based on the assumption that in most cases users of TLS/SSL who enable TLS-PSK would prefer TLS-PSK to be used when the peer supports TLS-PSK. Bug: 15073623 Change-Id: I8e2bc3e7a1ea8a986e468973b6bad19dc6b7bc3c commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d Author: David Benjamin Date: Thu Jul 10 18:12:08 2014 Pass output buffer length into EVP_DigestSignFinal. EVP_DigestSignFinal expects the input buffer length as *siglen on input. In addition, if sigret is NULL, it returns the buffer size needed. Use this rather than making assumptions about the EVP_PKEY used to initialize the EVP_MD_CTX. commit e79c25bf33e10da41e489c537823f678e1a1169c Merge: a328492 9b226f9 Author: Kenny Root Date: Fri Jul 11 16:46:23 2014 +0000 Merge ""DHKeyPairGenerator: use provided params"" commit 9b226f90a992a4a2267b7a813e3b869851945c4d Author: Kenny Root Date: Thu Jul 10 14:50:48 2014 DHKeyPairGenerator: use provided params If the prime is provided in the DHParameterSpec, then use it to generate the key. Bug: 16188130 Change-Id: I42de02c71a58d691ef7ba6e2252367105687b758 Bug: 18388980 Change-Id: I853b02a32db113a5af3f6166e7d61fab58c3ff73/"
,,0.2851,conscrypt,"Call EVP_CIPHER_CTX_free instead of EVP_CIPHER_CTX_cleanup. The latter doesnt OpenSSL_free memory allocated by EVP_CIPHER_CTX_new. Its worth noting that EVP_CIPHER_CTX_free doesnt check the return value of EVP_CIPHER_CTX_cleanup so we cant throw if cleanup failed, but we were only ever calling this method from a finalizer anyway. bug: 18617384 Change-Id: Ida65e14ffbed41f56a59e2f5fe77289cac0f5947/Convert EC_GROUP and EC_POINT to new style Bug: 16656908 Change-Id: Ie912f376f69327ce634cac50763bf86b418049f5/Switch EVP_CIPHER_CTX to new style Bug: 16656908 Change-Id: Id519c20474a02c70e72d362bc84d26855a74fa33/Convert EVP_PKEY to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. This pass fixes EVP_PKEY references, but more passes are needed. Bug: 16656908 Change-Id: I5925da40cb37cd328b3a126404944f771732a43e/Convert EVP_MD_CTX to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. Bug: 16656908 Change-Id: I165e041a8fe056770d6ce6d6cd064c411575b7c4/Remove Conscrypt support for DSA BoringSSL removes support for DSA, so theres no point in maintaining this now. There have been virtually zero SSL certificates issued using DSA for many years as well. Change-Id: Id940643b85ba39b03038aabc6da9ec0285db66c4/am 7b7d2e3c: am b9bfe69f: Fix null elements in X509KeyManager.chooseClientAlias keyTypes. * commit 7b7d2e3cb2ea60307c332de6441da78942145a1c: Fix null elements in X509KeyManager.chooseClientAlias keyTypes./Remove support for DSS TLS/SSL cipher suites. This is in preparation for migration from OpenSSL to BoringSSL. BoringSSL does not support DSS. DSS cipher suites are used by a vanishingly tiny fraction of the Android ecosystem. In all cases, the servers SSL certificate is self-signed (rather than CA issued), making it easy to switch to a new self-signed certificate which is based on RSA or ECDSA. Bug: 17409664 Change-Id: I91067ca9df764edd2b7820e5dec995f24f3910a1/am b9bfe69f: Fix null elements in X509KeyManager.chooseClientAlias keyTypes. * commit b9bfe69f1c205ab67a03e10a01e2cc90871a0879: Fix null elements in X509KeyManager.chooseClientAlias keyTypes./Fix null elements in X509KeyManager.chooseClientAlias keyTypes. This fixes an issue where client certificate types requested by the server from the client, but not known by the client, manifest themselves as null elements in X509KeyManager.chooseClientAlias keyTypes argument. The root cause was that for each element in the CertificateRequest.certificate_types array an element was output into the keyTypes array. For unknown values of certificate_type, a null was output. This CL fixes the issue by ignoring unknown values in certificate_types array. Bug: 18414726 Change-Id: I8565e19a610c0ecfb7cab1b7707c335e0eeb8d89/"
,,0.9004,conscrypt,"Squashed commit of changes from lmp-ub-dev Contains the following changes: commit e31d982cdb0f8e6ef05d1e412576888015e1da17 Merge: eaebc54 b73be72 Author: Neil Fuller Date: Wed Oct 22 10:34:23 2014 +0000 am b73be72e: am 3e21a289: (-s ours) TLS_FALLBACK_SCSV CTS fix for klp-modular-dev * commit b73be72ed97da8f36450d95d52f485cc6f451c61: TLS_FALLBACK_SCSV CTS fix for klp-modular-dev commit eaebc544f3a10c53d7d2f908514122caba569e14 Merge: 223b5da cd50afa Author: Kenny Root Date: Tue Oct 14 17:30:19 2014 +0000 Merge ""Fix SSLEngine to support session resumption."" into lmp-ub-dev commit 223b5da5d70e47b1a497e86474493925b568f6d7 Merge: 8737796 cb7a360 Author: Neil Fuller Date: Thu Oct 9 14:52:00 2014 +0000 am cb7a3605: am ea961ada: Apply conscrypt changes from merge commit * commit cb7a36050f34d3c16be00d532411820761eeb276: Apply conscrypt changes from merge commit commit cd50afad1567b1311e6e979e94a7167b7bf69c94 Author: Doug Steedman Date: Mon Oct 6 13:16:15 2014 Fix SSLEngine to support session resumption. Bug: 17877118 Change-Id: I388b59cde58fdc506ecac9f536e4bbd9161df6ad commit 8737796a646eaec94df32827752a71aee74bd46f Merge: 9564a5f 8d7e23e Author: Kenny Root Date: Mon Oct 6 22:34:20 2014 +0000 am 8d7e23e1: Add support for TLS_FALLBACK_SCSV * commit 8d7e23e117da591a8d48e6bcda9ed6f58ff1a375: Add support for TLS_FALLBACK_SCSV commit 9564a5fb9ed2eecf6299788db35213cb08397212 Merge: 4f58feb 7640613 Author: Kenny Root Date: Fri Sep 12 17:27:23 2014 +0000 am 76406135: am 6dcb23fe: am f427ec90: Fix the ENGINE_finish/ENGINE_free mixup * commit 76406135cf3a3b88afc979fe8e847b9c3d8b93c1: Fix the ENGINE_finish/ENGINE_free mixup commit 4f58feb0ea49dc089a95efba196032ef3c960a39 Merge: ddac5c6 984b7ec Author: Kenny Root Date: Wed Sep 10 07:07:16 2014 +0000 am 984b7ec6: Fix the ENGINE_finish/ENGINE_free mixup * commit 984b7ec6f5aab314117949a48e448ff4f6b65f16: Fix the ENGINE_finish/ENGINE_free mixup commit ddac5c6d7e413b0d68b388fbdf70dbeb3eeae865 Merge: 5a8ca5b 36ba60b Author: Kenny Root Date: Thu Sep 4 22:41:38 2014 +0000 Merge ""Reset lmp-ub-dev to lmp-dev-plus-aosp"" into lmp-ub-dev commit 36ba60b039f1f30ab1ea8f0e2a4da8ae4e3906e5 Author: Kenny Root Date: Wed Aug 27 12:07:07 2014 Reset lmp-ub-dev to lmp-dev-plus-aosp Bug: 17059757 Change-Id: I581963360da47b574e1e2e20c2851485c36fa62c commit 6a4f2ef9e4ea3ebb321d45ca39b30d634ea3b4ad Merge: 9b187af f67d784 Author: Kenny Root Date: Tue Aug 26 04:17:38 2014 +0000 am f67d784a: Add pre-Honeycomb literal IP matching * commit f67d784abe5cef700240be02c68cecd899cd8e6d: Add pre-Honeycomb literal IP matching commit 9b187af33dcd97915a0371d64fe1ee4aba20d0ba Merge: 714ebea 966ae8a Author: Kenny Root Date: Tue Aug 26 04:17:37 2014 +0000 am 966ae8a6: Read property to enable SNI * commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb: Read property to enable SNI commit 714ebeabcb5e35c6df6a5c21f549cdb6130368c4 Merge: 7724204 54a1ba4 Author: Kenny Root Date: Tue Aug 26 04:06:54 2014 +0000 Merge ""resolved conflicts for merge of 342097db to lmp-dev-plus-aosp"" into lmp-dev-plus-aosp commit 54a1ba421d23bb6d988688c2662715e509172447 Merge: a20d871 342097d Author: Kenny Root Date: Mon Aug 25 21:03:51 2014 resolved conflicts for merge of 342097db to lmp-dev-plus-aosp Change-Id: I853c6b0d3725dafbdc84c4d6d6d1b90529bd949d commit 7724204abf4431d35787c44c4a22cda5489d4e37 Merge: 20f60ac afb3403 Author: Kenny Root Date: Tue Aug 26 00:09:27 2014 +0000 am afb34034: Implement write socket timeouts for unbundled apps * commit afb340348bfc54dbc46964e159fe803f9c93a4dd: Implement write socket timeouts for unbundled apps commit f67d784abe5cef700240be02c68cecd899cd8e6d Author: Kenny Root Date: Wed Aug 20 14:14:26 2014 Add pre-Honeycomb literal IP matching This will allow us to run this code on Gingerbread devices and others that dont have the InetAddress#isNumeric API. Bug: 16658420 Bug: 17059757 Change-Id: I597d539979d58eeaa2677d6f99e911313a550cc1 commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb Author: Kenny Root Date: Mon Aug 18 10:12:20 2014 Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9 commit 342097db97a9b2736531033b2c4b4d8ce4998c67 Author: Kenny Root Date: Wed Aug 20 12:14:52 2014 Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208 commit afb340348bfc54dbc46964e159fe803f9c93a4dd Author: Kenny Root Date: Tue Aug 19 16:33:07 2014 Implement write socket timeouts for unbundled apps Change-Id: I4fd604f057ba4288d4f31bf6b3b93307376023d5 commit 20f60acea153dfdf0c8f75a53d7bd9edb4c7614c Author: Kenny Root Date: Mon Aug 25 11:52:05 2014 Tracking change from AOSP Change-Id: I889af3f7c1de9ef34d9328339e1b421651055ad4 commit 68056b7c9db8a9fb384bbadfc5287730f996896d Merge: 8239dfd cc2ef2e Author: Kenny Root Date: Mon Aug 25 18:03:27 2014 +0000 am cc2ef2e2: Rename hostname fields and methods to reflect usage * commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e: Rename hostname fields and methods to reflect usage commit 8239dfdcc40a69255d7b2feced960d574ea36321 Merge: e9cf759 076138f Author: Kenny Root Date: Thu Aug 21 16:36:24 2014 +0000 am 076138ff: Use consistent naming for SSLSocket arguments * commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11: Use consistent naming for SSLSocket arguments commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e Author: Kenny Root Date: Wed Aug 20 11:26:33 2014 Rename hostname fields and methods to reflect usage The hostname that was supplied when the socket was created is stored as the ""peerHostname"" This is the only one that should be used for Server Name Indication (SNI) purposes. The ""peerHostname"" or the resolved IP address may be used for certificate validation, so keep the use of ""getHostname()"" for cerificate validation. Bug: 16658420 Bug: 17059757 Change-Id: Ifd87dead44fb2f00bbfd5eac7e69fb3fc98e94b4 commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11 Author: Kenny Root Date: Wed Aug 20 11:24:41 2014 Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650 commit e9cf759ac89fb053c01f1db19931beb14a823618 Merge: ababdd1 7ed0fae Author: Kenny Root Date: Tue Aug 19 19:32:43 2014 +0000 am 7ed0fae1: OpenSSLEngineImpl: reduce number of copies needed * commit 7ed0fae1906061766d0042e69ccba20e4a702bbe: OpenSSLEngineImpl: reduce number of copies needed commit 7ed0fae1906061766d0042e69ccba20e4a702bbe Author: Kenny Root Date: Tue Jul 22 13:03:09 2014 OpenSSLEngineImpl: reduce number of copies needed When the ByteBuffer didnt line up exactly with the backing array, it would allocate a new buffer to write into. Instead, add the ability for OpenSSL to read at an offset in the given array so a copy isnt needed. Change-Id: I149d3f94e4b5cbdc010df80439ae3300cbdc87a5 commit ababdd1ae1272eac174e3a449a413ab35afbc435 Merge: 66c31e0 4b050b6 Author: Kenny Root Date: Fri Aug 15 16:23:14 2014 +0000 am 4b050b6f: OpenSSLSocketImpl: Move state checks inside mutex * commit 4b050b6fb06fbb804557eecc72cc4ff0e0277525: OpenSSLSocketImpl: Move state checks inside mutex commit 66c31e0b613ceefc167a2e1fb226a14c78f84537 Merge: f4b895a 0931d51 Author: Kenny Root Date: Thu Aug 14 20:46:43 2014 +0000 am 0931d51c: OpenSSLSocketImpl: Move state checks inside mutex * commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706: OpenSSLSocketImpl: Move state checks inside mutex commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706 Author: Kenny Root Date: Tue Aug 5 15:45:32 2014 OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 Change-Id: I5ecdeb1551a13098d1b66c5e4009607c9951fa38 commit f4b895ae9c424b5c2d49c744131606adccbc49d7 Merge: a35c400 a260ee6 Author: Kenny Root Date: Wed Aug 13 15:35:28 2014 +0000 am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit a260ee6d0caea43f8010f158a4a35fb712935ae3: Revert ""Revert ""Automatic management of OpenSSL error stack"""" commit a35c40017c8690f821351d6460dfeaa2738b884c Merge: 0edc483 30550a8 Author: Kenny Root Date: Wed Aug 13 15:35:27 2014 +0000 am 30550a8b: Fix debugging with unbundled conscrypt * commit 30550a8b64bbcd6ca537680a17b8726932a29937: Fix debugging with unbundled conscrypt commit a260ee6d0caea43f8010f158a4a35fb712935ae3 Author: Kenny Root Date: Tue Aug 12 15:38:10 2014 Revert ""Revert ""Automatic management of OpenSSL error stack"""" The ""else"" statement in OpenSslError::reset wasnt properly resetting the error state which made a second call into sslRead jump into sslSelect when it should have just returned immediately. Change-Id: I22e8025c0497a04e78daa07cef78191a6ca1a70c commit 30550a8b64bbcd6ca537680a17b8726932a29937 Author: Kenny Root Date: Tue Aug 12 15:13:33 2014 Fix debugging with unbundled conscrypt When JNI_TRACE was enabled, there were missing defines for the debugging code since no platform code is included. Also clang complains about more of the debugging statement formats, so we have to move some things around to get it to be happy. Change-Id: I1a6695c2ef2639cc01cfc3d3a8603f010c659844 commit 0edc4833091846d6cb45961fc9458df842fbbad9 Merge: 107a8fb 2411b8b Author: Kenny Root Date: Tue Aug 12 21:46:12 2014 +0000 am 2411b8bd: Merge ""Revert ""Automatic management of OpenSSL error stack"""" * commit 2411b8bdcde72c956f4150e9a5909b7501f50bad: Revert ""Automatic management of OpenSSL error stack"" commit 2411b8bdcde72c956f4150e9a5909b7501f50bad Merge: 3262a8c b514d72 Author: Kenny Root Date: Tue Aug 12 21:39:32 2014 +0000 Merge ""Revert ""Automatic management of OpenSSL error stack"""" commit b514d72b93c3996d97e38eca6db1ad684965fd9b Author: Kenny Root Date: Tue Aug 12 21:39:17 2014 +0000 Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef commit 107a8fba8be5be57933f2638b76ac1243b578b9e Merge: 1de007f 3262a8c Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 3262a8c2741b95103149bcdefe2409c24bfddee9: Automatic management of OpenSSL error stack commit 1de007f9f01be8f07a56235dd924c897088a03cb Merge: 94890ae d1bbcd0 Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am d1bbcd0e: Relax checks for key vs cert for wrapped keys * commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484: Relax checks for key vs cert for wrapped keys commit 3262a8c2741b95103149bcdefe2409c24bfddee9 Merge: d1bbcd0 35666e4 Author: Kenny Root Date: Tue Aug 12 15:31:02 2014 +0000 Merge ""Automatic management of OpenSSL error stack"" commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484 Author: Kenny Root Date: Mon Aug 11 14:56:58 2014 Relax checks for key vs cert for wrapped keys If a key is a wrapped platform key, we must relax the check. The reason is that we may not have the public values we need to pass the EVP_PKEY_cmp checks that this does. Change-Id: I7ab2be51b0968a9cf771edea01d33fe2367c8185 commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8 Author: Kenny Root Date: Tue Aug 5 11:05:00 2014 Automatic management of OpenSSL error stack This removes some complexity in remembering to free the OpenSSL error stack. If you forget, the error will stick around until you make another call. Change-Id: I245a525dcc93077b2bf9909a14a0ef469a2daca4 commit 94890aec5735cde2ea5170fb76cd1b847ea66af8 Merge: 8360485 977f087 Author: Kenny Root Date: Tue Aug 5 16:44:42 2014 +0000 am 977f0877: Fix some JNI_TRACE lines * commit 977f08774c628b4640d5454cde050259856965f8: Fix some JNI_TRACE lines commit 977f08774c628b4640d5454cde050259856965f8 Author: Kenny Root Date: Mon Aug 4 12:15:04 2014 Fix some JNI_TRACE lines During debugging these would be enabled, but they were copy-pastad to with the wrong args. Change-Id: I23f39ff4807e3fa71f3220912aec3c99db6b9454 commit 83604854c5160304cafefc9bd40a72c5ee8506eb Merge: 7db3524 1ffe43e Author: Zoltan Szatmary-Ban Date: Thu Jul 31 13:28:57 2014 +0000 am 1ffe43e8: Merge ""Add possibility to get deleted system Certificate Aliases"" into lmp-dev * commit 1ffe43e8277e883c6663c1fb7cfc5e18ba552c40: Add possibility to get deleted system Certificate Aliases commit 7db3524880092126962b7f502af76b4c84da7350 Merge: 5767d63 ad0cd83 Author: Prameet Shah Date: Wed Jul 30 17:04:13 2014 +0000 am ad0cd830: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit ad0cd83024f38011043d28d70370a8638b88cd72: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 5767d63d22e87becab387b3bd6597fe41eb34d7e Merge: b389e17 26163c2 Author: Prameet Shah Date: Wed Jul 30 16:31:08 2014 +0000 am 26163c26: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit 26163c268a6d2625384b87e907afad8ef19f9a47: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 26163c268a6d2625384b87e907afad8ef19f9a47 Author: Prameet Shah Date: Tue Jul 29 16:45:31 2014 Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700 commit b389e1779651f2c58454a5f98acebd3dd7bc0061 Merge: 5f03b4d e427972 Author: Prameet Shah Date: Thu Jul 24 19:46:28 2014 +0000 am e427972e: OpenSSLEngineImpl: fix unwrap behavior with array * commit e427972eb6141cd67e6d4c9607863a8d990e6be6: OpenSSLEngineImpl: fix unwrap behavior with array commit 5f03b4d63c7632581b032879de791dc82f05ffa0 Merge: 3d935ee 41eb5b6 Author: Prameet Shah Date: Tue Jul 22 19:26:41 2014 +0000 am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 41eb5b65e524d01e28da474bd37e4349b12fb494: OpenSSLEngineImpl: fix unwrap behavior with array commit 41eb5b65e524d01e28da474bd37e4349b12fb494 Author: Prameet Shah Date: Tue Jul 22 11:50:18 2014 OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b commit 3d935eeca25e00b56cfd8d37a657c7b2986889b3 Merge: 0a36f6c affd45a Author: Alex Klyubin Date: Fri Jul 18 00:32:14 2014 +0000 am affd45a4: Merge ""Improve the Javadoc of PSKKeyManager."" into lmp-dev * commit affd45a413cf844dad797ad4972074efb9de43d8: Improve the Javadoc of PSKKeyManager. commit 0a36f6c1f8b2e195c2dd5aea1a386df090c6d470 Merge: 6492180 af4fa68 Author: rich cannings Date: Thu Jul 17 23:47:33 2014 +0000 am af4fa685: Merge ""Log CCS exceptions do not merge."" into lmp-dev * commit af4fa685f246aaa80c93af62faadbc2fe87dc034: Log CCS exceptions do not merge. commit 6492180ce17a3b5ff822cff1783f00e7a4176491 Merge: aac4168 3b7268c Author: Alex Klyubin Date: Thu Jul 17 18:27:39 2014 +0000 am 3b7268cd: Merge ""Improve the Javadoc of PSKKeyManager."" * commit 3b7268cde4a4fc59591da8a93691927ebf3add57: Improve the Javadoc of PSKKeyManager. commit aac4168d8baef7e12d6fa959c6d6ded9892e9651 Merge: 8573ad0 a749c0d Author: Kenny Root Date: Thu Jul 17 17:07:05 2014 +0000 am a749c0d3: Keep enough state to completely reset cipher instances * commit a749c0d351216be38879600ee8ed01c6793aa256: Keep enough state to completely reset cipher instances commit 8573ad0ddcf7e2f8b2e5ac84c34b7ffab303155c Merge: 4ca5b06 70fdb6d Author: Koushik Dutta Date: Thu Jul 17 17:06:36 2014 +0000 am 70fdb6d2: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit 70fdb6d2bfa0c313fe389827f0025288f6aeb947: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit 4ca5b0625e3f5a15ae8adf833ab5a69f9d7d517f Merge: 119abfb ded66f5 Author: Koushik Dutta Date: Thu Jul 17 17:06:35 2014 +0000 am ded66f5f: Various fixes in OpenSSLEngineImpl. * commit ded66f5f696994ce7620552e16a4e9124e69e052: Various fixes in OpenSSLEngineImpl. commit 119abfba1fcd9c9cfbd15d0a4ca9ed2188fdfab0 Merge: 5713cdf cbe1f28 Author: Kenny Root Date: Thu Jul 17 15:56:57 2014 +0000 am cbe1f28a: Merge ""Keep enough state to completely reset cipher instances"" * commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae: Keep enough state to completely reset cipher instances commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae Merge: e08f238 084e308 Author: Kenny Root Date: Thu Jul 17 15:48:58 2014 +0000 Merge ""Keep enough state to completely reset cipher instances"" commit 3b7268cde4a4fc59591da8a93691927ebf3add57 Merge: cbe1f28 7ac13e0 Author: Alex Klyubin Date: Thu Jul 17 18:20:43 2014 +0000 Merge ""Improve the Javadoc of PSKKeyManager."" commit 5713cdf71c5c6e5179e8369263c702e9512afdd0 Merge: cf55719 e08f238 Author: Koushik Dutta Date: Wed Jul 16 22:05:17 2014 +0000 am e08f2385: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit e08f238580e8ee471012bef8240c8d3397c7b780: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit cf557195a9b60d7f51a48500afde38481ddbc91c Merge: cbbd7d1 986aeb7 Author: Kenny Root Date: Wed Jul 16 21:41:12 2014 +0000 am 986aeb78: Merge ""Various fixes in OpenSSLEngineImpl."" * commit 986aeb78e533540463daf1753e24840f75b25ce6: Various fixes in OpenSSLEngineImpl. commit e08f238580e8ee471012bef8240c8d3397c7b780 Author: Koushik Dutta Date: Tue Jul 15 22:40:23 2014 OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. Change-Id: Idc78204b7077fb367b64e1867c807cd39f596f98 commit 7ac13e03a79d0c99d181b1a28b1b3699ba3d5739 Author: Alex Klyubin Date: Wed Jul 16 08:33:02 2014 Improve the Javadoc of PSKKeyManager. This clarifies several points and adds sample code. Bug: 15073623 Change-Id: I6e8aadc52277e238a998d6cee36795dab1151d58 commit 986aeb78e533540463daf1753e24840f75b25ce6 Merge: 8f9ac1a bdfcc18 Author: Kenny Root Date: Wed Jul 16 21:15:30 2014 +0000 Merge ""Various fixes in OpenSSLEngineImpl."" commit bdfcc189efe41a3f812aeb55ea634bace67d159a Author: Koushik Dutta Date: Sat Jun 28 19:19:21 2014 Various fixes in OpenSSLEngineImpl. Fix ""Buffers were not large enough"" exception by directly using the destination buffers. Corrections around bytesProduced and bytesConsumed behavior. Return BUFFER_OVERFLOW if a zero length destination is provided to unwrap. Change-Id: I1f1e9b72cd6968ed4f3c3c0edccbccebc33d6790 commit cbbd7d10e8e484c44a78e5b27e8fecda195f1692 Merge: ec7f8e6 fdb7d8c Author: Alex Klyubin Date: Tue Jul 15 18:49:14 2014 +0000 am fdb7d8c5: Enable PSK cipher suites when PSKKeyManager is provided. * commit fdb7d8c53dabac5551e2499d045ba6829bcfc0a0: Enable PSK cipher suites when PSKKeyManager is provided. commit ec7f8e6b27330160f88540f4f2ace7bc2a0720a3 Merge: 5b8ccf1 8f9ac1a Author: Alex Klyubin Date: Tue Jul 15 15:53:46 2014 +0000 am 8f9ac1af: Enable PSK cipher suites when PSKKeyManager is provided. * commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17: Enable PSK cipher suites when PSKKeyManager is provided. commit 5b8ccf1b09df6f35c1709bfc8fd727a291094a5b Merge: 69a2e46 6e2315f Author: Ed Heyl Date: Tue Jul 15 13:34:25 2014 +0000 am 6e2315fd: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. * commit 6e2315fd96c3c4a47450c1a437babacc94bc31a6: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. commit 084e3086be1d7a6b9280b64c7c8cdb7b41a13bea Author: Kenny Root Date: Mon Jul 14 13:25:32 2014 Keep enough state to completely reset cipher instances OpenSSLs RC4 mutates the given key. AES/CTR mutates the IV. We must store these values locally to enable ""doFinal"" to cause the Cipher instance to be reset to what it was right after ""init"". Note that resetting and encrypting with the same key or IV breaks semantic security. Bug: 16298401 Bug: Change-Id: Ie7e4dcb6cf6cc33ddad31d6b47066dc1b34e6894 commit 69a2e460cc0a40e1b951e400589b9932609079ec Merge: 8b7bb32 bca895f Author: David Benjamin Date: Mon Jul 14 18:17:28 2014 +0000 am bca895f8: Pass output buffer length into EVP_DigestSignFinal. * commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d: Pass output buffer length into EVP_DigestSignFinal. commit 8b7bb32af09a01e80442b70dd23e6997a937f103 Merge: a2404c9 e79c25b Author: Kenny Root Date: Mon Jul 14 18:17:28 2014 +0000 am e79c25bf: Merge ""DHKeyPairGenerator: use provided params"" * commit e79c25bf33e10da41e489c537823f678e1a1169c: DHKeyPairGenerator: use provided params commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17 Author: Alex Klyubin Date: Thu Jun 19 13:37:24 2014 Enable PSK cipher suites when PSKKeyManager is provided. This enables TLS-PSK cipher suites by default iff SSLContext is initialized with a PSKKeyManager. For consistency, X.509 based cipher suites are no longer enabled by default at all times they are now only enabled by default iff SSLContext is initialized with a X509KeyManager or a X509TrustManager. When both X.509 and PSK cipher suites need to be enabled, PSK cipher suites are given higher priority in the resulting list of cipher suites. This is based on the assumption that in most cases users of TLS/SSL who enable TLS-PSK would prefer TLS-PSK to be used when the peer supports TLS-PSK. Bug: 15073623 Change-Id: I8e2bc3e7a1ea8a986e468973b6bad19dc6b7bc3c commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d Author: David Benjamin Date: Thu Jul 10 18:12:08 2014 Pass output buffer length into EVP_DigestSignFinal. EVP_DigestSignFinal expects the input buffer length as *siglen on input. In addition, if sigret is NULL, it returns the buffer size needed. Use this rather than making assumptions about the EVP_PKEY used to initialize the EVP_MD_CTX. commit e79c25bf33e10da41e489c537823f678e1a1169c Merge: a328492 9b226f9 Author: Kenny Root Date: Fri Jul 11 16:46:23 2014 +0000 Merge ""DHKeyPairGenerator: use provided params"" commit 9b226f90a992a4a2267b7a813e3b869851945c4d Author: Kenny Root Date: Thu Jul 10 14:50:48 2014 DHKeyPairGenerator: use provided params If the prime is provided in the DHParameterSpec, then use it to generate the key. Bug: 16188130 Change-Id: I42de02c71a58d691ef7ba6e2252367105687b758 Bug: 18388980 Change-Id: I853b02a32db113a5af3f6166e7d61fab58c3ff73/Enable SNI by default in platform-bundled Conscrypt. The benefit of enabling SNI by default is that is makes it easier to setup/move to virtual hosting, and also use more specific/restricted SSL certificates without having to modify clients. SNI is so widely deployed these days that it is not expected to cause any significant issues by being on by default. Moreover, its on by default in the RI. Bug: 16658420 Change-Id: I0d5d13152ffcc3cf1e01afe7a45f69e7aaf6d4bc/"
,,0.7663,conscrypt,"change NativeCrypto_X509_CRL_get_ext return data type from int to long root cause: NativeCrypto_X509_CRL_get_ext return the wrong data type. NativeCrypto_X509_CRL_get_ext return int data type will cut return value from 8 bytes to 4 bytes in 64 bit system. So change int to long. NativeCrypto_X509_REVOKED_get_ext may has the same problem. Change-Id: I97be716f82e846a5dfe3cef77b68faff79235d9b Signed-off-by: Yong Yao an empty BIO memory buffer with BoringSSL. de5225d1 mistakenly switched a BIO_s_null to an empty mem-BIO in order to allow BoringSSL to work. That worked for BoringSSL, but OpenSSL treats an empty mem-BIO as an error and so that was switched back in 2fe55c8f. This change uses an empty mem-BIO with BoringSSL again for the same reasons, but guards the change with the preprocessor so that it doesnt break OpenSSL. Change-Id: If90b7a151bf124722d91f150b441e0c9f5b96b03/am 4497fdc7: Treat SSL_ERROR_ZERO_RETURN correctly. * commit 4497fdc7e8a775eccb882b42a9314de09ee6c67f: Treat SSL_ERROR_ZERO_RETURN correctly./Treat SSL_ERROR_ZERO_RETURN correctly. According to ssl_lib.c, this is returned whenever the socket is being closed (s->shutdown && SSL_RECEIVED_SHUTDOWN && s->s3->warn_alert SSL_AD_CLOSE_NOTIFY). (cherry picked from commit f6c8f8b4891a91178e45b90f34f9d8c97737044a) Bug: 18758595 Change-Id: Ied7b3e18f11786351d42a770f4cad11ddae29ff3/am f5709028: am f6c8f8b4: Treat SSL_ERROR_ZERO_RETURN correctly. * commit f57090289ca8f99ebed84f0bf65ff63b4c8c1661: Treat SSL_ERROR_ZERO_RETURN correctly./am f6c8f8b4: Treat SSL_ERROR_ZERO_RETURN correctly. * commit f6c8f8b4891a91178e45b90f34f9d8c97737044a: Treat SSL_ERROR_ZERO_RETURN correctly./Treat SSL_ERROR_ZERO_RETURN correctly. According to ssl_lib.c, this is returned whenever the socket is being closed (s->shutdown && SSL_RECEIVED_SHUTDOWN && s->s3->warn_alert SSL_AD_CLOSE_NOTIFY). Change-Id: Ied7b3e18f11786351d42a770f4cad11ddae29ff3/Allow a pubkeyRef to be null If youre making a private key without the pubkey available, we usually just set it to null. However, the fromContextObject cannot cope with NULL being passed in. Bug: 18870063 Change-Id: I26333b4de146e1072783986333f89fe49d4333e0/Go back to BIO_s_null instead of empty mem buf If you pass NULL to BIO_new_mem_buf, it adds an error to the stack and returns NULL instead of an actual BIO. Go back to BIO_s_null instead. Bug: 18870062 Change-Id: Idba61a90907fbc2ea3528734b8cc9e27eccb1b50/Call EVP_CIPHER_CTX_free instead of EVP_CIPHER_CTX_cleanup. The latter doesnt OpenSSL_free memory allocated by EVP_CIPHER_CTX_new. Its worth noting that EVP_CIPHER_CTX_free doesnt check the return value of EVP_CIPHER_CTX_cleanup so we cant throw if cleanup failed, but we were only ever calling this method from a finalizer anyway. (cherry picked from commit c64652932d8e17ccf7e54c0c76c1b38a86841732) bug: 18617384 Change-Id: Ida65e14ffbed41f56a59e2f5fe77289cac0f5947/Call EVP_CIPHER_CTX_free instead of EVP_CIPHER_CTX_cleanup. The latter doesnt OpenSSL_free memory allocated by EVP_CIPHER_CTX_new. Its worth noting that EVP_CIPHER_CTX_free doesnt check the return value of EVP_CIPHER_CTX_cleanup so we cant throw if cleanup failed, but we were only ever calling this method from a finalizer anyway. bug: 18617384 Change-Id: Ida65e14ffbed41f56a59e2f5fe77289cac0f5947/am b31e7642: am 80ac6efc: am 058faf1e: NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails * commit b31e7642abdc913d913c0877f6b7756d9f970033: NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails/am 9eb44160: am 70f386c2: am 53497d00: OpenSSLCipherRSA: add new reason to exception mapping * commit 9eb441604b139f12228fa6fd8af09638fc30446f: OpenSSLCipherRSA: add new reason to exception mapping/NativeCrypto: empty data content for PKCS7 container The EncapsulatedContentInfo must be present in the output, but OpenSSL will fill in a zero-length OID if you dont call PKCS7_set_content on the outer PKCS7 container. So we construct an empty PKCS7 data container and set it as the content. This fixes the invalid PKCS7 output. (cherry picked from commit 525df9b12c1eb77db9f1b2b8fa5d41f779b9afa6) Bug: 18664989 Change-Id: I6f4cf785dd02ee40f1951d098fa987aa25d2421a/NativeCrypto: empty data content for PKCS7 container The EncapsulatedContentInfo must be present in the output, but OpenSSL will fill in a zero-length OID if you dont call PKCS7_set_content on the outer PKCS7 container. So we construct an empty PKCS7 data container and set it as the content. This fixes the invalid PKCS7 output. Bug: 18664989 Change-Id: I6f4cf785dd02ee40f1951d098fa987aa25d2421a/am 80ac6efc: am 058faf1e: NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails * commit 80ac6efc62f72d50e1314da38fed413776490ef7: NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails/am 70f386c2: am 53497d00: OpenSSLCipherRSA: add new reason to exception mapping * commit 70f386c285f4913623b234cc8cb794ccce4cfa48: OpenSSLCipherRSA: add new reason to exception mapping/am 058faf1e: NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails * commit 058faf1e3a8978cca7c9898ccd692fa5b738a180: NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails/am 53497d00: OpenSSLCipherRSA: add new reason to exception mapping * commit 53497d005a470123806d23a5d36e86cee88eafbd: OpenSSLCipherRSA: add new reason to exception mapping/NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails Since nothing was being pushed onto the stack, no exception was thrown in throwExceptionIfNecessary with the constant time fix present in 1.0.1j. The fix is to throw our own error if nothing was thrown. (cherry picked from commit e74933ecfb7dc7d91ebe6620a91d86fdc735ed58) Bug: 18621207 Change-Id: I25e653c493e162c5fda46f320117c013a2661aa4/OpenSSLCipherRSA: add new reason to exception mapping 1.0.1j introduced a new error reason for RSA padding checks that wasnt mapped resulting in a RuntimeException. Add this to the list of reasons so we throw the correct BadPaddingException. (cherry picked from commit 70e75e74134d8a2cbd1569565fac7d34df5fe7da) Bug: 18665649 Change-Id: I96ce13f6dee10ca89e74c558ecb338f9dbd907ba/NativeCrypto: throw BadPaddingException if EVP_CipherFinal_ex fails Since nothing was being pushed onto the stack, no exception was thrown in throwExceptionIfNecessary with the constant time fix present in 1.0.1j. The fix is to throw our own error if nothing was thrown. Bug: 18621207 Change-Id: I25e653c493e162c5fda46f320117c013a2661aa4/OpenSSLCipherRSA: add new reason to exception mapping 1.0.1j introduced a new error reason for RSA padding checks that wasnt mapped resulting in a RuntimeException. Add this to the list of reasons so we throw the correct BadPaddingException. Bug: 18665649 Change-Id: I96ce13f6dee10ca89e74c558ecb338f9dbd907ba/Clear SSL state safely Since SSL_clear can fail, we should clear the OpenSSL ERR stack if it does fail. However, to aid in spotting bugs, only clear the stack if the SSL_clear itself fails. (cherry picked from commit 86dd832ac26112890b3e815a144ff062ae9b3559) Bug: 18570895 Change-Id: I053d2e2792e64923c1e128b4fcae23b2e660a992/Clear SSL state safely Since SSL_clear can fail, we should clear the OpenSSL ERR stack if it does fail. However, to aid in spotting bugs, only clear the stack if the SSL_clear itself fails. (cherry picked from commit 86dd832ac26112890b3e815a144ff062ae9b3559) Bug: 18570895 Change-Id: I053d2e2792e64923c1e128b4fcae23b2e660a992/Clear SSL state safely Since SSL_clear can fail, we should clear the OpenSSL ERR stack if it does fail. However, to aid in spotting bugs, only clear the stack if the SSL_clear itself fails. Bug: 18570895 Change-Id: I053d2e2792e64923c1e128b4fcae23b2e660a992/am 56c62b80: am 6c523c0e: Fix JNI_TRACE * commit 56c62b80c96590bf8c536014fa0a309f68cc8591: Fix JNI_TRACE/am 6c523c0e: Fix JNI_TRACE * commit 6c523c0ef8d66b552b4c15cc87fd7f419181a980: Fix JNI_TRACE/Convert EC_GROUP and EC_POINT to new style Bug: 16656908 Change-Id: Ie912f376f69327ce634cac50763bf86b418049f5/Switch EVP_CIPHER_CTX to new style Bug: 16656908 Change-Id: Id519c20474a02c70e72d362bc84d26855a74fa33/Convert EVP_PKEY to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. This pass fixes EVP_PKEY references, but more passes are needed. Bug: 16656908 Change-Id: I5925da40cb37cd328b3a126404944f771732a43e/Fix JNI_TRACE The update to BoringSSL broke some of the tracing messages, so fix their formatting to compile correctly with warning on. Change-Id: I6c7a1e0069b61a787d9e00b929a6c4fa4358a063/Convert EVP_MD_CTX to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. Bug: 16656908 Change-Id: I165e041a8fe056770d6ce6d6cd064c411575b7c4/Remove Conscrypt support for DSA BoringSSL removes support for DSA, so theres no point in maintaining this now. There have been virtually zero SSL certificates issued using DSA for many years as well. Change-Id: Id940643b85ba39b03038aabc6da9ec0285db66c4/am 54cec1d9: am 0beef7d4: Fix indentation for Fix mac build. * commit 54cec1d9d8a4054f71fb9fa5d800a44ce34971a3: Fix indentation for Fix mac build./am 0beef7d4: Fix indentation for Fix mac build. * commit 0beef7d4fab3c8e7e6c181d9f2b64a68de89e18a: Fix indentation for Fix mac build./Fix indentation for Fix mac build. Change-Id: Ibb669022449a21bc8f2aa4558fbdc747aa1bff2c/am 51b04a56: am a3a2eba7: Fix mac build. * commit 51b04a56efb3479d93f05ff7fcac22a4188fb952: Fix mac build./am a3a2eba7: Fix mac build. * commit a3a2eba7b3785e0b372e2217e01830f09d73e020: Fix mac build./Fix mac build. Change-Id: Ib7297bb0631caafed1ff04bcf2d73aea512c01c1/am 1eb3b3db: am 2ba24c83: Preserve errors to get the correct exception * commit 1eb3b3db9bfb1f0abad08cfcc2ef28dd831ccc17: Preserve errors to get the correct exception/am 2ba24c83: Preserve errors to get the correct exception * commit 2ba24c83d9136bccf60f8638130335066a189b95: Preserve errors to get the correct exception/Preserve errors to get the correct exception During the switch to BoringSSL, agl noticed the error state wasnt being preserved correctly. Integrate part of the BoringSSL change to preserve error states. (cherry picked from commit 2ba24c83d9136bccf60f8638130335066a189b95) Bug: 18388980 Change-Id: I9a6fea4f3bf457808a337604290c6bfd1b9ea84e/Preserve errors to get the correct exception During the switch to BoringSSL, agl noticed the error state wasnt being preserved correctly. Integrate part of the BoringSSL change to preserve error states. Bug: 18388980 Change-Id: I9a6fea4f3bf457808a337604290c6bfd1b9ea84e/Squashed commit of changes from lmp-ub-dev Contains the following changes: commit e31d982cdb0f8e6ef05d1e412576888015e1da17 Merge: eaebc54 b73be72 Author: Neil Fuller Date: Wed Oct 22 10:34:23 2014 +0000 am b73be72e: am 3e21a289: (-s ours) TLS_FALLBACK_SCSV CTS fix for klp-modular-dev * commit b73be72ed97da8f36450d95d52f485cc6f451c61: TLS_FALLBACK_SCSV CTS fix for klp-modular-dev commit eaebc544f3a10c53d7d2f908514122caba569e14 Merge: 223b5da cd50afa Author: Kenny Root Date: Tue Oct 14 17:30:19 2014 +0000 Merge ""Fix SSLEngine to support session resumption."" into lmp-ub-dev commit 223b5da5d70e47b1a497e86474493925b568f6d7 Merge: 8737796 cb7a360 Author: Neil Fuller Date: Thu Oct 9 14:52:00 2014 +0000 am cb7a3605: am ea961ada: Apply conscrypt changes from merge commit * commit cb7a36050f34d3c16be00d532411820761eeb276: Apply conscrypt changes from merge commit commit cd50afad1567b1311e6e979e94a7167b7bf69c94 Author: Doug Steedman Date: Mon Oct 6 13:16:15 2014 Fix SSLEngine to support session resumption. Bug: 17877118 Change-Id: I388b59cde58fdc506ecac9f536e4bbd9161df6ad commit 8737796a646eaec94df32827752a71aee74bd46f Merge: 9564a5f 8d7e23e Author: Kenny Root Date: Mon Oct 6 22:34:20 2014 +0000 am 8d7e23e1: Add support for TLS_FALLBACK_SCSV * commit 8d7e23e117da591a8d48e6bcda9ed6f58ff1a375: Add support for TLS_FALLBACK_SCSV commit 9564a5fb9ed2eecf6299788db35213cb08397212 Merge: 4f58feb 7640613 Author: Kenny Root Date: Fri Sep 12 17:27:23 2014 +0000 am 76406135: am 6dcb23fe: am f427ec90: Fix the ENGINE_finish/ENGINE_free mixup * commit 76406135cf3a3b88afc979fe8e847b9c3d8b93c1: Fix the ENGINE_finish/ENGINE_free mixup commit 4f58feb0ea49dc089a95efba196032ef3c960a39 Merge: ddac5c6 984b7ec Author: Kenny Root Date: Wed Sep 10 07:07:16 2014 +0000 am 984b7ec6: Fix the ENGINE_finish/ENGINE_free mixup * commit 984b7ec6f5aab314117949a48e448ff4f6b65f16: Fix the ENGINE_finish/ENGINE_free mixup commit ddac5c6d7e413b0d68b388fbdf70dbeb3eeae865 Merge: 5a8ca5b 36ba60b Author: Kenny Root Date: Thu Sep 4 22:41:38 2014 +0000 Merge ""Reset lmp-ub-dev to lmp-dev-plus-aosp"" into lmp-ub-dev commit 36ba60b039f1f30ab1ea8f0e2a4da8ae4e3906e5 Author: Kenny Root Date: Wed Aug 27 12:07:07 2014 Reset lmp-ub-dev to lmp-dev-plus-aosp Bug: 17059757 Change-Id: I581963360da47b574e1e2e20c2851485c36fa62c commit 6a4f2ef9e4ea3ebb321d45ca39b30d634ea3b4ad Merge: 9b187af f67d784 Author: Kenny Root Date: Tue Aug 26 04:17:38 2014 +0000 am f67d784a: Add pre-Honeycomb literal IP matching * commit f67d784abe5cef700240be02c68cecd899cd8e6d: Add pre-Honeycomb literal IP matching commit 9b187af33dcd97915a0371d64fe1ee4aba20d0ba Merge: 714ebea 966ae8a Author: Kenny Root Date: Tue Aug 26 04:17:37 2014 +0000 am 966ae8a6: Read property to enable SNI * commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb: Read property to enable SNI commit 714ebeabcb5e35c6df6a5c21f549cdb6130368c4 Merge: 7724204 54a1ba4 Author: Kenny Root Date: Tue Aug 26 04:06:54 2014 +0000 Merge ""resolved conflicts for merge of 342097db to lmp-dev-plus-aosp"" into lmp-dev-plus-aosp commit 54a1ba421d23bb6d988688c2662715e509172447 Merge: a20d871 342097d Author: Kenny Root Date: Mon Aug 25 21:03:51 2014 resolved conflicts for merge of 342097db to lmp-dev-plus-aosp Change-Id: I853c6b0d3725dafbdc84c4d6d6d1b90529bd949d commit 7724204abf4431d35787c44c4a22cda5489d4e37 Merge: 20f60ac afb3403 Author: Kenny Root Date: Tue Aug 26 00:09:27 2014 +0000 am afb34034: Implement write socket timeouts for unbundled apps * commit afb340348bfc54dbc46964e159fe803f9c93a4dd: Implement write socket timeouts for unbundled apps commit f67d784abe5cef700240be02c68cecd899cd8e6d Author: Kenny Root Date: Wed Aug 20 14:14:26 2014 Add pre-Honeycomb literal IP matching This will allow us to run this code on Gingerbread devices and others that dont have the InetAddress#isNumeric API. Bug: 16658420 Bug: 17059757 Change-Id: I597d539979d58eeaa2677d6f99e911313a550cc1 commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb Author: Kenny Root Date: Mon Aug 18 10:12:20 2014 Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9 commit 342097db97a9b2736531033b2c4b4d8ce4998c67 Author: Kenny Root Date: Wed Aug 20 12:14:52 2014 Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208 commit afb340348bfc54dbc46964e159fe803f9c93a4dd Author: Kenny Root Date: Tue Aug 19 16:33:07 2014 Implement write socket timeouts for unbundled apps Change-Id: I4fd604f057ba4288d4f31bf6b3b93307376023d5 commit 20f60acea153dfdf0c8f75a53d7bd9edb4c7614c Author: Kenny Root Date: Mon Aug 25 11:52:05 2014 Tracking change from AOSP Change-Id: I889af3f7c1de9ef34d9328339e1b421651055ad4 commit 68056b7c9db8a9fb384bbadfc5287730f996896d Merge: 8239dfd cc2ef2e Author: Kenny Root Date: Mon Aug 25 18:03:27 2014 +0000 am cc2ef2e2: Rename hostname fields and methods to reflect usage * commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e: Rename hostname fields and methods to reflect usage commit 8239dfdcc40a69255d7b2feced960d574ea36321 Merge: e9cf759 076138f Author: Kenny Root Date: Thu Aug 21 16:36:24 2014 +0000 am 076138ff: Use consistent naming for SSLSocket arguments * commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11: Use consistent naming for SSLSocket arguments commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e Author: Kenny Root Date: Wed Aug 20 11:26:33 2014 Rename hostname fields and methods to reflect usage The hostname that was supplied when the socket was created is stored as the ""peerHostname"" This is the only one that should be used for Server Name Indication (SNI) purposes. The ""peerHostname"" or the resolved IP address may be used for certificate validation, so keep the use of ""getHostname()"" for cerificate validation. Bug: 16658420 Bug: 17059757 Change-Id: Ifd87dead44fb2f00bbfd5eac7e69fb3fc98e94b4 commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11 Author: Kenny Root Date: Wed Aug 20 11:24:41 2014 Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650 commit e9cf759ac89fb053c01f1db19931beb14a823618 Merge: ababdd1 7ed0fae Author: Kenny Root Date: Tue Aug 19 19:32:43 2014 +0000 am 7ed0fae1: OpenSSLEngineImpl: reduce number of copies needed * commit 7ed0fae1906061766d0042e69ccba20e4a702bbe: OpenSSLEngineImpl: reduce number of copies needed commit 7ed0fae1906061766d0042e69ccba20e4a702bbe Author: Kenny Root Date: Tue Jul 22 13:03:09 2014 OpenSSLEngineImpl: reduce number of copies needed When the ByteBuffer didnt line up exactly with the backing array, it would allocate a new buffer to write into. Instead, add the ability for OpenSSL to read at an offset in the given array so a copy isnt needed. Change-Id: I149d3f94e4b5cbdc010df80439ae3300cbdc87a5 commit ababdd1ae1272eac174e3a449a413ab35afbc435 Merge: 66c31e0 4b050b6 Author: Kenny Root Date: Fri Aug 15 16:23:14 2014 +0000 am 4b050b6f: OpenSSLSocketImpl: Move state checks inside mutex * commit 4b050b6fb06fbb804557eecc72cc4ff0e0277525: OpenSSLSocketImpl: Move state checks inside mutex commit 66c31e0b613ceefc167a2e1fb226a14c78f84537 Merge: f4b895a 0931d51 Author: Kenny Root Date: Thu Aug 14 20:46:43 2014 +0000 am 0931d51c: OpenSSLSocketImpl: Move state checks inside mutex * commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706: OpenSSLSocketImpl: Move state checks inside mutex commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706 Author: Kenny Root Date: Tue Aug 5 15:45:32 2014 OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 Change-Id: I5ecdeb1551a13098d1b66c5e4009607c9951fa38 commit f4b895ae9c424b5c2d49c744131606adccbc49d7 Merge: a35c400 a260ee6 Author: Kenny Root Date: Wed Aug 13 15:35:28 2014 +0000 am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit a260ee6d0caea43f8010f158a4a35fb712935ae3: Revert ""Revert ""Automatic management of OpenSSL error stack"""" commit a35c40017c8690f821351d6460dfeaa2738b884c Merge: 0edc483 30550a8 Author: Kenny Root Date: Wed Aug 13 15:35:27 2014 +0000 am 30550a8b: Fix debugging with unbundled conscrypt * commit 30550a8b64bbcd6ca537680a17b8726932a29937: Fix debugging with unbundled conscrypt commit a260ee6d0caea43f8010f158a4a35fb712935ae3 Author: Kenny Root Date: Tue Aug 12 15:38:10 2014 Revert ""Revert ""Automatic management of OpenSSL error stack"""" The ""else"" statement in OpenSslError::reset wasnt properly resetting the error state which made a second call into sslRead jump into sslSelect when it should have just returned immediately. Change-Id: I22e8025c0497a04e78daa07cef78191a6ca1a70c commit 30550a8b64bbcd6ca537680a17b8726932a29937 Author: Kenny Root Date: Tue Aug 12 15:13:33 2014 Fix debugging with unbundled conscrypt When JNI_TRACE was enabled, there were missing defines for the debugging code since no platform code is included. Also clang complains about more of the debugging statement formats, so we have to move some things around to get it to be happy. Change-Id: I1a6695c2ef2639cc01cfc3d3a8603f010c659844 commit 0edc4833091846d6cb45961fc9458df842fbbad9 Merge: 107a8fb 2411b8b Author: Kenny Root Date: Tue Aug 12 21:46:12 2014 +0000 am 2411b8bd: Merge ""Revert ""Automatic management of OpenSSL error stack"""" * commit 2411b8bdcde72c956f4150e9a5909b7501f50bad: Revert ""Automatic management of OpenSSL error stack"" commit 2411b8bdcde72c956f4150e9a5909b7501f50bad Merge: 3262a8c b514d72 Author: Kenny Root Date: Tue Aug 12 21:39:32 2014 +0000 Merge ""Revert ""Automatic management of OpenSSL error stack"""" commit b514d72b93c3996d97e38eca6db1ad684965fd9b Author: Kenny Root Date: Tue Aug 12 21:39:17 2014 +0000 Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef commit 107a8fba8be5be57933f2638b76ac1243b578b9e Merge: 1de007f 3262a8c Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 3262a8c2741b95103149bcdefe2409c24bfddee9: Automatic management of OpenSSL error stack commit 1de007f9f01be8f07a56235dd924c897088a03cb Merge: 94890ae d1bbcd0 Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am d1bbcd0e: Relax checks for key vs cert for wrapped keys * commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484: Relax checks for key vs cert for wrapped keys commit 3262a8c2741b95103149bcdefe2409c24bfddee9 Merge: d1bbcd0 35666e4 Author: Kenny Root Date: Tue Aug 12 15:31:02 2014 +0000 Merge ""Automatic management of OpenSSL error stack"" commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484 Author: Kenny Root Date: Mon Aug 11 14:56:58 2014 Relax checks for key vs cert for wrapped keys If a key is a wrapped platform key, we must relax the check. The reason is that we may not have the public values we need to pass the EVP_PKEY_cmp checks that this does. Change-Id: I7ab2be51b0968a9cf771edea01d33fe2367c8185 commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8 Author: Kenny Root Date: Tue Aug 5 11:05:00 2014 Automatic management of OpenSSL error stack This removes some complexity in remembering to free the OpenSSL error stack. If you forget, the error will stick around until you make another call. Change-Id: I245a525dcc93077b2bf9909a14a0ef469a2daca4 commit 94890aec5735cde2ea5170fb76cd1b847ea66af8 Merge: 8360485 977f087 Author: Kenny Root Date: Tue Aug 5 16:44:42 2014 +0000 am 977f0877: Fix some JNI_TRACE lines * commit 977f08774c628b4640d5454cde050259856965f8: Fix some JNI_TRACE lines commit 977f08774c628b4640d5454cde050259856965f8 Author: Kenny Root Date: Mon Aug 4 12:15:04 2014 Fix some JNI_TRACE lines During debugging these would be enabled, but they were copy-pastad to with the wrong args. Change-Id: I23f39ff4807e3fa71f3220912aec3c99db6b9454 commit 83604854c5160304cafefc9bd40a72c5ee8506eb Merge: 7db3524 1ffe43e Author: Zoltan Szatmary-Ban Date: Thu Jul 31 13:28:57 2014 +0000 am 1ffe43e8: Merge ""Add possibility to get deleted system Certificate Aliases"" into lmp-dev * commit 1ffe43e8277e883c6663c1fb7cfc5e18ba552c40: Add possibility to get deleted system Certificate Aliases commit 7db3524880092126962b7f502af76b4c84da7350 Merge: 5767d63 ad0cd83 Author: Prameet Shah Date: Wed Jul 30 17:04:13 2014 +0000 am ad0cd830: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit ad0cd83024f38011043d28d70370a8638b88cd72: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 5767d63d22e87becab387b3bd6597fe41eb34d7e Merge: b389e17 26163c2 Author: Prameet Shah Date: Wed Jul 30 16:31:08 2014 +0000 am 26163c26: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit 26163c268a6d2625384b87e907afad8ef19f9a47: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 26163c268a6d2625384b87e907afad8ef19f9a47 Author: Prameet Shah Date: Tue Jul 29 16:45:31 2014 Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700 commit b389e1779651f2c58454a5f98acebd3dd7bc0061 Merge: 5f03b4d e427972 Author: Prameet Shah Date: Thu Jul 24 19:46:28 2014 +0000 am e427972e: OpenSSLEngineImpl: fix unwrap behavior with array * commit e427972eb6141cd67e6d4c9607863a8d990e6be6: OpenSSLEngineImpl: fix unwrap behavior with array commit 5f03b4d63c7632581b032879de791dc82f05ffa0 Merge: 3d935ee 41eb5b6 Author: Prameet Shah Date: Tue Jul 22 19:26:41 2014 +0000 am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 41eb5b65e524d01e28da474bd37e4349b12fb494: OpenSSLEngineImpl: fix unwrap behavior with array commit 41eb5b65e524d01e28da474bd37e4349b12fb494 Author: Prameet Shah Date: Tue Jul 22 11:50:18 2014 OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b commit 3d935eeca25e00b56cfd8d37a657c7b2986889b3 Merge: 0a36f6c affd45a Author: Alex Klyubin Date: Fri Jul 18 00:32:14 2014 +0000 am affd45a4: Merge ""Improve the Javadoc of PSKKeyManager."" into lmp-dev * commit affd45a413cf844dad797ad4972074efb9de43d8: Improve the Javadoc of PSKKeyManager. commit 0a36f6c1f8b2e195c2dd5aea1a386df090c6d470 Merge: 6492180 af4fa68 Author: rich cannings Date: Thu Jul 17 23:47:33 2014 +0000"
,,0.1557,conscrypt,"Convert EVP_PKEY to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. This pass fixes EVP_PKEY references, but more passes are needed. Bug: 16656908 Change-Id: I5925da40cb37cd328b3a126404944f771732a43e/"
,,0.0652,conscrypt,Convert EC_GROUP and EC_POINT to new style Bug: 16656908 Change-Id: Ie912f376f69327ce634cac50763bf86b418049f5/
,,0.2089,conscrypt,"Convert EVP_PKEY to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. This pass fixes EVP_PKEY references, but more passes are needed. Bug: 16656908 Change-Id: I5925da40cb37cd328b3a126404944f771732a43e/Convert EVP_MD_CTX to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. Bug: 16656908 Change-Id: I165e041a8fe056770d6ce6d6cd064c411575b7c4/"
,,0.1503,conscrypt,"Convert EVP_PKEY to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. This pass fixes EVP_PKEY references, but more passes are needed. Bug: 16656908 Change-Id: I5925da40cb37cd328b3a126404944f771732a43e/"
,,0.1589,conscrypt,"Convert EC_GROUP and EC_POINT to new style Bug: 16656908 Change-Id: Ie912f376f69327ce634cac50763bf86b418049f5/Convert EVP_PKEY to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. This pass fixes EVP_PKEY references, but more passes are needed. Bug: 16656908 Change-Id: I5925da40cb37cd328b3a126404944f771732a43e/"
,,0.0652,conscrypt,Convert EC_GROUP and EC_POINT to new style Bug: 16656908 Change-Id: Ie912f376f69327ce634cac50763bf86b418049f5/
,,0.9152,conscrypt,"Squashed commit of changes from lmp-ub-dev Contains the following changes: commit e31d982cdb0f8e6ef05d1e412576888015e1da17 Merge: eaebc54 b73be72 Author: Neil Fuller Date: Wed Oct 22 10:34:23 2014 +0000 am b73be72e: am 3e21a289: (-s ours) TLS_FALLBACK_SCSV CTS fix for klp-modular-dev * commit b73be72ed97da8f36450d95d52f485cc6f451c61: TLS_FALLBACK_SCSV CTS fix for klp-modular-dev commit eaebc544f3a10c53d7d2f908514122caba569e14 Merge: 223b5da cd50afa Author: Kenny Root Date: Tue Oct 14 17:30:19 2014 +0000 Merge ""Fix SSLEngine to support session resumption."" into lmp-ub-dev commit 223b5da5d70e47b1a497e86474493925b568f6d7 Merge: 8737796 cb7a360 Author: Neil Fuller Date: Thu Oct 9 14:52:00 2014 +0000 am cb7a3605: am ea961ada: Apply conscrypt changes from merge commit * commit cb7a36050f34d3c16be00d532411820761eeb276: Apply conscrypt changes from merge commit commit cd50afad1567b1311e6e979e94a7167b7bf69c94 Author: Doug Steedman Date: Mon Oct 6 13:16:15 2014 Fix SSLEngine to support session resumption. Bug: 17877118 Change-Id: I388b59cde58fdc506ecac9f536e4bbd9161df6ad commit 8737796a646eaec94df32827752a71aee74bd46f Merge: 9564a5f 8d7e23e Author: Kenny Root Date: Mon Oct 6 22:34:20 2014 +0000 am 8d7e23e1: Add support for TLS_FALLBACK_SCSV * commit 8d7e23e117da591a8d48e6bcda9ed6f58ff1a375: Add support for TLS_FALLBACK_SCSV commit 9564a5fb9ed2eecf6299788db35213cb08397212 Merge: 4f58feb 7640613 Author: Kenny Root Date: Fri Sep 12 17:27:23 2014 +0000 am 76406135: am 6dcb23fe: am f427ec90: Fix the ENGINE_finish/ENGINE_free mixup * commit 76406135cf3a3b88afc979fe8e847b9c3d8b93c1: Fix the ENGINE_finish/ENGINE_free mixup commit 4f58feb0ea49dc089a95efba196032ef3c960a39 Merge: ddac5c6 984b7ec Author: Kenny Root Date: Wed Sep 10 07:07:16 2014 +0000 am 984b7ec6: Fix the ENGINE_finish/ENGINE_free mixup * commit 984b7ec6f5aab314117949a48e448ff4f6b65f16: Fix the ENGINE_finish/ENGINE_free mixup commit ddac5c6d7e413b0d68b388fbdf70dbeb3eeae865 Merge: 5a8ca5b 36ba60b Author: Kenny Root Date: Thu Sep 4 22:41:38 2014 +0000 Merge ""Reset lmp-ub-dev to lmp-dev-plus-aosp"" into lmp-ub-dev commit 36ba60b039f1f30ab1ea8f0e2a4da8ae4e3906e5 Author: Kenny Root Date: Wed Aug 27 12:07:07 2014 Reset lmp-ub-dev to lmp-dev-plus-aosp Bug: 17059757 Change-Id: I581963360da47b574e1e2e20c2851485c36fa62c commit 6a4f2ef9e4ea3ebb321d45ca39b30d634ea3b4ad Merge: 9b187af f67d784 Author: Kenny Root Date: Tue Aug 26 04:17:38 2014 +0000 am f67d784a: Add pre-Honeycomb literal IP matching * commit f67d784abe5cef700240be02c68cecd899cd8e6d: Add pre-Honeycomb literal IP matching commit 9b187af33dcd97915a0371d64fe1ee4aba20d0ba Merge: 714ebea 966ae8a Author: Kenny Root Date: Tue Aug 26 04:17:37 2014 +0000 am 966ae8a6: Read property to enable SNI * commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb: Read property to enable SNI commit 714ebeabcb5e35c6df6a5c21f549cdb6130368c4 Merge: 7724204 54a1ba4 Author: Kenny Root Date: Tue Aug 26 04:06:54 2014 +0000 Merge ""resolved conflicts for merge of 342097db to lmp-dev-plus-aosp"" into lmp-dev-plus-aosp commit 54a1ba421d23bb6d988688c2662715e509172447 Merge: a20d871 342097d Author: Kenny Root Date: Mon Aug 25 21:03:51 2014 resolved conflicts for merge of 342097db to lmp-dev-plus-aosp Change-Id: I853c6b0d3725dafbdc84c4d6d6d1b90529bd949d commit 7724204abf4431d35787c44c4a22cda5489d4e37 Merge: 20f60ac afb3403 Author: Kenny Root Date: Tue Aug 26 00:09:27 2014 +0000 am afb34034: Implement write socket timeouts for unbundled apps * commit afb340348bfc54dbc46964e159fe803f9c93a4dd: Implement write socket timeouts for unbundled apps commit f67d784abe5cef700240be02c68cecd899cd8e6d Author: Kenny Root Date: Wed Aug 20 14:14:26 2014 Add pre-Honeycomb literal IP matching This will allow us to run this code on Gingerbread devices and others that dont have the InetAddress#isNumeric API. Bug: 16658420 Bug: 17059757 Change-Id: I597d539979d58eeaa2677d6f99e911313a550cc1 commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb Author: Kenny Root Date: Mon Aug 18 10:12:20 2014 Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9 commit 342097db97a9b2736531033b2c4b4d8ce4998c67 Author: Kenny Root Date: Wed Aug 20 12:14:52 2014 Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208 commit afb340348bfc54dbc46964e159fe803f9c93a4dd Author: Kenny Root Date: Tue Aug 19 16:33:07 2014 Implement write socket timeouts for unbundled apps Change-Id: I4fd604f057ba4288d4f31bf6b3b93307376023d5 commit 20f60acea153dfdf0c8f75a53d7bd9edb4c7614c Author: Kenny Root Date: Mon Aug 25 11:52:05 2014 Tracking change from AOSP Change-Id: I889af3f7c1de9ef34d9328339e1b421651055ad4 commit 68056b7c9db8a9fb384bbadfc5287730f996896d Merge: 8239dfd cc2ef2e Author: Kenny Root Date: Mon Aug 25 18:03:27 2014 +0000 am cc2ef2e2: Rename hostname fields and methods to reflect usage * commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e: Rename hostname fields and methods to reflect usage commit 8239dfdcc40a69255d7b2feced960d574ea36321 Merge: e9cf759 076138f Author: Kenny Root Date: Thu Aug 21 16:36:24 2014 +0000 am 076138ff: Use consistent naming for SSLSocket arguments * commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11: Use consistent naming for SSLSocket arguments commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e Author: Kenny Root Date: Wed Aug 20 11:26:33 2014 Rename hostname fields and methods to reflect usage The hostname that was supplied when the socket was created is stored as the ""peerHostname"" This is the only one that should be used for Server Name Indication (SNI) purposes. The ""peerHostname"" or the resolved IP address may be used for certificate validation, so keep the use of ""getHostname()"" for cerificate validation. Bug: 16658420 Bug: 17059757 Change-Id: Ifd87dead44fb2f00bbfd5eac7e69fb3fc98e94b4 commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11 Author: Kenny Root Date: Wed Aug 20 11:24:41 2014 Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650 commit e9cf759ac89fb053c01f1db19931beb14a823618 Merge: ababdd1 7ed0fae Author: Kenny Root Date: Tue Aug 19 19:32:43 2014 +0000 am 7ed0fae1: OpenSSLEngineImpl: reduce number of copies needed * commit 7ed0fae1906061766d0042e69ccba20e4a702bbe: OpenSSLEngineImpl: reduce number of copies needed commit 7ed0fae1906061766d0042e69ccba20e4a702bbe Author: Kenny Root Date: Tue Jul 22 13:03:09 2014 OpenSSLEngineImpl: reduce number of copies needed When the ByteBuffer didnt line up exactly with the backing array, it would allocate a new buffer to write into. Instead, add the ability for OpenSSL to read at an offset in the given array so a copy isnt needed. Change-Id: I149d3f94e4b5cbdc010df80439ae3300cbdc87a5 commit ababdd1ae1272eac174e3a449a413ab35afbc435 Merge: 66c31e0 4b050b6 Author: Kenny Root Date: Fri Aug 15 16:23:14 2014 +0000 am 4b050b6f: OpenSSLSocketImpl: Move state checks inside mutex * commit 4b050b6fb06fbb804557eecc72cc4ff0e0277525: OpenSSLSocketImpl: Move state checks inside mutex commit 66c31e0b613ceefc167a2e1fb226a14c78f84537 Merge: f4b895a 0931d51 Author: Kenny Root Date: Thu Aug 14 20:46:43 2014 +0000 am 0931d51c: OpenSSLSocketImpl: Move state checks inside mutex * commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706: OpenSSLSocketImpl: Move state checks inside mutex commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706 Author: Kenny Root Date: Tue Aug 5 15:45:32 2014 OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 Change-Id: I5ecdeb1551a13098d1b66c5e4009607c9951fa38 commit f4b895ae9c424b5c2d49c744131606adccbc49d7 Merge: a35c400 a260ee6 Author: Kenny Root Date: Wed Aug 13 15:35:28 2014 +0000 am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit a260ee6d0caea43f8010f158a4a35fb712935ae3: Revert ""Revert ""Automatic management of OpenSSL error stack"""" commit a35c40017c8690f821351d6460dfeaa2738b884c Merge: 0edc483 30550a8 Author: Kenny Root Date: Wed Aug 13 15:35:27 2014 +0000 am 30550a8b: Fix debugging with unbundled conscrypt * commit 30550a8b64bbcd6ca537680a17b8726932a29937: Fix debugging with unbundled conscrypt commit a260ee6d0caea43f8010f158a4a35fb712935ae3 Author: Kenny Root Date: Tue Aug 12 15:38:10 2014 Revert ""Revert ""Automatic management of OpenSSL error stack"""" The ""else"" statement in OpenSslError::reset wasnt properly resetting the error state which made a second call into sslRead jump into sslSelect when it should have just returned immediately. Change-Id: I22e8025c0497a04e78daa07cef78191a6ca1a70c commit 30550a8b64bbcd6ca537680a17b8726932a29937 Author: Kenny Root Date: Tue Aug 12 15:13:33 2014 Fix debugging with unbundled conscrypt When JNI_TRACE was enabled, there were missing defines for the debugging code since no platform code is included. Also clang complains about more of the debugging statement formats, so we have to move some things around to get it to be happy. Change-Id: I1a6695c2ef2639cc01cfc3d3a8603f010c659844 commit 0edc4833091846d6cb45961fc9458df842fbbad9 Merge: 107a8fb 2411b8b Author: Kenny Root Date: Tue Aug 12 21:46:12 2014 +0000 am 2411b8bd: Merge ""Revert ""Automatic management of OpenSSL error stack"""" * commit 2411b8bdcde72c956f4150e9a5909b7501f50bad: Revert ""Automatic management of OpenSSL error stack"" commit 2411b8bdcde72c956f4150e9a5909b7501f50bad Merge: 3262a8c b514d72 Author: Kenny Root Date: Tue Aug 12 21:39:32 2014 +0000 Merge ""Revert ""Automatic management of OpenSSL error stack"""" commit b514d72b93c3996d97e38eca6db1ad684965fd9b Author: Kenny Root Date: Tue Aug 12 21:39:17 2014 +0000 Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef commit 107a8fba8be5be57933f2638b76ac1243b578b9e Merge: 1de007f 3262a8c Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 3262a8c2741b95103149bcdefe2409c24bfddee9: Automatic management of OpenSSL error stack commit 1de007f9f01be8f07a56235dd924c897088a03cb Merge: 94890ae d1bbcd0 Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am d1bbcd0e: Relax checks for key vs cert for wrapped keys * commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484: Relax checks for key vs cert for wrapped keys commit 3262a8c2741b95103149bcdefe2409c24bfddee9 Merge: d1bbcd0 35666e4 Author: Kenny Root Date: Tue Aug 12 15:31:02 2014 +0000 Merge ""Automatic management of OpenSSL error stack"" commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484 Author: Kenny Root Date: Mon Aug 11 14:56:58 2014 Relax checks for key vs cert for wrapped keys If a key is a wrapped platform key, we must relax the check. The reason is that we may not have the public values we need to pass the EVP_PKEY_cmp checks that this does. Change-Id: I7ab2be51b0968a9cf771edea01d33fe2367c8185 commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8 Author: Kenny Root Date: Tue Aug 5 11:05:00 2014 Automatic management of OpenSSL error stack This removes some complexity in remembering to free the OpenSSL error stack. If you forget, the error will stick around until you make another call. Change-Id: I245a525dcc93077b2bf9909a14a0ef469a2daca4 commit 94890aec5735cde2ea5170fb76cd1b847ea66af8 Merge: 8360485 977f087 Author: Kenny Root Date: Tue Aug 5 16:44:42 2014 +0000 am 977f0877: Fix some JNI_TRACE lines * commit 977f08774c628b4640d5454cde050259856965f8: Fix some JNI_TRACE lines commit 977f08774c628b4640d5454cde050259856965f8 Author: Kenny Root Date: Mon Aug 4 12:15:04 2014 Fix some JNI_TRACE lines During debugging these would be enabled, but they were copy-pastad to with the wrong args. Change-Id: I23f39ff4807e3fa71f3220912aec3c99db6b9454 commit 83604854c5160304cafefc9bd40a72c5ee8506eb Merge: 7db3524 1ffe43e Author: Zoltan Szatmary-Ban Date: Thu Jul 31 13:28:57 2014 +0000 am 1ffe43e8: Merge ""Add possibility to get deleted system Certificate Aliases"" into lmp-dev * commit 1ffe43e8277e883c6663c1fb7cfc5e18ba552c40: Add possibility to get deleted system Certificate Aliases commit 7db3524880092126962b7f502af76b4c84da7350 Merge: 5767d63 ad0cd83 Author: Prameet Shah Date: Wed Jul 30 17:04:13 2014 +0000 am ad0cd830: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit ad0cd83024f38011043d28d70370a8638b88cd72: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 5767d63d22e87becab387b3bd6597fe41eb34d7e Merge: b389e17 26163c2 Author: Prameet Shah Date: Wed Jul 30 16:31:08 2014 +0000 am 26163c26: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit 26163c268a6d2625384b87e907afad8ef19f9a47: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 26163c268a6d2625384b87e907afad8ef19f9a47 Author: Prameet Shah Date: Tue Jul 29 16:45:31 2014 Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700 commit b389e1779651f2c58454a5f98acebd3dd7bc0061 Merge: 5f03b4d e427972 Author: Prameet Shah Date: Thu Jul 24 19:46:28 2014 +0000 am e427972e: OpenSSLEngineImpl: fix unwrap behavior with array * commit e427972eb6141cd67e6d4c9607863a8d990e6be6: OpenSSLEngineImpl: fix unwrap behavior with array commit 5f03b4d63c7632581b032879de791dc82f05ffa0 Merge: 3d935ee 41eb5b6 Author: Prameet Shah Date: Tue Jul 22 19:26:41 2014 +0000 am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 41eb5b65e524d01e28da474bd37e4349b12fb494: OpenSSLEngineImpl: fix unwrap behavior with array commit 41eb5b65e524d01e28da474bd37e4349b12fb494 Author: Prameet Shah Date: Tue Jul 22 11:50:18 2014 OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b commit 3d935eeca25e00b56cfd8d37a657c7b2986889b3 Merge: 0a36f6c affd45a Author: Alex Klyubin Date: Fri Jul 18 00:32:14 2014 +0000 am affd45a4: Merge ""Improve the Javadoc of PSKKeyManager."" into lmp-dev * commit affd45a413cf844dad797ad4972074efb9de43d8: Improve the Javadoc of PSKKeyManager. commit 0a36f6c1f8b2e195c2dd5aea1a386df090c6d470 Merge: 6492180 af4fa68 Author: rich cannings Date: Thu Jul 17 23:47:33 2014 +0000 am af4fa685: Merge ""Log CCS exceptions do not merge."" into lmp-dev * commit af4fa685f246aaa80c93af62faadbc2fe87dc034: Log CCS exceptions do not merge. commit 6492180ce17a3b5ff822cff1783f00e7a4176491 Merge: aac4168 3b7268c Author: Alex Klyubin Date: Thu Jul 17 18:27:39 2014 +0000 am 3b7268cd: Merge ""Improve the Javadoc of PSKKeyManager."" * commit 3b7268cde4a4fc59591da8a93691927ebf3add57: Improve the Javadoc of PSKKeyManager. commit aac4168d8baef7e12d6fa959c6d6ded9892e9651 Merge: 8573ad0 a749c0d Author: Kenny Root Date: Thu Jul 17 17:07:05 2014 +0000 am a749c0d3: Keep enough state to completely reset cipher instances * commit a749c0d351216be38879600ee8ed01c6793aa256: Keep enough state to completely reset cipher instances commit 8573ad0ddcf7e2f8b2e5ac84c34b7ffab303155c Merge: 4ca5b06 70fdb6d Author: Koushik Dutta Date: Thu Jul 17 17:06:36 2014 +0000 am 70fdb6d2: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit 70fdb6d2bfa0c313fe389827f0025288f6aeb947: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit 4ca5b0625e3f5a15ae8adf833ab5a69f9d7d517f Merge: 119abfb ded66f5 Author: Koushik Dutta Date: Thu Jul 17 17:06:35 2014 +0000 am ded66f5f: Various fixes in OpenSSLEngineImpl. * commit ded66f5f696994ce7620552e16a4e9124e69e052: Various fixes in OpenSSLEngineImpl. commit 119abfba1fcd9c9cfbd15d0a4ca9ed2188fdfab0 Merge: 5713cdf cbe1f28 Author: Kenny Root Date: Thu Jul 17 15:56:57 2014 +0000 am cbe1f28a: Merge ""Keep enough state to completely reset cipher instances"" * commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae: Keep enough state to completely reset cipher instances commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae Merge: e08f238 084e308 Author: Kenny Root Date: Thu Jul 17 15:48:58 2014 +0000 Merge ""Keep enough state to completely reset cipher instances"" commit 3b7268cde4a4fc59591da8a93691927ebf3add57 Merge: cbe1f28 7ac13e0 Author: Alex Klyubin Date: Thu Jul 17 18:20:43 2014 +0000 Merge ""Improve the Javadoc of PSKKeyManager."" commit 5713cdf71c5c6e5179e8369263c702e9512afdd0 Merge: cf55719 e08f238 Author: Koushik Dutta Date: Wed Jul 16 22:05:17 2014 +0000 am e08f2385: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit e08f238580e8ee471012bef8240c8d3397c7b780: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit cf557195a9b60d7f51a48500afde38481ddbc91c Merge: cbbd7d1 986aeb7 Author: Kenny Root Date: Wed Jul 16 21:41:12 2014 +0000 am 986aeb78: Merge ""Various fixes in OpenSSLEngineImpl."" * commit 986aeb78e533540463daf1753e24840f75b25ce6: Various fixes in OpenSSLEngineImpl. commit e08f238580e8ee471012bef8240c8d3397c7b780 Author: Koushik Dutta Date: Tue Jul 15 22:40:23 2014 OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. Change-Id: Idc78204b7077fb367b64e1867c807cd39f596f98 commit 7ac13e03a79d0c99d181b1a28b1b3699ba3d5739 Author: Alex Klyubin Date: Wed Jul 16 08:33:02 2014 Improve the Javadoc of PSKKeyManager. This clarifies several points and adds sample code. Bug: 15073623 Change-Id: I6e8aadc52277e238a998d6cee36795dab1151d58 commit 986aeb78e533540463daf1753e24840f75b25ce6 Merge: 8f9ac1a bdfcc18 Author: Kenny Root Date: Wed Jul 16 21:15:30 2014 +0000 Merge ""Various fixes in OpenSSLEngineImpl."" commit bdfcc189efe41a3f812aeb55ea634bace67d159a Author: Koushik Dutta Date: Sat Jun 28 19:19:21 2014 Various fixes in OpenSSLEngineImpl. Fix ""Buffers were not large enough"" exception by directly using the destination buffers. Corrections around bytesProduced and bytesConsumed behavior. Return BUFFER_OVERFLOW if a zero length destination is provided to unwrap. Change-Id: I1f1e9b72cd6968ed4f3c3c0edccbccebc33d6790 commit cbbd7d10e8e484c44a78e5b27e8fecda195f1692 Merge: ec7f8e6 fdb7d8c Author: Alex Klyubin Date: Tue Jul 15 18:49:14 2014 +0000 am fdb7d8c5: Enable PSK cipher suites when PSKKeyManager is provided. * commit fdb7d8c53dabac5551e2499d045ba6829bcfc0a0: Enable PSK cipher suites when PSKKeyManager is provided. commit ec7f8e6b27330160f88540f4f2ace7bc2a0720a3 Merge: 5b8ccf1 8f9ac1a Author: Alex Klyubin Date: Tue Jul 15 15:53:46 2014 +0000 am 8f9ac1af: Enable PSK cipher suites when PSKKeyManager is provided. * commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17: Enable PSK cipher suites when PSKKeyManager is provided. commit 5b8ccf1b09df6f35c1709bfc8fd727a291094a5b Merge: 69a2e46 6e2315f Author: Ed Heyl Date: Tue Jul 15 13:34:25 2014 +0000 am 6e2315fd: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. * commit 6e2315fd96c3c4a47450c1a437babacc94bc31a6: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. commit 084e3086be1d7a6b9280b64c7c8cdb7b41a13bea Author: Kenny Root Date: Mon Jul 14 13:25:32 2014 Keep enough state to completely reset cipher instances OpenSSLs RC4 mutates the given key. AES/CTR mutates the IV. We must store these values locally to enable ""doFinal"" to cause the Cipher instance to be reset to what it was right after ""init"". Note that resetting and encrypting with the same key or IV breaks semantic security. Bug: 16298401 Bug: Change-Id: Ie7e4dcb6cf6cc33ddad31d6b47066dc1b34e6894 commit 69a2e460cc0a40e1b951e400589b9932609079ec Merge: 8b7bb32 bca895f Author: David Benjamin Date: Mon Jul 14 18:17:28 2014 +0000 am bca895f8: Pass output buffer length into EVP_DigestSignFinal. * commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d: Pass output buffer length into EVP_DigestSignFinal. commit 8b7bb32af09a01e80442b70dd23e6997a937f103 Merge: a2404c9 e79c25b Author: Kenny Root Date: Mon Jul 14 18:17:28 2014 +0000 am e79c25bf: Merge ""DHKeyPairGenerator: use provided params"" * commit e79c25bf33e10da41e489c537823f678e1a1169c: DHKeyPairGenerator: use provided params commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17 Author: Alex Klyubin Date: Thu Jun 19 13:37:24 2014 Enable PSK cipher suites when PSKKeyManager is provided. This enables TLS-PSK cipher suites by default iff SSLContext is initialized with a PSKKeyManager. For consistency, X.509 based cipher suites are no longer enabled by default at all times they are now only enabled by default iff SSLContext is initialized with a X509KeyManager or a X509TrustManager. When both X.509 and PSK cipher suites need to be enabled, PSK cipher suites are given higher priority in the resulting list of cipher suites. This is based on the assumption that in most cases users of TLS/SSL who enable TLS-PSK would prefer TLS-PSK to be used when the peer supports TLS-PSK. Bug: 15073623 Change-Id: I8e2bc3e7a1ea8a986e468973b6bad19dc6b7bc3c commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d Author: David Benjamin Date: Thu Jul 10 18:12:08 2014 Pass output buffer length into EVP_DigestSignFinal. EVP_DigestSignFinal expects the input buffer length as *siglen on input. In addition, if sigret is NULL, it returns the buffer size needed. Use this rather than making assumptions about the EVP_PKEY used to initialize the EVP_MD_CTX. commit e79c25bf33e10da41e489c537823f678e1a1169c Merge: a328492 9b226f9 Author: Kenny Root Date: Fri Jul 11 16:46:23 2014 +0000 Merge ""DHKeyPairGenerator: use provided params"" commit 9b226f90a992a4a2267b7a813e3b869851945c4d Author: Kenny Root Date: Thu Jul 10 14:50:48 2014 DHKeyPairGenerator: use provided params If the prime is provided in the DHParameterSpec, then use it to generate the key. Bug: 16188130 Change-Id: I42de02c71a58d691ef7ba6e2252367105687b758 Bug: 18388980 Change-Id: I853b02a32db113a5af3f6166e7d61fab58c3ff73/"
,,0.1503,conscrypt,"Convert EVP_PKEY to new style To avoid conflicts in the language spec and how Conscrypt does native calls, we need to wrap all native references in a Java object reference. Calling NativeCryptos static native methods with a raw pointer doesnt guarantee that the calling object wont be finalized during the method running. This pass fixes EVP_PKEY references, but more passes are needed. Bug: 16656908 Change-Id: I5925da40cb37cd328b3a126404944f771732a43e/"
,,0.9044,conscrypt,"OpenSSLEngineImpl: return bytes consumed for unwrap During a handshake, unwrap should return the number of bytes consumed by the SSL implementation in addition to changing the source buffer position so that the client can alter its state based on either. (cherry picked from commit 8e68a40dea765a9769de454f51c877ad80d670bb) Bug: 18921387 Bug: Change-Id: Idf5a3b24c8ad053ef2970bfb66d142a7c2685c02/OpenSSLEngineImpl: return bytes consumed for unwrap During a handshake, unwrap should return the number of bytes consumed by the SSL implementation in addition to changing the source buffer position so that the client can alter its state based on either. Bug: 18921387 Bug: Change-Id: Idf5a3b24c8ad053ef2970bfb66d142a7c2685c02/Return BUFFER_UNDERFLOW if no source bytes were consumed. ... either during the handshake or after. With this change, were backward compatible with older versions of android. Note that newer versions of apache-http rely on this behaviour. bug: 18554122 (cherry picked from commit 6a1b7a85dcdeb19305ad5153579bd11c1eb0bfad) Change-Id: I741d2585548b3d72abae2b696eee2a186e58414c/Return BUFFER_UNDERFLOW if no source bytes were consumed. ... either during the handshake or after. With this change, were backward compatible with older versions of android. Note that newer versions of apache-http rely on this behaviour. bug: 18554122 Change-Id: I574c263e8df4a5f2396ac860608fe85cdbcdbb49/am 712d3b1e: am af49a8e2: Fix SSLEngine to support session resumption. * commit 712d3b1e064c167899b115320ccc28c5c2fda78d: Fix SSLEngine to support session resumption./am af49a8e2: Fix SSLEngine to support session resumption. * commit af49a8e2568b5a561703d93b7c872ba3a807fb3b: Fix SSLEngine to support session resumption./Fix SSLEngine to support session resumption. (cherry picked from commit cd50afad1567b1311e6e979e94a7167b7bf69c94) Bug: 17877118 Change-Id: I388b59cde58fdc506ecac9f536e4bbd9161df6ad/Squashed commit of changes from lmp-ub-dev Contains the following changes: commit e31d982cdb0f8e6ef05d1e412576888015e1da17 Merge: eaebc54 b73be72 Author: Neil Fuller Date: Wed Oct 22 10:34:23 2014 +0000 am b73be72e: am 3e21a289: (-s ours) TLS_FALLBACK_SCSV CTS fix for klp-modular-dev * commit b73be72ed97da8f36450d95d52f485cc6f451c61: TLS_FALLBACK_SCSV CTS fix for klp-modular-dev commit eaebc544f3a10c53d7d2f908514122caba569e14 Merge: 223b5da cd50afa Author: Kenny Root Date: Tue Oct 14 17:30:19 2014 +0000 Merge ""Fix SSLEngine to support session resumption."" into lmp-ub-dev commit 223b5da5d70e47b1a497e86474493925b568f6d7 Merge: 8737796 cb7a360 Author: Neil Fuller Date: Thu Oct 9 14:52:00 2014 +0000 am cb7a3605: am ea961ada: Apply conscrypt changes from merge commit * commit cb7a36050f34d3c16be00d532411820761eeb276: Apply conscrypt changes from merge commit commit cd50afad1567b1311e6e979e94a7167b7bf69c94 Author: Doug Steedman Date: Mon Oct 6 13:16:15 2014 Fix SSLEngine to support session resumption. Bug: 17877118 Change-Id: I388b59cde58fdc506ecac9f536e4bbd9161df6ad commit 8737796a646eaec94df32827752a71aee74bd46f Merge: 9564a5f 8d7e23e Author: Kenny Root Date: Mon Oct 6 22:34:20 2014 +0000 am 8d7e23e1: Add support for TLS_FALLBACK_SCSV * commit 8d7e23e117da591a8d48e6bcda9ed6f58ff1a375: Add support for TLS_FALLBACK_SCSV commit 9564a5fb9ed2eecf6299788db35213cb08397212 Merge: 4f58feb 7640613 Author: Kenny Root Date: Fri Sep 12 17:27:23 2014 +0000 am 76406135: am 6dcb23fe: am f427ec90: Fix the ENGINE_finish/ENGINE_free mixup * commit 76406135cf3a3b88afc979fe8e847b9c3d8b93c1: Fix the ENGINE_finish/ENGINE_free mixup commit 4f58feb0ea49dc089a95efba196032ef3c960a39 Merge: ddac5c6 984b7ec Author: Kenny Root Date: Wed Sep 10 07:07:16 2014 +0000 am 984b7ec6: Fix the ENGINE_finish/ENGINE_free mixup * commit 984b7ec6f5aab314117949a48e448ff4f6b65f16: Fix the ENGINE_finish/ENGINE_free mixup commit ddac5c6d7e413b0d68b388fbdf70dbeb3eeae865 Merge: 5a8ca5b 36ba60b Author: Kenny Root Date: Thu Sep 4 22:41:38 2014 +0000 Merge ""Reset lmp-ub-dev to lmp-dev-plus-aosp"" into lmp-ub-dev commit 36ba60b039f1f30ab1ea8f0e2a4da8ae4e3906e5 Author: Kenny Root Date: Wed Aug 27 12:07:07 2014 Reset lmp-ub-dev to lmp-dev-plus-aosp Bug: 17059757 Change-Id: I581963360da47b574e1e2e20c2851485c36fa62c commit 6a4f2ef9e4ea3ebb321d45ca39b30d634ea3b4ad Merge: 9b187af f67d784 Author: Kenny Root Date: Tue Aug 26 04:17:38 2014 +0000 am f67d784a: Add pre-Honeycomb literal IP matching * commit f67d784abe5cef700240be02c68cecd899cd8e6d: Add pre-Honeycomb literal IP matching commit 9b187af33dcd97915a0371d64fe1ee4aba20d0ba Merge: 714ebea 966ae8a Author: Kenny Root Date: Tue Aug 26 04:17:37 2014 +0000 am 966ae8a6: Read property to enable SNI * commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb: Read property to enable SNI commit 714ebeabcb5e35c6df6a5c21f549cdb6130368c4 Merge: 7724204 54a1ba4 Author: Kenny Root Date: Tue Aug 26 04:06:54 2014 +0000 Merge ""resolved conflicts for merge of 342097db to lmp-dev-plus-aosp"" into lmp-dev-plus-aosp commit 54a1ba421d23bb6d988688c2662715e509172447 Merge: a20d871 342097d Author: Kenny Root Date: Mon Aug 25 21:03:51 2014 resolved conflicts for merge of 342097db to lmp-dev-plus-aosp Change-Id: I853c6b0d3725dafbdc84c4d6d6d1b90529bd949d commit 7724204abf4431d35787c44c4a22cda5489d4e37 Merge: 20f60ac afb3403 Author: Kenny Root Date: Tue Aug 26 00:09:27 2014 +0000 am afb34034: Implement write socket timeouts for unbundled apps * commit afb340348bfc54dbc46964e159fe803f9c93a4dd: Implement write socket timeouts for unbundled apps commit f67d784abe5cef700240be02c68cecd899cd8e6d Author: Kenny Root Date: Wed Aug 20 14:14:26 2014 Add pre-Honeycomb literal IP matching This will allow us to run this code on Gingerbread devices and others that dont have the InetAddress#isNumeric API. Bug: 16658420 Bug: 17059757 Change-Id: I597d539979d58eeaa2677d6f99e911313a550cc1 commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb Author: Kenny Root Date: Mon Aug 18 10:12:20 2014 Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9 commit 342097db97a9b2736531033b2c4b4d8ce4998c67 Author: Kenny Root Date: Wed Aug 20 12:14:52 2014 Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208 commit afb340348bfc54dbc46964e159fe803f9c93a4dd Author: Kenny Root Date: Tue Aug 19 16:33:07 2014 Implement write socket timeouts for unbundled apps Change-Id: I4fd604f057ba4288d4f31bf6b3b93307376023d5 commit 20f60acea153dfdf0c8f75a53d7bd9edb4c7614c Author: Kenny Root Date: Mon Aug 25 11:52:05 2014 Tracking change from AOSP Change-Id: I889af3f7c1de9ef34d9328339e1b421651055ad4 commit 68056b7c9db8a9fb384bbadfc5287730f996896d Merge: 8239dfd cc2ef2e Author: Kenny Root Date: Mon Aug 25 18:03:27 2014 +0000 am cc2ef2e2: Rename hostname fields and methods to reflect usage * commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e: Rename hostname fields and methods to reflect usage commit 8239dfdcc40a69255d7b2feced960d574ea36321 Merge: e9cf759 076138f Author: Kenny Root Date: Thu Aug 21 16:36:24 2014 +0000 am 076138ff: Use consistent naming for SSLSocket arguments * commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11: Use consistent naming for SSLSocket arguments commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e Author: Kenny Root Date: Wed Aug 20 11:26:33 2014 Rename hostname fields and methods to reflect usage The hostname that was supplied when the socket was created is stored as the ""peerHostname"" This is the only one that should be used for Server Name Indication (SNI) purposes. The ""peerHostname"" or the resolved IP address may be used for certificate validation, so keep the use of ""getHostname()"" for cerificate validation. Bug: 16658420 Bug: 17059757 Change-Id: Ifd87dead44fb2f00bbfd5eac7e69fb3fc98e94b4 commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11 Author: Kenny Root Date: Wed Aug 20 11:24:41 2014 Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650 commit e9cf759ac89fb053c01f1db19931beb14a823618 Merge: ababdd1 7ed0fae Author: Kenny Root Date: Tue Aug 19 19:32:43 2014 +0000 am 7ed0fae1: OpenSSLEngineImpl: reduce number of copies needed * commit 7ed0fae1906061766d0042e69ccba20e4a702bbe: OpenSSLEngineImpl: reduce number of copies needed commit 7ed0fae1906061766d0042e69ccba20e4a702bbe Author: Kenny Root Date: Tue Jul 22 13:03:09 2014 OpenSSLEngineImpl: reduce number of copies needed When the ByteBuffer didnt line up exactly with the backing array, it would allocate a new buffer to write into. Instead, add the ability for OpenSSL to read at an offset in the given array so a copy isnt needed. Change-Id: I149d3f94e4b5cbdc010df80439ae3300cbdc87a5 commit ababdd1ae1272eac174e3a449a413ab35afbc435 Merge: 66c31e0 4b050b6 Author: Kenny Root Date: Fri Aug 15 16:23:14 2014 +0000 am 4b050b6f: OpenSSLSocketImpl: Move state checks inside mutex * commit 4b050b6fb06fbb804557eecc72cc4ff0e0277525: OpenSSLSocketImpl: Move state checks inside mutex commit 66c31e0b613ceefc167a2e1fb226a14c78f84537 Merge: f4b895a 0931d51 Author: Kenny Root Date: Thu Aug 14 20:46:43 2014 +0000 am 0931d51c: OpenSSLSocketImpl: Move state checks inside mutex * commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706: OpenSSLSocketImpl: Move state checks inside mutex commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706 Author: Kenny Root Date: Tue Aug 5 15:45:32 2014 OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 Change-Id: I5ecdeb1551a13098d1b66c5e4009607c9951fa38 commit f4b895ae9c424b5c2d49c744131606adccbc49d7 Merge: a35c400 a260ee6 Author: Kenny Root Date: Wed Aug 13 15:35:28 2014 +0000 am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit a260ee6d0caea43f8010f158a4a35fb712935ae3: Revert ""Revert ""Automatic management of OpenSSL error stack"""" commit a35c40017c8690f821351d6460dfeaa2738b884c Merge: 0edc483 30550a8 Author: Kenny Root Date: Wed Aug 13 15:35:27 2014 +0000 am 30550a8b: Fix debugging with unbundled conscrypt * commit 30550a8b64bbcd6ca537680a17b8726932a29937: Fix debugging with unbundled conscrypt commit a260ee6d0caea43f8010f158a4a35fb712935ae3 Author: Kenny Root Date: Tue Aug 12 15:38:10 2014 Revert ""Revert ""Automatic management of OpenSSL error stack"""" The ""else"" statement in OpenSslError::reset wasnt properly resetting the error state which made a second call into sslRead jump into sslSelect when it should have just returned immediately. Change-Id: I22e8025c0497a04e78daa07cef78191a6ca1a70c commit 30550a8b64bbcd6ca537680a17b8726932a29937 Author: Kenny Root Date: Tue Aug 12 15:13:33 2014 Fix debugging with unbundled conscrypt When JNI_TRACE was enabled, there were missing defines for the debugging code since no platform code is included. Also clang complains about more of the debugging statement formats, so we have to move some things around to get it to be happy. Change-Id: I1a6695c2ef2639cc01cfc3d3a8603f010c659844 commit 0edc4833091846d6cb45961fc9458df842fbbad9 Merge: 107a8fb 2411b8b Author: Kenny Root Date: Tue Aug 12 21:46:12 2014 +0000 am 2411b8bd: Merge ""Revert ""Automatic management of OpenSSL error stack"""" * commit 2411b8bdcde72c956f4150e9a5909b7501f50bad: Revert ""Automatic management of OpenSSL error stack"" commit 2411b8bdcde72c956f4150e9a5909b7501f50bad Merge: 3262a8c b514d72 Author: Kenny Root Date: Tue Aug 12 21:39:32 2014 +0000 Merge ""Revert ""Automatic management of OpenSSL error stack"""" commit b514d72b93c3996d97e38eca6db1ad684965fd9b Author: Kenny Root Date: Tue Aug 12 21:39:17 2014 +0000 Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef commit 107a8fba8be5be57933f2638b76ac1243b578b9e Merge: 1de007f 3262a8c Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 3262a8c2741b95103149bcdefe2409c24bfddee9: Automatic management of OpenSSL error stack commit 1de007f9f01be8f07a56235dd924c897088a03cb Merge: 94890ae d1bbcd0 Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am d1bbcd0e: Relax checks for key vs cert for wrapped keys * commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484: Relax checks for key vs cert for wrapped keys commit 3262a8c2741b95103149bcdefe2409c24bfddee9 Merge: d1bbcd0 35666e4 Author: Kenny Root Date: Tue Aug 12 15:31:02 2014 +0000 Merge ""Automatic management of OpenSSL error stack"" commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484 Author: Kenny Root Date: Mon Aug 11 14:56:58 2014 Relax checks for key vs cert for wrapped keys If a key is a wrapped platform key, we must relax the check. The reason is that we may not have the public values we need to pass the EVP_PKEY_cmp checks that this does. Change-Id: I7ab2be51b0968a9cf771edea01d33fe2367c8185 commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8 Author: Kenny Root Date: Tue Aug 5 11:05:00 2014 Automatic management of OpenSSL error stack This removes some complexity in remembering to free the OpenSSL error stack. If you forget, the error will stick around until you make another call. Change-Id: I245a525dcc93077b2bf9909a14a0ef469a2daca4 commit 94890aec5735cde2ea5170fb76cd1b847ea66af8 Merge: 8360485 977f087 Author: Kenny Root Date: Tue Aug 5 16:44:42 2014 +0000 am 977f0877: Fix some JNI_TRACE lines * commit 977f08774c628b4640d5454cde050259856965f8: Fix some JNI_TRACE lines commit 977f08774c628b4640d5454cde050259856965f8 Author: Kenny Root Date: Mon Aug 4 12:15:04 2014 Fix some JNI_TRACE lines During debugging these would be enabled, but they were copy-pastad to with the wrong args. Change-Id: I23f39ff4807e3fa71f3220912aec3c99db6b9454 commit 83604854c5160304cafefc9bd40a72c5ee8506eb Merge: 7db3524 1ffe43e Author: Zoltan Szatmary-Ban Date: Thu Jul 31 13:28:57 2014 +0000 am 1ffe43e8: Merge ""Add possibility to get deleted system Certificate Aliases"" into lmp-dev * commit 1ffe43e8277e883c6663c1fb7cfc5e18ba552c40: Add possibility to get deleted system Certificate Aliases commit 7db3524880092126962b7f502af76b4c84da7350 Merge: 5767d63 ad0cd83 Author: Prameet Shah Date: Wed Jul 30 17:04:13 2014 +0000 am ad0cd830: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit ad0cd83024f38011043d28d70370a8638b88cd72: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 5767d63d22e87becab387b3bd6597fe41eb34d7e Merge: b389e17 26163c2 Author: Prameet Shah Date: Wed Jul 30 16:31:08 2014 +0000 am 26163c26: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit 26163c268a6d2625384b87e907afad8ef19f9a47: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 26163c268a6d2625384b87e907afad8ef19f9a47 Author: Prameet Shah Date: Tue Jul 29 16:45:31 2014 Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700 commit b389e1779651f2c58454a5f98acebd3dd7bc0061 Merge: 5f03b4d e427972 Author: Prameet Shah Date: Thu Jul 24 19:46:28 2014 +0000 am e427972e: OpenSSLEngineImpl: fix unwrap behavior with array * commit e427972eb6141cd67e6d4c9607863a8d990e6be6: OpenSSLEngineImpl: fix unwrap behavior with array commit 5f03b4d63c7632581b032879de791dc82f05ffa0 Merge: 3d935ee 41eb5b6 Author: Prameet Shah Date: Tue Jul 22 19:26:41 2014 +0000 am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 41eb5b65e524d01e28da474bd37e4349b12fb494: OpenSSLEngineImpl: fix unwrap behavior with array commit 41eb5b65e524d01e28da474bd37e4349b12fb494 Author: Prameet Shah Date: Tue Jul 22 11:50:18 2014 OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b commit 3d935eeca25e00b56cfd8d37a657c7b2986889b3 Merge: 0a36f6c affd45a Author: Alex Klyubin Date: Fri Jul 18 00:32:14 2014 +0000 am affd45a4: Merge ""Improve the Javadoc of PSKKeyManager."" into lmp-dev * commit affd45a413cf844dad797ad4972074efb9de43d8: Improve the Javadoc of PSKKeyManager. commit 0a36f6c1f8b2e195c2dd5aea1a386df090c6d470 Merge: 6492180 af4fa68 Author: rich cannings Date: Thu Jul 17 23:47:33 2014 +0000 am af4fa685: Merge ""Log CCS exceptions do not merge."" into lmp-dev * commit af4fa685f246aaa80c93af62faadbc2fe87dc034: Log CCS exceptions do not merge. commit 6492180ce17a3b5ff822cff1783f00e7a4176491 Merge: aac4168 3b7268c Author: Alex Klyubin Date: Thu Jul 17 18:27:39 2014 +0000 am 3b7268cd: Merge ""Improve the Javadoc of PSKKeyManager."" * commit 3b7268cde4a4fc59591da8a93691927ebf3add57: Improve the Javadoc of PSKKeyManager. commit aac4168d8baef7e12d6fa959c6d6ded9892e9651 Merge: 8573ad0 a749c0d Author: Kenny Root Date: Thu Jul 17 17:07:05 2014 +0000 am a749c0d3: Keep enough state to completely reset cipher instances * commit a749c0d351216be38879600ee8ed01c6793aa256: Keep enough state to completely reset cipher instances commit 8573ad0ddcf7e2f8b2e5ac84c34b7ffab303155c Merge: 4ca5b06 70fdb6d Author: Koushik Dutta Date: Thu Jul 17 17:06:36 2014 +0000 am 70fdb6d2: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit 70fdb6d2bfa0c313fe389827f0025288f6aeb947: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit 4ca5b0625e3f5a15ae8adf833ab5a69f9d7d517f Merge: 119abfb ded66f5 Author: Koushik Dutta Date: Thu Jul 17 17:06:35 2014 +0000 am ded66f5f: Various fixes in OpenSSLEngineImpl. * commit ded66f5f696994ce7620552e16a4e9124e69e052: Various fixes in OpenSSLEngineImpl. commit 119abfba1fcd9c9cfbd15d0a4ca9ed2188fdfab0 Merge: 5713cdf cbe1f28 Author: Kenny Root Date: Thu Jul 17 15:56:57 2014 +0000 am cbe1f28a: Merge ""Keep enough state to completely reset cipher instances"" * commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae: Keep enough state to completely reset cipher instances commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae Merge: e08f238 084e308 Author: Kenny Root Date: Thu Jul 17 15:48:58 2014 +0000 Merge ""Keep enough state to completely reset cipher instances"" commit 3b7268cde4a4fc59591da8a93691927ebf3add57 Merge: cbe1f28 7ac13e0 Author: Alex Klyubin Date: Thu Jul 17 18:20:43 2014 +0000 Merge ""Improve the Javadoc of PSKKeyManager."" commit 5713cdf71c5c6e5179e8369263c702e9512afdd0 Merge: cf55719 e08f238 Author: Koushik Dutta Date: Wed Jul 16 22:05:17 2014 +0000 am e08f2385: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit e08f238580e8ee471012bef8240c8d3397c7b780: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit cf557195a9b60d7f51a48500afde38481ddbc91c Merge: cbbd7d1 986aeb7 Author: Kenny Root Date: Wed Jul 16 21:41:12 2014 +0000 am 986aeb78: Merge ""Various fixes in OpenSSLEngineImpl."" * commit 986aeb78e533540463daf1753e24840f75b25ce6: Various fixes in OpenSSLEngineImpl. commit e08f238580e8ee471012bef8240c8d3397c7b780 Author: Koushik Dutta Date: Tue Jul 15 22:40:23 2014 OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. Change-Id: Idc78204b7077fb367b64e1867c807cd39f596f98 commit 7ac13e03a79d0c99d181b1a28b1b3699ba3d5739 Author: Alex Klyubin Date: Wed Jul 16 08:33:02 2014 Improve the Javadoc of PSKKeyManager. This clarifies several points and adds sample code. Bug: 15073623 Change-Id: I6e8aadc52277e238a998d6cee36795dab1151d58 commit 986aeb78e533540463daf1753e24840f75b25ce6 Merge: 8f9ac1a bdfcc18 Author: Kenny Root Date: Wed Jul 16 21:15:30 2014 +0000 Merge ""Various fixes in OpenSSLEngineImpl."" commit bdfcc189efe41a3f812aeb55ea634bace67d159a Author: Koushik Dutta Date: Sat Jun 28 19:19:21 2014 Various fixes in OpenSSLEngineImpl. Fix ""Buffers were not large enough"" exception by directly using the destination buffers. Corrections around bytesProduced and bytesConsumed behavior. Return BUFFER_OVERFLOW if a zero length destination is provided to unwrap. Change-Id: I1f1e9b72cd6968ed4f3c3c0edccbccebc33d6790 commit cbbd7d10e8e484c44a78e5b27e8fecda195f1692 Merge: ec7f8e6 fdb7d8c Author: Alex Klyubin Date: Tue Jul 15 18:49:14 2014 +0000 am fdb7d8c5: Enable PSK cipher suites when PSKKeyManager is provided. * commit fdb7d8c53dabac5551e2499d045ba6829bcfc0a0: Enable PSK cipher suites when PSKKeyManager is provided. commit ec7f8e6b27330160f88540f4f2ace7bc2a0720a3 Merge: 5b8ccf1 8f9ac1a Author: Alex Klyubin Date: Tue Jul 15 15:53:46 2014 +0000 am 8f9ac1af: Enable PSK cipher suites when PSKKeyManager is provided. * commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17: Enable PSK cipher suites when PSKKeyManager is provided. commit 5b8ccf1b09df6f35c1709bfc8fd727a291094a5b Merge: 69a2e46 6e2315f Author: Ed Heyl Date: Tue Jul 15 13:34:25 2014 +0000 am 6e2315fd: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. * commit 6e2315fd96c3c4a47450c1a437babacc94bc31a6: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. commit 084e3086be1d7a6b9280b64c7c8cdb7b41a13bea Author: Kenny Root Date: Mon Jul 14 13:25:32 2014 Keep enough state to completely reset cipher instances OpenSSLs RC4 mutates the given key. AES/CTR mutates the IV. We must store these values locally to enable ""doFinal"" to cause the Cipher instance to be reset to what it was right after ""init"". Note that resetting and encrypting with the same key or IV breaks semantic security. Bug: 16298401 Bug: Change-Id: Ie7e4dcb6cf6cc33ddad31d6b47066dc1b34e6894 commit 69a2e460cc0a40e1b951e400589b9932609079ec Merge: 8b7bb32 bca895f Author: David Benjamin Date: Mon Jul 14 18:17:28 2014 +0000 am bca895f8: Pass output buffer length into EVP_DigestSignFinal. * commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d: Pass output buffer length into EVP_DigestSignFinal. commit 8b7bb32af09a01e80442b70dd23e6997a937f103 Merge: a2404c9 e79c25b Author: Kenny Root Date: Mon Jul 14 18:17:28 2014 +0000 am e79c25bf: Merge ""DHKeyPairGenerator: use provided params"" * commit e79c25bf33e10da41e489c537823f678e1a1169c: DHKeyPairGenerator: use provided params commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17 Author: Alex Klyubin Date: Thu Jun 19 13:37:24 2014 Enable PSK cipher suites when PSKKeyManager is provided. This enables TLS-PSK cipher suites by default iff SSLContext is initialized with a PSKKeyManager. For consistency, X.509 based cipher suites are no longer enabled by default at all times they are now only enabled by default iff SSLContext is initialized with a X509KeyManager or a X509TrustManager. When both X.509 and PSK cipher suites need to be enabled, PSK cipher suites are given higher priority in the resulting list of cipher suites. This is based on the assumption that in most cases users of TLS/SSL who enable TLS-PSK would prefer TLS-PSK to be used when the peer supports TLS-PSK. Bug: 15073623 Change-Id: I8e2bc3e7a1ea8a986e468973b6bad19dc6b7bc3c commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d Author: David Benjamin Date: Thu Jul 10 18:12:08 2014 Pass output buffer length into EVP_DigestSignFinal. EVP_DigestSignFinal expects the input buffer length as *siglen on input. In addition, if sigret is NULL, it returns the buffer size needed. Use this rather than making assumptions about the EVP_PKEY used to initialize the EVP_MD_CTX. commit e79c25bf33e10da41e489c537823f678e1a1169c Merge: a328492 9b226f9 Author: Kenny Root Date: Fri Jul 11 16:46:23 2014 +0000 Merge ""DHKeyPairGenerator: use provided params"" commit 9b226f90a992a4a2267b7a813e3b869851945c4d Author: Kenny Root Date: Thu Jul 10 14:50:48 2014 DHKeyPairGenerator: use provided params If the prime is provided in the DHParam"
,,0.9145,conscrypt,"Fix OpenSSLSocketImpl.getPort when SNI is used. We were using a non-null hostname as a hint that the socket was constructed with an explicit host and port. This is no longer true because the hostname can be non-null when SNI is used (i.e setHostname is called with a non-null hostname). bug: 18428603 (cherry picked from commit 131640979c0ba3f18581cee9bf5c925ec8a7372b) Change-Id: I5a76a17259e4f50a0b8a29b37a647265a755e326/am 1afaf2bb: am 13164097: Fix OpenSSLSocketImpl.getPort when SNI is used. * commit 1afaf2bb33a3451c16d7d9e820afbc031229a7ea: Fix OpenSSLSocketImpl.getPort when SNI is used./am 13164097: Fix OpenSSLSocketImpl.getPort when SNI is used. * commit 131640979c0ba3f18581cee9bf5c925ec8a7372b: Fix OpenSSLSocketImpl.getPort when SNI is used./Fix OpenSSLSocketImpl.getPort when SNI is used. We were using a non-null hostname as a hint that the socket was constructed with an explicit host and port. This is no longer true because the hostname can be non-null when SNI is used (i.e setHostname is called with a non-null hostname). bug: 18428603 Change-Id: I1dba81f7853e6871989e114dc77f3956621c77fa/Squashed commit of changes from lmp-ub-dev Contains the following changes: commit e31d982cdb0f8e6ef05d1e412576888015e1da17 Merge: eaebc54 b73be72 Author: Neil Fuller Date: Wed Oct 22 10:34:23 2014 +0000 am b73be72e: am 3e21a289: (-s ours) TLS_FALLBACK_SCSV CTS fix for klp-modular-dev * commit b73be72ed97da8f36450d95d52f485cc6f451c61: TLS_FALLBACK_SCSV CTS fix for klp-modular-dev commit eaebc544f3a10c53d7d2f908514122caba569e14 Merge: 223b5da cd50afa Author: Kenny Root Date: Tue Oct 14 17:30:19 2014 +0000 Merge ""Fix SSLEngine to support session resumption."" into lmp-ub-dev commit 223b5da5d70e47b1a497e86474493925b568f6d7 Merge: 8737796 cb7a360 Author: Neil Fuller Date: Thu Oct 9 14:52:00 2014 +0000 am cb7a3605: am ea961ada: Apply conscrypt changes from merge commit * commit cb7a36050f34d3c16be00d532411820761eeb276: Apply conscrypt changes from merge commit commit cd50afad1567b1311e6e979e94a7167b7bf69c94 Author: Doug Steedman Date: Mon Oct 6 13:16:15 2014 Fix SSLEngine to support session resumption. Bug: 17877118 Change-Id: I388b59cde58fdc506ecac9f536e4bbd9161df6ad commit 8737796a646eaec94df32827752a71aee74bd46f Merge: 9564a5f 8d7e23e Author: Kenny Root Date: Mon Oct 6 22:34:20 2014 +0000 am 8d7e23e1: Add support for TLS_FALLBACK_SCSV * commit 8d7e23e117da591a8d48e6bcda9ed6f58ff1a375: Add support for TLS_FALLBACK_SCSV commit 9564a5fb9ed2eecf6299788db35213cb08397212 Merge: 4f58feb 7640613 Author: Kenny Root Date: Fri Sep 12 17:27:23 2014 +0000 am 76406135: am 6dcb23fe: am f427ec90: Fix the ENGINE_finish/ENGINE_free mixup * commit 76406135cf3a3b88afc979fe8e847b9c3d8b93c1: Fix the ENGINE_finish/ENGINE_free mixup commit 4f58feb0ea49dc089a95efba196032ef3c960a39 Merge: ddac5c6 984b7ec Author: Kenny Root Date: Wed Sep 10 07:07:16 2014 +0000 am 984b7ec6: Fix the ENGINE_finish/ENGINE_free mixup * commit 984b7ec6f5aab314117949a48e448ff4f6b65f16: Fix the ENGINE_finish/ENGINE_free mixup commit ddac5c6d7e413b0d68b388fbdf70dbeb3eeae865 Merge: 5a8ca5b 36ba60b Author: Kenny Root Date: Thu Sep 4 22:41:38 2014 +0000 Merge ""Reset lmp-ub-dev to lmp-dev-plus-aosp"" into lmp-ub-dev commit 36ba60b039f1f30ab1ea8f0e2a4da8ae4e3906e5 Author: Kenny Root Date: Wed Aug 27 12:07:07 2014 Reset lmp-ub-dev to lmp-dev-plus-aosp Bug: 17059757 Change-Id: I581963360da47b574e1e2e20c2851485c36fa62c commit 6a4f2ef9e4ea3ebb321d45ca39b30d634ea3b4ad Merge: 9b187af f67d784 Author: Kenny Root Date: Tue Aug 26 04:17:38 2014 +0000 am f67d784a: Add pre-Honeycomb literal IP matching * commit f67d784abe5cef700240be02c68cecd899cd8e6d: Add pre-Honeycomb literal IP matching commit 9b187af33dcd97915a0371d64fe1ee4aba20d0ba Merge: 714ebea 966ae8a Author: Kenny Root Date: Tue Aug 26 04:17:37 2014 +0000 am 966ae8a6: Read property to enable SNI * commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb: Read property to enable SNI commit 714ebeabcb5e35c6df6a5c21f549cdb6130368c4 Merge: 7724204 54a1ba4 Author: Kenny Root Date: Tue Aug 26 04:06:54 2014 +0000 Merge ""resolved conflicts for merge of 342097db to lmp-dev-plus-aosp"" into lmp-dev-plus-aosp commit 54a1ba421d23bb6d988688c2662715e509172447 Merge: a20d871 342097d Author: Kenny Root Date: Mon Aug 25 21:03:51 2014 resolved conflicts for merge of 342097db to lmp-dev-plus-aosp Change-Id: I853c6b0d3725dafbdc84c4d6d6d1b90529bd949d commit 7724204abf4431d35787c44c4a22cda5489d4e37 Merge: 20f60ac afb3403 Author: Kenny Root Date: Tue Aug 26 00:09:27 2014 +0000 am afb34034: Implement write socket timeouts for unbundled apps * commit afb340348bfc54dbc46964e159fe803f9c93a4dd: Implement write socket timeouts for unbundled apps commit f67d784abe5cef700240be02c68cecd899cd8e6d Author: Kenny Root Date: Wed Aug 20 14:14:26 2014 Add pre-Honeycomb literal IP matching This will allow us to run this code on Gingerbread devices and others that dont have the InetAddress#isNumeric API. Bug: 16658420 Bug: 17059757 Change-Id: I597d539979d58eeaa2677d6f99e911313a550cc1 commit 966ae8a6e12f3235b1cb041e687bda11b41fe4eb Author: Kenny Root Date: Mon Aug 18 10:12:20 2014 Read property to enable SNI Read the system property ""jsse.enableSNIExtension"" on whether to enable Server Name Indication (SNI) extension. For unbundled builds, this will be enabled by default. For platform builds, this will be disabled by default. Bug: 16658420 Bug: 17059757 Change-Id: I774f5406bf3fe601a42c4ef5e708b31800147eb9 commit 342097db97a9b2736531033b2c4b4d8ce4998c67 Author: Kenny Root Date: Wed Aug 20 12:14:52 2014 Validate hostname is usable for SNI According to RFC 6066 section 3, the hostname listed in the Server Name Indication (SNI) field is a fully qualified domain name and IP addresses are not permitted. Bug: 16658420 Bug: 17059757 Change-Id: I804e46b6e66599b2770f0f4f0534467987e51208 commit afb340348bfc54dbc46964e159fe803f9c93a4dd Author: Kenny Root Date: Tue Aug 19 16:33:07 2014 Implement write socket timeouts for unbundled apps Change-Id: I4fd604f057ba4288d4f31bf6b3b93307376023d5 commit 20f60acea153dfdf0c8f75a53d7bd9edb4c7614c Author: Kenny Root Date: Mon Aug 25 11:52:05 2014 Tracking change from AOSP Change-Id: I889af3f7c1de9ef34d9328339e1b421651055ad4 commit 68056b7c9db8a9fb384bbadfc5287730f996896d Merge: 8239dfd cc2ef2e Author: Kenny Root Date: Mon Aug 25 18:03:27 2014 +0000 am cc2ef2e2: Rename hostname fields and methods to reflect usage * commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e: Rename hostname fields and methods to reflect usage commit 8239dfdcc40a69255d7b2feced960d574ea36321 Merge: e9cf759 076138f Author: Kenny Root Date: Thu Aug 21 16:36:24 2014 +0000 am 076138ff: Use consistent naming for SSLSocket arguments * commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11: Use consistent naming for SSLSocket arguments commit cc2ef2e2e9ee64f2e0ac2abc7fdf636e2f81fa5e Author: Kenny Root Date: Wed Aug 20 11:26:33 2014 Rename hostname fields and methods to reflect usage The hostname that was supplied when the socket was created is stored as the ""peerHostname"" This is the only one that should be used for Server Name Indication (SNI) purposes. The ""peerHostname"" or the resolved IP address may be used for certificate validation, so keep the use of ""getHostname()"" for cerificate validation. Bug: 16658420 Bug: 17059757 Change-Id: Ifd87dead44fb2f00bbfd5eac7e69fb3fc98e94b4 commit 076138ff29d805ec5a32d6ad96a18ef08c7f1b11 Author: Kenny Root Date: Wed Aug 20 11:24:41 2014 Use consistent naming for SSLSocket arguments This changes all the host to be hostname and anything that takes an InetAddress will have the name of address to avoid confusing it with a hostname. Bug: 16658420 Bug: 17059757 Change-Id: Iac0628d2d156023dbb80c2e636af6bfe63f46650 commit e9cf759ac89fb053c01f1db19931beb14a823618 Merge: ababdd1 7ed0fae Author: Kenny Root Date: Tue Aug 19 19:32:43 2014 +0000 am 7ed0fae1: OpenSSLEngineImpl: reduce number of copies needed * commit 7ed0fae1906061766d0042e69ccba20e4a702bbe: OpenSSLEngineImpl: reduce number of copies needed commit 7ed0fae1906061766d0042e69ccba20e4a702bbe Author: Kenny Root Date: Tue Jul 22 13:03:09 2014 OpenSSLEngineImpl: reduce number of copies needed When the ByteBuffer didnt line up exactly with the backing array, it would allocate a new buffer to write into. Instead, add the ability for OpenSSL to read at an offset in the given array so a copy isnt needed. Change-Id: I149d3f94e4b5cbdc010df80439ae3300cbdc87a5 commit ababdd1ae1272eac174e3a449a413ab35afbc435 Merge: 66c31e0 4b050b6 Author: Kenny Root Date: Fri Aug 15 16:23:14 2014 +0000 am 4b050b6f: OpenSSLSocketImpl: Move state checks inside mutex * commit 4b050b6fb06fbb804557eecc72cc4ff0e0277525: OpenSSLSocketImpl: Move state checks inside mutex commit 66c31e0b613ceefc167a2e1fb226a14c78f84537 Merge: f4b895a 0931d51 Author: Kenny Root Date: Thu Aug 14 20:46:43 2014 +0000 am 0931d51c: OpenSSLSocketImpl: Move state checks inside mutex * commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706: OpenSSLSocketImpl: Move state checks inside mutex commit 0931d51c58b2dc2f612298f99fbf0fa6ed4c3706 Author: Kenny Root Date: Tue Aug 5 15:45:32 2014 OpenSSLSocketImpl: Move state checks inside mutex Checking the state of the connection is unreliable if SSL_read and SSL_write are happening in another thread. Move the state checks inside our application mutex so we dont run into another thread mutating the state at the same time. Bug: 15606096 Change-Id: I5ecdeb1551a13098d1b66c5e4009607c9951fa38 commit f4b895ae9c424b5c2d49c744131606adccbc49d7 Merge: a35c400 a260ee6 Author: Kenny Root Date: Wed Aug 13 15:35:28 2014 +0000 am a260ee6d: Revert ""Revert ""Automatic management of OpenSSL error stack"""" * commit a260ee6d0caea43f8010f158a4a35fb712935ae3: Revert ""Revert ""Automatic management of OpenSSL error stack"""" commit a35c40017c8690f821351d6460dfeaa2738b884c Merge: 0edc483 30550a8 Author: Kenny Root Date: Wed Aug 13 15:35:27 2014 +0000 am 30550a8b: Fix debugging with unbundled conscrypt * commit 30550a8b64bbcd6ca537680a17b8726932a29937: Fix debugging with unbundled conscrypt commit a260ee6d0caea43f8010f158a4a35fb712935ae3 Author: Kenny Root Date: Tue Aug 12 15:38:10 2014 Revert ""Revert ""Automatic management of OpenSSL error stack"""" The ""else"" statement in OpenSslError::reset wasnt properly resetting the error state which made a second call into sslRead jump into sslSelect when it should have just returned immediately. Change-Id: I22e8025c0497a04e78daa07cef78191a6ca1a70c commit 30550a8b64bbcd6ca537680a17b8726932a29937 Author: Kenny Root Date: Tue Aug 12 15:13:33 2014 Fix debugging with unbundled conscrypt When JNI_TRACE was enabled, there were missing defines for the debugging code since no platform code is included. Also clang complains about more of the debugging statement formats, so we have to move some things around to get it to be happy. Change-Id: I1a6695c2ef2639cc01cfc3d3a8603f010c659844 commit 0edc4833091846d6cb45961fc9458df842fbbad9 Merge: 107a8fb 2411b8b Author: Kenny Root Date: Tue Aug 12 21:46:12 2014 +0000 am 2411b8bd: Merge ""Revert ""Automatic management of OpenSSL error stack"""" * commit 2411b8bdcde72c956f4150e9a5909b7501f50bad: Revert ""Automatic management of OpenSSL error stack"" commit 2411b8bdcde72c956f4150e9a5909b7501f50bad Merge: 3262a8c b514d72 Author: Kenny Root Date: Tue Aug 12 21:39:32 2014 +0000 Merge ""Revert ""Automatic management of OpenSSL error stack"""" commit b514d72b93c3996d97e38eca6db1ad684965fd9b Author: Kenny Root Date: Tue Aug 12 21:39:17 2014 +0000 Revert ""Automatic management of OpenSSL error stack"" This reverts commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8. Change-Id: I926d159c4c4b99250caef750732976c1e601e9ef commit 107a8fba8be5be57933f2638b76ac1243b578b9e Merge: 1de007f 3262a8c Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am 3262a8c2: Merge ""Automatic management of OpenSSL error stack"" * commit 3262a8c2741b95103149bcdefe2409c24bfddee9: Automatic management of OpenSSL error stack commit 1de007f9f01be8f07a56235dd924c897088a03cb Merge: 94890ae d1bbcd0 Author: Kenny Root Date: Tue Aug 12 15:50:14 2014 +0000 am d1bbcd0e: Relax checks for key vs cert for wrapped keys * commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484: Relax checks for key vs cert for wrapped keys commit 3262a8c2741b95103149bcdefe2409c24bfddee9 Merge: d1bbcd0 35666e4 Author: Kenny Root Date: Tue Aug 12 15:31:02 2014 +0000 Merge ""Automatic management of OpenSSL error stack"" commit d1bbcd0ec973e1b8465c204c13b4925fd86e6484 Author: Kenny Root Date: Mon Aug 11 14:56:58 2014 Relax checks for key vs cert for wrapped keys If a key is a wrapped platform key, we must relax the check. The reason is that we may not have the public values we need to pass the EVP_PKEY_cmp checks that this does. Change-Id: I7ab2be51b0968a9cf771edea01d33fe2367c8185 commit 35666e4cb0fcd063a21d17eebbb571b4e4e822b8 Author: Kenny Root Date: Tue Aug 5 11:05:00 2014 Automatic management of OpenSSL error stack This removes some complexity in remembering to free the OpenSSL error stack. If you forget, the error will stick around until you make another call. Change-Id: I245a525dcc93077b2bf9909a14a0ef469a2daca4 commit 94890aec5735cde2ea5170fb76cd1b847ea66af8 Merge: 8360485 977f087 Author: Kenny Root Date: Tue Aug 5 16:44:42 2014 +0000 am 977f0877: Fix some JNI_TRACE lines * commit 977f08774c628b4640d5454cde050259856965f8: Fix some JNI_TRACE lines commit 977f08774c628b4640d5454cde050259856965f8 Author: Kenny Root Date: Mon Aug 4 12:15:04 2014 Fix some JNI_TRACE lines During debugging these would be enabled, but they were copy-pastad to with the wrong args. Change-Id: I23f39ff4807e3fa71f3220912aec3c99db6b9454 commit 83604854c5160304cafefc9bd40a72c5ee8506eb Merge: 7db3524 1ffe43e Author: Zoltan Szatmary-Ban Date: Thu Jul 31 13:28:57 2014 +0000 am 1ffe43e8: Merge ""Add possibility to get deleted system Certificate Aliases"" into lmp-dev * commit 1ffe43e8277e883c6663c1fb7cfc5e18ba552c40: Add possibility to get deleted system Certificate Aliases commit 7db3524880092126962b7f502af76b4c84da7350 Merge: 5767d63 ad0cd83 Author: Prameet Shah Date: Wed Jul 30 17:04:13 2014 +0000 am ad0cd830: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit ad0cd83024f38011043d28d70370a8638b88cd72: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 5767d63d22e87becab387b3bd6597fe41eb34d7e Merge: b389e17 26163c2 Author: Prameet Shah Date: Wed Jul 30 16:31:08 2014 +0000 am 26163c26: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() * commit 26163c268a6d2625384b87e907afad8ef19f9a47: Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() commit 26163c268a6d2625384b87e907afad8ef19f9a47 Author: Prameet Shah Date: Tue Jul 29 16:45:31 2014 Added CLOSED_INBOUND and CLOSED_OUTBOUND states to OpenSSLEngineImpl#getHandshakeStatus() Bug: Change-Id: I5bcaf3ee8910ff75e785baed4c4604fee6c5e700 commit b389e1779651f2c58454a5f98acebd3dd7bc0061 Merge: 5f03b4d e427972 Author: Prameet Shah Date: Thu Jul 24 19:46:28 2014 +0000 am e427972e: OpenSSLEngineImpl: fix unwrap behavior with array * commit e427972eb6141cd67e6d4c9607863a8d990e6be6: OpenSSLEngineImpl: fix unwrap behavior with array commit 5f03b4d63c7632581b032879de791dc82f05ffa0 Merge: 3d935ee 41eb5b6 Author: Prameet Shah Date: Tue Jul 22 19:26:41 2014 +0000 am 41eb5b65: OpenSSLEngineImpl: fix unwrap behavior with array * commit 41eb5b65e524d01e28da474bd37e4349b12fb494: OpenSSLEngineImpl: fix unwrap behavior with array commit 41eb5b65e524d01e28da474bd37e4349b12fb494 Author: Prameet Shah Date: Tue Jul 22 11:50:18 2014 OpenSSLEngineImpl: fix unwrap behavior with array The decrypted bytes should written sequentially into each buffer of the destination array until its full before moving to the next buffer. Change-Id: I2454249c167deafde6c12134d3c8cd658cd7c21b commit 3d935eeca25e00b56cfd8d37a657c7b2986889b3 Merge: 0a36f6c affd45a Author: Alex Klyubin Date: Fri Jul 18 00:32:14 2014 +0000 am affd45a4: Merge ""Improve the Javadoc of PSKKeyManager."" into lmp-dev * commit affd45a413cf844dad797ad4972074efb9de43d8: Improve the Javadoc of PSKKeyManager. commit 0a36f6c1f8b2e195c2dd5aea1a386df090c6d470 Merge: 6492180 af4fa68 Author: rich cannings Date: Thu Jul 17 23:47:33 2014 +0000 am af4fa685: Merge ""Log CCS exceptions do not merge."" into lmp-dev * commit af4fa685f246aaa80c93af62faadbc2fe87dc034: Log CCS exceptions do not merge. commit 6492180ce17a3b5ff822cff1783f00e7a4176491 Merge: aac4168 3b7268c Author: Alex Klyubin Date: Thu Jul 17 18:27:39 2014 +0000 am 3b7268cd: Merge ""Improve the Javadoc of PSKKeyManager."" * commit 3b7268cde4a4fc59591da8a93691927ebf3add57: Improve the Javadoc of PSKKeyManager. commit aac4168d8baef7e12d6fa959c6d6ded9892e9651 Merge: 8573ad0 a749c0d Author: Kenny Root Date: Thu Jul 17 17:07:05 2014 +0000 am a749c0d3: Keep enough state to completely reset cipher instances * commit a749c0d351216be38879600ee8ed01c6793aa256: Keep enough state to completely reset cipher instances commit 8573ad0ddcf7e2f8b2e5ac84c34b7ffab303155c Merge: 4ca5b06 70fdb6d Author: Koushik Dutta Date: Thu Jul 17 17:06:36 2014 +0000 am 70fdb6d2: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit 70fdb6d2bfa0c313fe389827f0025288f6aeb947: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit 4ca5b0625e3f5a15ae8adf833ab5a69f9d7d517f Merge: 119abfb ded66f5 Author: Koushik Dutta Date: Thu Jul 17 17:06:35 2014 +0000 am ded66f5f: Various fixes in OpenSSLEngineImpl. * commit ded66f5f696994ce7620552e16a4e9124e69e052: Various fixes in OpenSSLEngineImpl. commit 119abfba1fcd9c9cfbd15d0a4ca9ed2188fdfab0 Merge: 5713cdf cbe1f28 Author: Kenny Root Date: Thu Jul 17 15:56:57 2014 +0000 am cbe1f28a: Merge ""Keep enough state to completely reset cipher instances"" * commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae: Keep enough state to completely reset cipher instances commit cbe1f28adf64396561a3b65bf1452dfa9b6e35ae Merge: e08f238 084e308 Author: Kenny Root Date: Thu Jul 17 15:48:58 2014 +0000 Merge ""Keep enough state to completely reset cipher instances"" commit 3b7268cde4a4fc59591da8a93691927ebf3add57 Merge: cbe1f28 7ac13e0 Author: Alex Klyubin Date: Thu Jul 17 18:20:43 2014 +0000 Merge ""Improve the Javadoc of PSKKeyManager."" commit 5713cdf71c5c6e5179e8369263c702e9512afdd0 Merge: cf55719 e08f238 Author: Koushik Dutta Date: Wed Jul 16 22:05:17 2014 +0000 am e08f2385: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. * commit e08f238580e8ee471012bef8240c8d3397c7b780: OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. commit cf557195a9b60d7f51a48500afde38481ddbc91c Merge: cbbd7d1 986aeb7 Author: Kenny Root Date: Wed Jul 16 21:41:12 2014 +0000 am 986aeb78: Merge ""Various fixes in OpenSSLEngineImpl."" * commit 986aeb78e533540463daf1753e24840f75b25ce6: Various fixes in OpenSSLEngineImpl. commit e08f238580e8ee471012bef8240c8d3397c7b780 Author: Koushik Dutta Date: Tue Jul 15 22:40:23 2014 OpenSSLEngine Impl: Fix bug where SSL Handshake never completes when using NPN. Change-Id: Idc78204b7077fb367b64e1867c807cd39f596f98 commit 7ac13e03a79d0c99d181b1a28b1b3699ba3d5739 Author: Alex Klyubin Date: Wed Jul 16 08:33:02 2014 Improve the Javadoc of PSKKeyManager. This clarifies several points and adds sample code. Bug: 15073623 Change-Id: I6e8aadc52277e238a998d6cee36795dab1151d58 commit 986aeb78e533540463daf1753e24840f75b25ce6 Merge: 8f9ac1a bdfcc18 Author: Kenny Root Date: Wed Jul 16 21:15:30 2014 +0000 Merge ""Various fixes in OpenSSLEngineImpl."" commit bdfcc189efe41a3f812aeb55ea634bace67d159a Author: Koushik Dutta Date: Sat Jun 28 19:19:21 2014 Various fixes in OpenSSLEngineImpl. Fix ""Buffers were not large enough"" exception by directly using the destination buffers. Corrections around bytesProduced and bytesConsumed behavior. Return BUFFER_OVERFLOW if a zero length destination is provided to unwrap. Change-Id: I1f1e9b72cd6968ed4f3c3c0edccbccebc33d6790 commit cbbd7d10e8e484c44a78e5b27e8fecda195f1692 Merge: ec7f8e6 fdb7d8c Author: Alex Klyubin Date: Tue Jul 15 18:49:14 2014 +0000 am fdb7d8c5: Enable PSK cipher suites when PSKKeyManager is provided. * commit fdb7d8c53dabac5551e2499d045ba6829bcfc0a0: Enable PSK cipher suites when PSKKeyManager is provided. commit ec7f8e6b27330160f88540f4f2ace7bc2a0720a3 Merge: 5b8ccf1 8f9ac1a Author: Alex Klyubin Date: Tue Jul 15 15:53:46 2014 +0000 am 8f9ac1af: Enable PSK cipher suites when PSKKeyManager is provided. * commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17: Enable PSK cipher suites when PSKKeyManager is provided. commit 5b8ccf1b09df6f35c1709bfc8fd727a291094a5b Merge: 69a2e46 6e2315f Author: Ed Heyl Date: Tue Jul 15 13:34:25 2014 +0000 am 6e2315fd: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. * commit 6e2315fd96c3c4a47450c1a437babacc94bc31a6: reconcile aosp (e79c25bf33e10da41e489c537823f678e1a1169c) after branching. Please do not merge. commit 084e3086be1d7a6b9280b64c7c8cdb7b41a13bea Author: Kenny Root Date: Mon Jul 14 13:25:32 2014 Keep enough state to completely reset cipher instances OpenSSLs RC4 mutates the given key. AES/CTR mutates the IV. We must store these values locally to enable ""doFinal"" to cause the Cipher instance to be reset to what it was right after ""init"". Note that resetting and encrypting with the same key or IV breaks semantic security. Bug: 16298401 Bug: Change-Id: Ie7e4dcb6cf6cc33ddad31d6b47066dc1b34e6894 commit 69a2e460cc0a40e1b951e400589b9932609079ec Merge: 8b7bb32 bca895f Author: David Benjamin Date: Mon Jul 14 18:17:28 2014 +0000 am bca895f8: Pass output buffer length into EVP_DigestSignFinal. * commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d: Pass output buffer length into EVP_DigestSignFinal. commit 8b7bb32af09a01e80442b70dd23e6997a937f103 Merge: a2404c9 e79c25b Author: Kenny Root Date: Mon Jul 14 18:17:28 2014 +0000 am e79c25bf: Merge ""DHKeyPairGenerator: use provided params"" * commit e79c25bf33e10da41e489c537823f678e1a1169c: DHKeyPairGenerator: use provided params commit 8f9ac1af0cbdf00e5e47aee32c132522ebc3bd17 Author: Alex Klyubin Date: Thu Jun 19 13:37:24 2014 Enable PSK cipher suites when PSKKeyManager is provided. This enables TLS-PSK cipher suites by default iff SSLContext is initialized with a PSKKeyManager. For consistency, X.509 based cipher suites are no longer enabled by default at all times they are now only enabled by default iff SSLContext is initialized with a X509KeyManager or a X509TrustManager. When both X.509 and PSK cipher suites need to be enabled, PSK cipher suites are given higher priority in the resulting list of cipher suites. This is based on the assumption that in most cases users of TLS/SSL who enable TLS-PSK would prefer TLS-PSK to be used when the peer supports TLS-PSK. Bug: 15073623 Change-Id: I8e2bc3e7a1ea8a986e468973b6bad19dc6b7bc3c commit bca895f809dd2cef7a0834f0bfeb2a06e42b277d Author: David Benjamin Date: Thu Jul 10 18:12:08 2014 Pass output buffer length into EVP_DigestSignFinal. EVP_DigestSignFinal expects the input buffer length as *siglen on input. In addition, if sigret is NULL, it returns the buffer size needed. Use this rather than making assumptions about the EVP_PKEY used to initialize the EVP_MD_CTX. commit e79c25bf33e10da41e489c537823f678e1a1169c Merge: a328492 9b226f9 Author: Kenny Root Date: Fri Jul 11 16:46:23 2014 +0000 Merge ""DHKeyPairGenerator: use provided params"" commit 9b226f90a992a4a2267b7a813e3b869851945c4d Author: Kenny Root Date: Thu Jul 10 14:50:48 2014 DHKeyPairGenerator: use provided params If the prime is provided in the DHParameterSpec, then use it to generate the key. Bug: 16188130 Change-Id: I42de02c71a58d691ef7ba6e2252367105687b758 Bug: 18388980 Change-Id: I853b02a32db113a5af3f6166e7d61fab58c3ff73/"
,,0.2755,conscrypt,"OpenSSLSocketImpl: Dont accidentally create a SocketImpl. We dont call super.close() when were wrapping a socket, so well have to be careful not to call any superclass methods that might end up creating a SocketImpl. bug: 27250522 (cherry picked from commit edae6d2b2efbd85646fea384ec76b11f099a8fca) Change-Id: Iabeade852e6a5c3bc923c7b3601f3edf3322fee2/OpenSSLSocketImpl: Dont accidentally create a SocketImpl. We dont call super.close() when were wrapping a socket, so well have to be careful not to call any superclass methods that might end up creating a SocketImpl. bug: 27250522 Change-Id: Ie98127d002cc3b3dd3dd419b62adcfec47817479/"
,,0.2489,conscrypt,"Merge ""Fix updateAAD when offset is not 0"" into mnc-dev am: 5ad20a9 * commit 5ad20a9d95b6ec2e0c8a21f810b1eccc57226283: Fix updateAAD when offset is not 0/Merge ""Fix updateAAD when offset is not 0"" into mnc-dev/Fix updateAAD when offset is not 0 am: 95cf7b9 * commit 95cf7b9b7fbabb77cd341f17da79c947bcc934ab: Fix updateAAD when offset is not 0/Fix updateAAD when offset is not 0 Due to AAD data not being reset when a Cipher instance was re-used, this bug was never uncovered by tests that actually exercise this case. (cherry picked from commit 95cf7b9b7fbabb77cd341f17da79c947bcc934ab) Bug: 27696681 Bug: 27324690 Change-Id: Iae9b5794f212a8fc4eeff2a651332e7490f5cada/Fix updateAAD when offset is not 0 Due to AAD data not being reset when a Cipher instance was re-used, this bug was never uncovered by tests that actually exercise this case. Bug: 27696681 Bug: 27324690 Change-Id: Iae9b5794f212a8fc4eeff2a651332e7490f5cada/OpenSSLCipher: multiple calls to updateAAD were ignored Do to a missing assignment statement, only the first call to updateAAD was honored and the rest were discarded. (cherry picked from commit a23b05b327b9d8fefc44276c2fa80278ef210c0f) Bug: 27371173 Change-Id: I77ad7800b0905f72d5abe76b56352a94056ceb9c/OpenSSLCipher: reset AAD when necessary AAD was not being reset correctly during init or doFinal calls thus leading to incorrect output. (cherry picked from commit 0bab7f3b89ea13eb0d0c39d9c7b60c6112f0d6a8) Bug: 27324690 Change-Id: If7806a9d7847814b60719637abceb94d8fbc8831/OpenSSLCipher: multiple calls to updateAAD were ignored Do to a missing assignment statement, only the first call to updateAAD was honored and the rest were discarded. Bug: 27371173 Change-Id: I77ad7800b0905f72d5abe76b56352a94056ceb9c/OpenSSLCipher: reset AAD when necessary AAD was not being reset correctly during init or doFinal calls thus leading to incorrect output. Bug: 27324690 Change-Id: If7806a9d7847814b60719637abceb94d8fbc8831/"
,,0.2693,conscrypt,"Fix static analysis findings am: ee3b1694a2 am: f2b103a611 am: dee8b5219a * commit dee8b5219ab1d862a8688d8139981fc517bfc1e3: Fix static analysis findings Change-Id: I80b2be8dc827a127aa6ea24eb5bfe18307866941/Fix static analysis findings am: ee3b1694a2 am: f2b103a611 * commit f2b103a6116d87b3996b158b6b38079328dbb29d: Fix static analysis findings Change-Id: Ie3bd3ad86d5d5c461711f576d60411b7cb04c8ad/Fix static analysis findings am: ee3b1694a2 * commit ee3b1694a206350e87a70cc83dd35a1ec2053fd6: Fix static analysis findings Change-Id: If45ad8d307b61162749a390741566ea95e680f57/Fix static analysis findings Add annotations where we intentionally left out and a brief explanation. Add synchronized keyword where needed by overriding methods so they match the parent class. Change-Id: I55591a5902530f1c2fb8cc89260c3df09648ec8e/OpenSSLSocketImpl: Dont accidentally create a SocketImpl. We dont call super.close() when were wrapping a socket, so well have to be careful not to call any superclass methods that might end up creating a SocketImpl. bug: 27250522 (cherry picked from commit edae6d2b2efbd85646fea384ec76b11f099a8fca) Change-Id: Iabeade852e6a5c3bc923c7b3601f3edf3322fee2/OpenSSLSocketImpl: Dont accidentally create a SocketImpl. We dont call super.close() when were wrapping a socket, so well have to be careful not to call any superclass methods that might end up creating a SocketImpl. bug: 27250522 Change-Id: Ie98127d002cc3b3dd3dd419b62adcfec47817479/"
,,0.0974,conscrypt,"Remove exception throwing on bad hostnames. (#478) Testing on Android has indicated that there are too many things that rely on passing whatever string has been passed to them to setHostname() and arent prepared to get an exception (including IP addresses, single-element hostnames, and whatnot) for it to be reasonable to throw an exception here. Settle for documenting what the behavior of passing an invalid hostname is./"
,,0.0988,conscrypt,"Remove exception throwing on bad hostnames. (#478) Testing on Android has indicated that there are too many things that rely on passing whatever string has been passed to them to setHostname() and arent prepared to get an exception (including IP addresses, single-element hostnames, and whatnot) for it to be reasonable to throw an exception here. Settle for documenting what the behavior of passing an invalid hostname is./"
,,0.066,Frostwire,[desktop] Fixes bug setting author on m4a from YT. Cleanup./
,,0.0628,Frostwire,"[android] almost ready to merge, cleaning up, fixes./"
,,0.066,Frostwire,"[android] avoid broadcast receiver leak, ogury fixes./"
,,0.0639,Frostwire,[common] fixed TorLock/
,,0.066,Frostwire,[android] ogury logic fix/
,,0.0778,javacpp,* Start `Pointer.DeallocatorThread` with `setContextClassLoader(null)` as required by containers (issue deeplearning4j/deeplearning4j#7737)/
,,0.0621,jna,Fix callbacks when DEP is enabled git-svn-id: 2f8a963e-d2e4-e7d0-97bf-ccb7fcea9d80/
,,0.0686,OpenDDS,Various Fixes/
,,0.0621,realm-java,Merge pull request from realm/merge-fbb711-to-master Fix merge from fbb711 to master/
,,0.0639,realm-java,Merge pull request from realm/vivekkiran/5472 Fix and merge errorprone issues/
,,0.1104,rocksdb,Apply formatter on recent 45 commits. (#5827) Summary: Some recent commits might not have passed through the formatter. I formatted recent 45 commits. The script hangs for more commits so I stopped there. Pull Request resolved: Test Plan: Run all existing tests. Differential Revision: D17483727 fbshipit-source-id: af23113ee63015d8a43d89a3bc2c1056189afe8f/
,,0.0913,rocksdb,Fix spelling: commited committed (#6481) Summary: In most places in the code the variable names are spelled correctly as COMMITTED but in a couple places not. This fixes them and ensures the variable is always called COMMITTED everywhere. Pull Request resolved: Differential Revision: D20306776 Pulled By: pdillinger fbshipit-source-id: b6c1bfe41db559b4bc6955c530934460c07f7022/
,,0.0929,rocksdb,Fix spelling: commited committed (#6481) Summary: In most places in the code the variable names are spelled correctly as COMMITTED but in a couple places not. This fixes them and ensures the variable is always called COMMITTED everywhere. Pull Request resolved: Differential Revision: D20306776 Pulled By: pdillinger fbshipit-source-id: b6c1bfe41db559b4bc6955c530934460c07f7022/
